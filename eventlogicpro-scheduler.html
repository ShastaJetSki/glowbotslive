<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>EventLogicPro - Scheduler</title>
  <script>(function(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);})();</script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="dark-blue"]{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="grey"]{--bg-primary:#111;--bg-secondary:#1a1a1a;--bg-card:#242424;--bg-hover:#2e2e2e;--border-default:#333;--text-primary:#e5e5e5;--text-secondary:#a3a3a3;--accent-primary:#525252;--accent-light:#737373;}
    [data-theme="slate"],[data-theme="slate-dark"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#273549;--bg-hover:#334155;--border-default:#334155;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--accent-primary:#6366f1;--accent-light:#818cf8;}
    [data-theme="charcoal"]{--bg-primary:#121214;--bg-secondary:#18181b;--bg-card:#27272a;--bg-hover:#3f3f46;--border-default:#3f3f46;--text-primary:#fafafa;--text-secondary:#a1a1aa;--accent-primary:#a1a1aa;--accent-light:#d4d4d8;}
    [data-theme="midnight"],[data-theme="midnight-dark"]{--bg-primary:#09090b;--bg-secondary:#0f0f12;--bg-card:#18181d;--bg-hover:#222228;--border-default:#27272f;--text-primary:#eeeef0;--text-secondary:#9898a4;--accent-primary:#8b5cf6;--accent-light:#a78bfa;}
    [data-theme="navy"]{--bg-primary:#0a0e1a;--bg-secondary:#0f1526;--bg-card:#182035;--bg-hover:#1f2a45;--border-default:#253352;--text-primary:#e8ecf4;--text-secondary:#9aa5bd;--accent-primary:#4a7cc9;--accent-light:#6b9ae0;}
    [data-theme="graphite"]{--bg-primary:#0d0d0d;--bg-secondary:#141414;--bg-card:#1f1f1f;--bg-hover:#292929;--border-default:#2e2e2e;--text-primary:#e8e8e8;--text-secondary:#999;--accent-primary:#4a9eff;--accent-light:#6bb3ff;}
    [data-theme="ocean"],[data-theme="ocean-dark"]{--bg-primary:#0a1214;--bg-secondary:#0e181c;--bg-card:#152228;--bg-hover:#1c2d35;--border-default:#243842;--text-primary:#e5f0f3;--text-secondary:#8faab5;--accent-primary:#14b8a6;--accent-light:#2dd4bf;}
    [data-theme="forest"],[data-theme="forest-dark"]{--bg-primary:#0a100c;--bg-secondary:#0f1812;--bg-card:#16221a;--bg-hover:#1e2e24;--border-default:#263830;--text-primary:#e5f0e8;--text-secondary:#8faa96;--accent-primary:#22c55e;--accent-light:#4ade80;}
    [data-theme="obsidian"]{--bg-primary:#050505;--bg-secondary:#0a0a0a;--bg-card:#141414;--bg-hover:#1c1c1c;--border-default:#252525;--text-primary:#e0e0e0;--text-secondary:#888;--accent-primary:#0ea5e9;--accent-light:#38bdf8;}
    [data-theme="steel"]{--bg-primary:#0c0f13;--bg-secondary:#12161c;--bg-card:#1a2028;--bg-hover:#242c38;--border-default:#2c3644;--text-primary:#e4e8ed;--text-secondary:#8b95a5;--accent-primary:#64748b;--accent-light:#94a3b8;}
    [data-theme="espresso"]{--bg-primary:#0f0c0a;--bg-secondary:#161210;--bg-card:#211c18;--bg-hover:#2c2520;--border-default:#382f28;--text-primary:#f0ebe5;--text-secondary:#a89e94;--accent-primary:#a78b6e;--accent-light:#c4a88a;}
    [data-theme="onyx"]{--bg-primary:#000;--bg-secondary:#080808;--bg-card:#121212;--bg-hover:#1a1a1a;--border-default:#222;--text-primary:#f5f5f5;--text-secondary:#8c8c8c;--accent-primary:#06b6d4;--accent-light:#22d3ee;}
    [data-theme="light-blue"],[data-theme="blue-light"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#2563eb;--accent-light:#3b82f6;}
    [data-theme="light-grey"],[data-theme="slate-light"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#e5e5e5;--border-default:#d4d4d4;--text-primary:#171717;--text-secondary:#525252;--accent-primary:#404040;--accent-light:#525252;}
    [data-theme="light-slate"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#4f46e5;--accent-light:#6366f1;}
    [data-theme="light-ocean"],[data-theme="ocean-light"]{--bg-primary:#f0fdfa;--bg-secondary:#ccfbf1;--bg-card:#fff;--bg-hover:#99f6e4;--border-default:#5eead4;--text-primary:#134e4a;--text-secondary:#0f766e;--accent-primary:#0d9488;--accent-light:#14b8a6;}
    [data-theme="light-forest"],[data-theme="mint-light"],[data-theme="mint"]{--bg-primary:#f0fdf4;--bg-secondary:#dcfce7;--bg-card:#fff;--bg-hover:#bbf7d0;--border-default:#86efac;--text-primary:#14532d;--text-secondary:#166534;--accent-primary:#16a34a;--accent-light:#22c55e;}
    [data-theme="light-midnight"],[data-theme="lavender-light"],[data-theme="lavender"]{--bg-primary:#faf5ff;--bg-secondary:#f3e8ff;--bg-card:#fff;--bg-hover:#e9d5ff;--border-default:#d8b4fe;--text-primary:#1e1b4b;--text-secondary:#5b21b6;--accent-primary:#7c3aed;--accent-light:#8b5cf6;}
    [data-theme="light-obsidian"],[data-theme="sky-light"],[data-theme="sky"]{--bg-primary:#f0f9ff;--bg-secondary:#e0f2fe;--bg-card:#fff;--bg-hover:#bae6fd;--border-default:#7dd3fc;--text-primary:#0c4a6e;--text-secondary:#0369a1;--accent-primary:#0284c7;--accent-light:#0ea5e9;}
    [data-theme="light-espresso"]{--bg-primary:#fefcfb;--bg-secondary:#fdf4ef;--bg-card:#fff;--bg-hover:#f5e6db;--border-default:#ddc9b8;--text-primary:#3d2c1e;--text-secondary:#6b5344;--accent-primary:#8b6f4e;--accent-light:#a78b6e;}
    [data-theme="light-graphite"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#ebebeb;--border-default:#d1d1d1;--text-primary:#1a1a1a;--text-secondary:#4a4a4a;--accent-primary:#2196f3;--accent-light:#42a5f5;}
    [data-theme="light-onyx"]{--bg-primary:#ecfeff;--bg-secondary:#cffafe;--bg-card:#fff;--bg-hover:#a5f3fc;--border-default:#67e8f9;--text-primary:#164e63;--text-secondary:#0e7490;--accent-primary:#0891b2;--accent-light:#06b6d4;}
    [data-theme="light-steel"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#1e293b;--text-secondary:#475569;--accent-primary:#475569;--accent-light:#64748b;}
    [data-theme="light-navy"]{--bg-primary:#f0f4ff;--bg-secondary:#e0e7ff;--bg-card:#fff;--bg-hover:#c7d2fe;--border-default:#a5b4fc;--text-primary:#1e1b4b;--text-secondary:#3730a3;--accent-primary:#3949ab;--accent-light:#5c6bc0;}
    [data-theme="light-charcoal"]{--bg-primary:#fafafa;--bg-secondary:#f4f4f5;--bg-card:#fff;--bg-hover:#e4e4e7;--border-default:#d4d4d8;--text-primary:#18181b;--text-secondary:#52525b;--accent-primary:#71717a;--accent-light:#a1a1aa;}
    [data-theme="cyber-dark"],[data-theme="cyber"]{--bg-primary:#0a0a0f;--bg-secondary:#0f0f18;--bg-card:#151522;--bg-hover:#1c1c2e;--border-default:#2a2a44;--text-primary:#e0e0ff;--text-secondary:#9090c0;--accent-primary:#00ff88;--accent-light:#44ffaa;}
    [data-theme="amber-dark"],[data-theme="amber"]{--bg-primary:#0f0c05;--bg-secondary:#1a1508;--bg-card:#26200c;--bg-hover:#332a10;--border-default:#443815;--text-primary:#fef3c7;--text-secondary:#c9b896;--accent-primary:#f59e0b;--accent-light:#fbbf24;}
    [data-theme="honey-light"],[data-theme="honey"]{--bg-primary:#fffbeb;--bg-secondary:#fef3c7;--bg-card:#fff;--bg-hover:#fde68a;--border-default:#fcd34d;--text-primary:#78350f;--text-secondary:#a06020;--accent-primary:#d97706;--accent-light:#f59e0b;}
    [data-theme="crimson-dark"],[data-theme="crimson"]{--bg-primary:#0f0708;--bg-secondary:#1a0c0e;--bg-card:#261214;--bg-hover:#331a1c;--border-default:#442225;--text-primary:#fee2e2;--text-secondary:#c9a3a5;--accent-primary:#dc2626;--accent-light:#ef4444;}
    [data-theme="coral-light"],[data-theme="coral"]{--bg-primary:#fff5f5;--bg-secondary:#fee2e2;--bg-card:#fff;--bg-hover:#fecaca;--border-default:#fca5a5;--text-primary:#7f1d1d;--text-secondary:#a04444;--accent-primary:#ef4444;--accent-light:#f87171;}
    [data-theme="rose-dark"],[data-theme="rose"]{--bg-primary:#0f070a;--bg-secondary:#1a0c12;--bg-card:#26121a;--bg-hover:#331a24;--border-default:#44222e;--text-primary:#ffe4ec;--text-secondary:#c9a3b0;--accent-primary:#ec4899;--accent-light:#f472b6;}
    [data-theme="sand-light"],[data-theme="sand"]{--bg-primary:#fefcf8;--bg-secondary:#faf6ee;--bg-card:#fff;--bg-hover:#f5efe0;--border-default:#e8dcc8;--text-primary:#44402a;--text-secondary:#6a6550;--accent-primary:#a89060;--accent-light:#c4aa78;}

    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary);overflow-x:hidden;}
    body{padding-bottom:120px;}
    .theme-toggle-btn{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .theme-toggle-btn:hover{background:var(--bg-hover);}
    .theme-toggle-btn svg{width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;}
    .business-name{font-size:13px;color:var(--text-secondary);}
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--bg-card);color:var(--text-primary);padding:12px 24px;border-radius:10px;font-size:13px;font-weight:600;border:1px solid var(--accent-primary);z-index:9999;display:none;}
    .toast.show{display:block;animation:fadeIn .3s;}
    @keyframes fadeIn{from{opacity:0;transform:translateX(-50%) translateY(10px);}to{opacity:1;transform:translateX(-50%) translateY(0);}}

    .mobile-top-header{display:none;}
    .mobile-header-bar{display:flex;align-items:center;padding:12px 16px;gap:12px;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-menu-toggle{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-primary);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .mobile-header-center{flex:1;min-width:0;}
    .mobile-header-title{font-size:18px;font-weight:700;}
    .mobile-header-content{display:none;padding:12px 16px;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-header-content.expanded{display:block;}
    .mobile-header-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .mobile-header-actions button{padding:10px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:13px;cursor:pointer;}
    .desktop-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg-secondary);padding:8px;z-index:100;border-top:1px solid var(--border-default);}
    .mobile-nav-top{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
    .mobile-nav-btn{padding:10px 8px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;display:flex;align-items:center;justify-content:center;min-height:44px;transition:all .2s;}
    .mobile-nav-btn.active{background:color-mix(in srgb,var(--accent-primary) 60%,transparent);border-color:var(--accent-primary);color:var(--text-primary);}

    .sched-controls{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;gap:12px;flex-wrap:wrap;}
    .sched-nav{display:flex;align-items:center;gap:8px;}
    .sched-nav-btn{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-primary);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;}
    .sched-nav-btn:hover{background:var(--bg-hover);}
    .sched-title{font-size:18px;font-weight:700;min-width:180px;text-align:center;}
    .sched-today-btn{padding:6px 14px;border-radius:6px;border:1px solid var(--accent-primary);background:transparent;color:var(--accent-light);font-size:12px;font-weight:600;cursor:pointer;}
    .sched-today-btn:hover{background:color-mix(in srgb,var(--accent-primary) 15%,transparent);}
    .view-toggle{display:flex;border-radius:8px;overflow:hidden;border:1px solid var(--border-default);}
    .view-btn{padding:8px 16px;border:none;background:var(--bg-card);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;}
    .view-btn.active{background:var(--accent-primary);color:#fff;}
    .view-btn+.view-btn{border-left:1px solid var(--border-default);}
    .sched-add-btn{padding:8px 16px;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;font-size:13px;font-weight:600;cursor:pointer;}

    .cal-container{display:flex;flex-direction:column;padding:0 16px 16px;}
    .cal-header{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:4px;}
    .cal-header-day{text-align:center;font-size:11px;font-weight:600;color:var(--text-secondary);padding:8px 4px;text-transform:uppercase;}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);grid-template-rows:repeat(6,1fr);gap:2px;flex:1;min-height:0;}
    .cal-cell{background:var(--bg-card);border:1px solid var(--border-default);border-radius:6px;padding:4px 6px;cursor:pointer;transition:border-color .2s;overflow:hidden;min-height:70px;display:flex;flex-direction:column;}
    .cal-cell:hover{border-color:var(--accent-primary);}
    .cal-cell.today{border-color:var(--accent-primary);background:color-mix(in srgb,var(--accent-primary) 8%,var(--bg-card));}
    .cal-cell.other{opacity:.35;}
    .cal-day-num{font-size:12px;font-weight:600;margin-bottom:4px;}
    .cal-cell.today .cal-day-num{color:var(--accent-light);}
    .cal-events{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:2px;scrollbar-width:thin;}
    .cal-events::-webkit-scrollbar{width:3px;}
    .cal-events::-webkit-scrollbar-thumb{background:var(--border-default);border-radius:3px;}
    .cal-strip{font-size:10px;padding:2px 5px;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;font-weight:500;}
    .cal-strip:hover{filter:brightness(1.2);}
    .strip-meeting{background:#3b82f6;color:#fff;}.strip-deadline{background:#ef4444;color:#fff;}.strip-milestone{background:#f59e0b;color:#000;}.strip-setup{background:#22c55e;color:#fff;}.strip-rehearsal{background:#8b5cf6;color:#fff;}.strip-other{background:#64748b;color:#fff;}

    .week-container{display:flex;flex-direction:column;padding:0 16px 16px;}
    .week-header{display:grid;grid-template-columns:50px repeat(7,1fr);gap:0;}
    .week-header-day{text-align:center;font-size:11px;font-weight:600;color:var(--text-secondary);padding:6px 2px;border-bottom:2px solid var(--border-default);}
    .week-header-day.today{color:var(--accent-light);border-bottom-color:var(--accent-primary);}
    .week-header-day .day-num{font-size:18px;font-weight:700;color:var(--text-primary);display:block;}
    .week-header-day.today .day-num{color:var(--accent-light);}
    .week-grid{display:grid;grid-template-columns:50px repeat(7,1fr);gap:0;overflow-y:auto;max-height:calc(100vh - 220px);}
    .week-time{font-size:10px;color:var(--text-secondary);text-align:right;padding:2px 6px 0 0;height:48px;border-top:1px solid var(--border-default);}
    .week-cell{border-top:1px solid var(--border-default);border-left:1px solid var(--border-default);min-height:48px;padding:2px;cursor:pointer;}
    .week-cell:hover{background:var(--bg-hover);}
    .week-cell.today-col{background:color-mix(in srgb,var(--accent-primary) 5%,transparent);}
    .week-event{font-size:10px;padding:2px 4px;border-radius:3px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;}
    .cat-meeting{background:color-mix(in srgb,#3b82f6 25%,var(--bg-card));border-left:3px solid #3b82f6;}
    .cat-deadline{background:color-mix(in srgb,#ef4444 25%,var(--bg-card));border-left:3px solid #ef4444;}
    .cat-milestone{background:color-mix(in srgb,#f59e0b 25%,var(--bg-card));border-left:3px solid #f59e0b;}
    .cat-setup{background:color-mix(in srgb,#22c55e 25%,var(--bg-card));border-left:3px solid #22c55e;}
    .cat-rehearsal{background:color-mix(in srgb,#8b5cf6 25%,var(--bg-card));border-left:3px solid #8b5cf6;}
    .cat-other{background:color-mix(in srgb,#64748b 25%,var(--bg-card));border-left:3px solid #64748b;}

    .day-container{padding:0 16px 16px;}
    .day-timeline{max-height:calc(100vh - 220px);overflow-y:auto;}
    .day-hour{display:grid;grid-template-columns:50px 1fr;min-height:60px;border-top:1px solid var(--border-default);}
    .day-hour-label{font-size:11px;color:var(--text-secondary);text-align:right;padding:4px 8px 0 0;}
    .day-hour-content{padding:4px;cursor:pointer;min-height:60px;}
    .day-hour-content:hover{background:var(--bg-hover);}
    .day-event{padding:8px 12px;border-radius:6px;margin-bottom:4px;cursor:pointer;}
    .day-event-title{font-weight:600;font-size:13px;}
    .day-event-time{font-size:11px;opacity:.8;margin-top:2px;}

    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;}
    .modal-overlay.active{opacity:1;pointer-events:auto;}
    .modal-content{background:var(--bg-card);border-radius:16px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;border:1px solid var(--border-default);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-default);}
    .modal-title{font-size:16px;font-weight:700;}
    .modal-close{width:32px;height:32px;border-radius:8px;border:none;background:transparent;color:var(--text-secondary);font-size:20px;cursor:pointer;}
    .modal-body{padding:20px;}
    .modal-footer{display:flex;justify-content:flex-end;gap:10px;padding:16px 20px;border-top:1px solid var(--border-default);}
    .form-group{margin-bottom:14px;}
    .form-label{font-size:12px;font-weight:600;color:var(--text-secondary);margin-bottom:4px;display:block;}
    .form-input,.form-select,.form-textarea{width:100%;padding:10px 12px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);font-size:14px;font-family:inherit;}
    .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--accent-primary);}
    .form-textarea{resize:vertical;min-height:60px;}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .btn-primary{padding:10px 20px;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;font-size:13px;font-weight:600;cursor:pointer;}
    .btn-secondary{padding:10px 20px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-primary);font-size:13px;font-weight:600;cursor:pointer;}
    .btn-danger{padding:10px 20px;border-radius:8px;border:none;background:#ef4444;color:#fff;font-size:13px;font-weight:600;cursor:pointer;margin-right:auto;}

    @media(max-width:768px){
      .desktop-header{display:none !important;}.mobile-top-header{display:block;}.mobile-bottom-nav{display:block !important;}
      .modal-overlay{align-items:flex-end;padding:0;}.modal-content{border-radius:20px 20px 0 0;max-height:85vh;}
      .form-row{grid-template-columns:1fr;}
      .sched-controls{padding:8px 12px;gap:8px;}
      .sched-title{font-size:15px;min-width:120px;}
      .sched-right-controls .view-toggle{display:none;}
      .cal-cell{min-height:52px;padding:2px 3px;}
      .cal-day-num{font-size:10px;margin-bottom:2px;}
      .cal-strip{font-size:8px;padding:1px 3px;}
      .cal-header-day{font-size:9px;padding:4px 1px;}
      .week-grid{max-height:calc(100vh - 260px);}
      .week-header{grid-template-columns:40px repeat(7,1fr);}
      .week-grid{grid-template-columns:40px repeat(7,1fr);}
      .week-time{font-size:9px;padding-right:3px;}
      .week-header-day{font-size:9px;padding:4px 1px;}
      .week-header-day .day-num{font-size:14px;}
      .week-event{font-size:8px;padding:1px 2px;}
      .day-timeline{max-height:calc(100vh - 260px);}
      .day-hour{grid-template-columns:40px 1fr;}
      body{padding-bottom:80px;}
    }
    @media(min-width:769px){.mobile-top-header{display:none !important;}.mobile-bottom-nav{display:none !important;}body{padding-bottom:20px;}}
  </style>
</head>
<body>

<div class="mobile-top-header">
  <div class="mobile-header-bar">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu(this)"><span>&#9776;</span></button>
    <div class="mobile-header-center"><div class="mobile-header-title">Scheduler</div><div class="business-name" id="mobileBusinessName">Loading...</div></div>
    <div class="view-toggle" style="display:flex !important;">
      <button class="view-btn active" id="mViewMonth" onclick="setView('month')">M</button>
      <button class="view-btn" id="mViewWeek" onclick="setView('week')">W</button>
      <button class="view-btn" id="mViewDay" onclick="setView('day')">D</button>
    </div>
  </div>
  <div class="mobile-header-content" id="mobileHeaderContent"><div class="mobile-header-actions"><button onclick="location.href='eventlogicpro-settings.html'">Settings</button><button onclick="logout()">Logout</button></div></div>
</div>

<div class="desktop-header">
  <div style="padding:16px 24px 8px;display:flex;justify-content:space-between;align-items:center;">
    <div><h1 style="margin:0;font-size:32px;font-weight:600;">EventLogicPro</h1><div class="business-name" id="desktopBusinessName">Loading...</div></div>
    <div style="display:flex;align-items:center;gap:16px;"><button class="theme-toggle-btn" onclick="cycleTheme()"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button><a onclick="logout()" style="color:var(--text-secondary);cursor:pointer;font-size:14px;">Logout</a></div>
  </div>
  <div style="padding:0 24px 12px;"><nav style="display:flex;gap:24px;">
    <a href="eventlogicpro.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Events</a>
    <a href="eventlogicpro-scheduler.html" style="padding:12px 0;color:var(--accent-primary);text-decoration:none;font-size:14px;border-bottom:2px solid var(--accent-primary);">Scheduler</a>
    <a href="eventlogicpro-members.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Members</a>
    <a href="eventlogicpro-settings.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Settings</a>
  </nav></div>
</div>

<div class="sched-controls">
  <div class="sched-nav">
    <button class="sched-nav-btn" onclick="navPrev()">&#9664;</button>
    <div class="sched-title" id="schedTitle"></div>
    <button class="sched-nav-btn" onclick="navNext()">&#9654;</button>
    <button class="sched-today-btn" onclick="goToday()">Today</button>
  </div>
  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="sched-right-controls">
    <select class="form-select" id="schedProjectSelect" onchange="switchProject()" style="max-width:180px;font-size:13px;padding:7px 10px;border-radius:8px;"><option value="">All Events</option></select>
    <div class="view-toggle">
      <button class="view-btn active" id="dViewMonth" onclick="setView('month')">Month</button>
      <button class="view-btn" id="dViewWeek" onclick="setView('week')">Week</button>
      <button class="view-btn" id="dViewDay" onclick="setView('day')">Day</button>
    </div>
    <button class="sched-add-btn" onclick="openEventModal()">+ Add</button>
  </div>
</div>

<div id="monthView" class="cal-container"></div>
<div id="weekView" class="week-container" style="display:none;"></div>
<div id="dayView" class="day-container" style="display:none;"></div>

<div class="modal-overlay" id="eventModal">
  <div class="modal-content">
    <div class="modal-header"><div class="modal-title" id="eventModalTitle">Add Schedule Item</div><button class="modal-close" onclick="closeEventModal()">&times;</button></div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="emTitle"></div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Date *</label><input type="date" class="form-input" id="emDate"></div>
        <div class="form-group"><label class="form-label">Category</label><select class="form-select" id="emCategory"><option value="meeting">Meeting</option><option value="deadline">Deadline</option><option value="milestone">Milestone</option><option value="setup">Setup / Load-in</option><option value="rehearsal">Rehearsal</option><option value="other">Other</option></select></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Start Time</label><input type="time" class="form-input" id="emStart"></div>
        <div class="form-group"><label class="form-label">End Time</label><input type="time" class="form-input" id="emEnd"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Event Project</label><select class="form-select" id="emProject"><option value="">-- None --</option></select></div>
        <div class="form-group"><label class="form-label">Assigned To</label><select class="form-select" id="emAssigned"><option value="">-- None --</option></select></div>
      </div>
      <div class="form-group"><label class="form-label">Location</label><input type="text" class="form-input" id="emLocation"></div>
      <div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="emNotes"></textarea></div>
    </div>
    <div class="modal-footer"><button class="btn-danger" id="emDeleteBtn" style="display:none;" onclick="deleteScheduleItem()">Delete</button><button class="btn-secondary" onclick="closeEventModal()">Cancel</button><button class="btn-primary" onclick="saveScheduleItem()">Save</button></div>
  </div>
</div>

<div class="mobile-bottom-nav"><div class="mobile-nav-top"><a href="eventlogicpro.html" class="mobile-nav-btn">Events</a><a href="eventlogicpro-scheduler.html" class="mobile-nav-btn active">Schedule</a><a href="eventlogicpro-members.html" class="mobile-nav-btn">Members</a><a href="eventlogicpro-settings.html" class="mobile-nav-btn">Settings</a></div></div>
<div class="toast" id="toast"></div>

<script>
var SUPABASE_URL='https://kxqkwpkmtgvmthpafoqx.supabase.co';
var SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';
var sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
var tenantId=null,userId=null,allItems=[],allProjects=[],allMembers=[];
var currentView='month',viewDate=new Date(),editingItemId=null,filterProjectId=null;

var themes=['dark-blue','grey','slate','charcoal','midnight','navy','graphite','ocean','forest','obsidian','steel','espresso','onyx','light-blue','light-grey','light-slate','light-ocean','light-forest','light-midnight','light-obsidian','light-espresso','light-graphite','light-onyx','light-steel','light-navy','light-charcoal','cyber','amber','honey','crimson','coral','rose','sand'];
var themeIndex=0;
function loadTheme(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);themeIndex=themes.indexOf(t);if(themeIndex<0)themeIndex=0;}
function cycleTheme(){themeIndex=(themeIndex+1)%themes.length;var t=themes[themeIndex];document.documentElement.setAttribute('data-theme',t);localStorage.setItem('app-theme',t);}
loadTheme();
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2500);}
function toggleMobileMenu(btn){document.getElementById('mobileHeaderContent').classList.toggle('expanded');}
async function logout(){await sb.auth.signOut();window.location.href='login.html';}
async function checkAuth(){var r=await sb.auth.getSession();var s=r.data.session;if(!s){var t=localStorage.getItem('sb_access_token'),rf=localStorage.getItem('sb_refresh_token');if(t&&rf){var sr=await sb.auth.setSession({access_token:t,refresh_token:rf});s=sr.data?.session;}if(!s){window.location.href='login.html';return null;}}return s;}

async function loadProjects(){var r=await sb.from('event_projects').select('event_project_id,event_name').eq('tenant_id',tenantId).order('created_at',{ascending:false});allProjects=r.data||[];var s1=document.getElementById('schedProjectSelect'),s2=document.getElementById('emProject');s1.innerHTML='<option value="">All Events</option>';s2.innerHTML='<option value="">-- None --</option>';allProjects.forEach(function(p){s1.innerHTML+='<option value="'+p.event_project_id+'">'+p.event_name+'</option>';s2.innerHTML+='<option value="'+p.event_project_id+'">'+p.event_name+'</option>';});}
async function loadMembers(){var r=await sb.from('event_members').select('*').eq('tenant_id',tenantId).order('first_name');allMembers=r.data||[];var s=document.getElementById('emAssigned');s.innerHTML='<option value="">-- None --</option>';allMembers.forEach(function(m){s.innerHTML+='<option value="'+m.member_id+'">'+((m.first_name||'')+' '+(m.last_name||'')).trim()+'</option>';});}
async function loadScheduleItems(){var q=sb.from('event_schedule_items').select('*').eq('tenant_id',tenantId).order('item_date').order('start_time');if(filterProjectId)q=q.eq('event_project_id',filterProjectId);var r=await q;allItems=r.data||[];}
function empName(id){if(!id)return '';var m=allMembers.find(function(x){return x.member_id===id;});return m?((m.first_name||'')+' '+(m.last_name||'')).trim():'';}

function setView(v){currentView=v;document.getElementById('monthView').style.display=v==='month'?'flex':'none';document.getElementById('weekView').style.display=v==='week'?'flex':'none';document.getElementById('dayView').style.display=v==='day'?'block':'none';['dViewMonth','dViewWeek','dViewDay','mViewMonth','mViewWeek','mViewDay'].forEach(function(id){var el=document.getElementById(id);if(el)el.classList.remove('active');});var did='dView'+v.charAt(0).toUpperCase()+v.slice(1),mid='mView'+v.charAt(0).toUpperCase()+v.slice(1);if(document.getElementById(did))document.getElementById(did).classList.add('active');if(document.getElementById(mid))document.getElementById(mid).classList.add('active');render();}
function switchProject(){filterProjectId=document.getElementById('schedProjectSelect').value||null;loadScheduleItems().then(render);}
function navPrev(){if(currentView==='month')viewDate.setMonth(viewDate.getMonth()-1);else if(currentView==='week')viewDate.setDate(viewDate.getDate()-7);else viewDate.setDate(viewDate.getDate()-1);render();}
function navNext(){if(currentView==='month')viewDate.setMonth(viewDate.getMonth()+1);else if(currentView==='week')viewDate.setDate(viewDate.getDate()+7);else viewDate.setDate(viewDate.getDate()+1);render();}
function goToday(){viewDate=new Date();render();}

var MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
var DAYS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
function render(){if(currentView==='month'){document.getElementById('schedTitle').textContent=MONTHS[viewDate.getMonth()]+' '+viewDate.getFullYear();renderMonth();}else if(currentView==='week'){var ws=getWeekStart(viewDate),we=new Date(ws);we.setDate(we.getDate()+6);document.getElementById('schedTitle').textContent=shortDate(ws)+' ‚Äì '+shortDate(we);renderWeek();}else{document.getElementById('schedTitle').textContent=DAYS[viewDate.getDay()]+', '+MONTHS[viewDate.getMonth()]+' '+viewDate.getDate()+', '+viewDate.getFullYear();renderDay();}}
function shortDate(d){var m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return m[d.getMonth()]+' '+d.getDate();}
function dateStr(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');}
function isToday(d){var t=new Date();return d.getFullYear()===t.getFullYear()&&d.getMonth()===t.getMonth()&&d.getDate()===t.getDate();}
function getWeekStart(d){var ws=new Date(d);ws.setDate(ws.getDate()-ws.getDay());return ws;}
function getItemsForDate(ds){return allItems.filter(function(i){return i.item_date===ds;});}

function renderMonth(){var el=document.getElementById('monthView'),y=viewDate.getFullYear(),mo=viewDate.getMonth(),first=new Date(y,mo,1),startDay=first.getDay(),dim=new Date(y,mo+1,0).getDate(),prevDays=new Date(y,mo,0).getDate();var h='<div class="cal-header">';DAYS.forEach(function(d){h+='<div class="cal-header-day">'+d+'</div>';});h+='</div><div class="cal-grid">';for(var i=0;i<42;i++){var dn,ds,cls='cal-cell';if(i<startDay){dn=prevDays-startDay+i+1;ds=dateStr(new Date(y,mo-1,dn));cls+=' other';}else if(i-startDay>=dim){dn=i-startDay-dim+1;ds=dateStr(new Date(y,mo+1,dn));cls+=' other';}else{dn=i-startDay+1;var cd=new Date(y,mo,dn);ds=dateStr(cd);if(isToday(cd))cls+=' today';}var items=getItemsForDate(ds);h+='<div class="'+cls+'" onclick="clickDate(\''+ds+'\')"><div class="cal-day-num">'+dn+'</div><div class="cal-events">';items.forEach(function(it){h+='<div class="cal-strip strip-'+(it.category||'other')+'" onclick="event.stopPropagation();openEditItem(\''+it.schedule_item_id+'\')" title="'+it.title+'">'+it.title+'</div>';});h+='</div></div>';}h+='</div>';el.innerHTML=h;}

function renderWeek(){var el=document.getElementById('weekView'),ws=getWeekStart(viewDate);var h='<div class="week-header"><div class="week-header-day"></div>';for(var d=0;d<7;d++){var dd=new Date(ws);dd.setDate(dd.getDate()+d);h+='<div class="week-header-day'+(isToday(dd)?' today':'')+'"><span class="day-num">'+dd.getDate()+'</span>'+DAYS[d]+'</div>';}h+='</div><div class="week-grid">';for(var hr=6;hr<22;hr++){var lb=hr===0?'12a':hr<12?hr+'a':hr===12?'12p':(hr-12)+'p';h+='<div class="week-time">'+lb+'</div>';for(var d=0;d<7;d++){var dd=new Date(ws);dd.setDate(dd.getDate()+d);var ds=dateStr(dd);var items=getItemsForDate(ds).filter(function(it){if(!it.start_time)return hr===8;return parseInt(it.start_time.split(':')[0])===hr;});h+='<div class="week-cell'+(isToday(dd)?' today-col':'')+'" onclick="clickDate(\''+ds+'\','+hr+')">';items.forEach(function(it){h+='<div class="week-event cat-'+(it.category||'other')+'" onclick="event.stopPropagation();openEditItem(\''+it.schedule_item_id+'\')">'+it.title+'</div>';});h+='</div>';}}h+='</div>';el.innerHTML=h;}

function renderDay(){var el=document.getElementById('dayView'),ds=dateStr(viewDate);var h='<div class="day-timeline">';for(var hr=6;hr<22;hr++){var lb=hr===0?'12 AM':hr<12?hr+' AM':hr===12?'12 PM':(hr-12)+' PM';var items=getItemsForDate(ds).filter(function(it){if(!it.start_time)return hr===8;return parseInt(it.start_time.split(':')[0])===hr;});h+='<div class="day-hour"><div class="day-hour-label">'+lb+'</div><div class="day-hour-content" onclick="clickDate(\''+ds+'\','+hr+')">';items.forEach(function(it){var ts=it.start_time?(it.start_time.substring(0,5)+(it.end_time?' ‚Äì '+it.end_time.substring(0,5):'')):'';h+='<div class="day-event cat-'+(it.category||'other')+'" onclick="event.stopPropagation();openEditItem(\''+it.schedule_item_id+'\')"><div class="day-event-title">'+it.title+'</div>';if(ts)h+='<div class="day-event-time">'+ts+'</div>';if(it.location)h+='<div class="day-event-time">üìç '+it.location+'</div>';var a=empName(it.assigned_to);if(a)h+='<div class="day-event-time">üë§ '+a+'</div>';h+='</div>';});h+='</div></div>';}h+='</div>';el.innerHTML=h;}

function clickDate(ds,hr){if(currentView==='month'){viewDate=new Date(ds+'T12:00:00');setView('day');}else{openEventModal(ds,hr);}}
function openEventModal(ds,hr){editingItemId=null;document.getElementById('eventModalTitle').textContent='Add Schedule Item';document.getElementById('emTitle').value='';document.getElementById('emDate').value=ds||dateStr(viewDate);document.getElementById('emCategory').value='meeting';document.getElementById('emStart').value=hr!==undefined?String(hr).padStart(2,'0')+':00':'09:00';document.getElementById('emEnd').value=hr!==undefined?String(Math.min(hr+1,23)).padStart(2,'0')+':00':'10:00';document.getElementById('emProject').value=filterProjectId||'';document.getElementById('emAssigned').value='';document.getElementById('emLocation').value='';document.getElementById('emNotes').value='';document.getElementById('emDeleteBtn').style.display='none';document.getElementById('eventModal').classList.add('active');}
function openEditItem(id){var it=allItems.find(function(x){return x.schedule_item_id===id;});if(!it)return;editingItemId=id;document.getElementById('eventModalTitle').textContent='Edit Schedule Item';document.getElementById('emTitle').value=it.title||'';document.getElementById('emDate').value=it.item_date||'';document.getElementById('emCategory').value=it.category||'meeting';document.getElementById('emStart').value=it.start_time?it.start_time.substring(0,5):'';document.getElementById('emEnd').value=it.end_time?it.end_time.substring(0,5):'';document.getElementById('emProject').value=it.event_project_id||'';document.getElementById('emAssigned').value=it.assigned_to||'';document.getElementById('emLocation').value=it.location||'';document.getElementById('emNotes').value=it.notes||'';document.getElementById('emDeleteBtn').style.display='block';document.getElementById('eventModal').classList.add('active');}
function closeEventModal(){document.getElementById('eventModal').classList.remove('active');}

async function saveScheduleItem(){var title=document.getElementById('emTitle').value.trim(),dt=document.getElementById('emDate').value;if(!title||!dt){showToast('Title and date required');return;}var data={title:title,item_date:dt,category:document.getElementById('emCategory').value,start_time:document.getElementById('emStart').value||null,end_time:document.getElementById('emEnd').value||null,event_project_id:document.getElementById('emProject').value||null,assigned_to:document.getElementById('emAssigned').value||null,location:document.getElementById('emLocation').value.trim()||null,notes:document.getElementById('emNotes').value.trim()||null};if(editingItemId){await sb.from('event_schedule_items').update(data).eq('schedule_item_id',editingItemId);showToast('Updated');}else{data.tenant_id=tenantId;data.created_by=userId;await sb.from('event_schedule_items').insert(data);showToast('Added');}closeEventModal();await loadScheduleItems();render();}
async function deleteScheduleItem(){if(!editingItemId||!confirm('Delete this item?'))return;await sb.from('event_schedule_items').delete().eq('schedule_item_id',editingItemId);closeEventModal();showToast('Deleted');await loadScheduleItems();render();}

// Touch swipe
var touchStartX=0;
document.addEventListener('touchstart',function(e){touchStartX=e.touches[0].clientX;},{passive:true});
document.addEventListener('touchend',function(e){var dx=e.changedTouches[0].clientX-touchStartX;if(Math.abs(dx)>80){if(dx>0)navPrev();else navNext();}},{passive:true});

async function init(){var s=await checkAuth();if(!s)return;userId=s.user.id;var ue=s.user.email||'';if(ue){var ur=await sb.from('users').select('tenant_id,user_id').eq('email',ue).single();if(ur.data){tenantId=ur.data.tenant_id;userId=ur.data.user_id;}document.getElementById('mobileBusinessName').textContent=ue;document.getElementById('desktopBusinessName').textContent=ue;}if(!tenantId){var bs=await sb.from('business_settings').select('tenant_id').limit(1).single();if(bs.data)tenantId=bs.data.tenant_id;}if(!tenantId){showToast('Could not determine tenant');return;}await loadProjects();await loadMembers();await loadScheduleItems();render();}
init();
</script>
</body>
</html>
