<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WorkLogic Pro â€“ Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="supabase-anon-key"
    content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4" />

  <style>
    body {
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#0b0f14;
      font-family:system-ui;
      color:#e8eef6;
    }
    .card {
      width:420px;
      padding:28px;
      border-radius:18px;
      background:#0f1621;
      border:1px solid #223044;
    }
    label { font-size:13px; color:#9fb0c3; margin-top:14px; display:block; }
    input {
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid #223044;
      background:#0b0f14;
      color:#fff;
    }
    button {
      width:100%;
      margin-top:20px;
      padding:12px;
      border-radius:14px;
      border:1px solid #2a3b55;
      background:#1a2535;
      color:#fff;
      cursor:pointer;
    }
    .error {
      margin-top:16px;
      padding:12px;
      border-radius:12px;
      background:#2a1414;
      border:1px solid #553333;
      color:#ffb3b3;
      display:none;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>WorkLogic Pro</h2>
  <p style="color:#9fb0c3">Sign in to continue</p>

  <label>Email</label>
  <input id="email" type="email" />

  <label>Password</label>
  <input id="password" type="password" />

  <button id="login">Sign In</button>
  <div id="error" class="error"></div>
</div>

<script>
const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
const API_BASE = `https://${PROJECT_REF}.supabase.co`;
const ANON_KEY = document.querySelector('meta[name="supabase-anon-key"]').content;

const email = document.getElementById("email");
const password = document.getElementById("password");
const errorBox = document.getElementById("error");
const loginBtn = document.getElementById("login");

// ðŸ”‘ CRITICAL: always clear any stale token on login page
localStorage.removeItem("sb_access_token");

async function login() {
  errorBox.style.display = "none";
  loginBtn.disabled = true;

  try {
    const res = await fetch(
      `${API_BASE}/auth/v1/token?grant_type=password`,
      {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          apikey:ANON_KEY
        },
        body:JSON.stringify({
          email: email.value.trim(),
          password: password.value
        })
      }
    );

    const data = await res.json();
    if (!res.ok) throw new Error(data.error_description || "Login failed");

    // âœ… overwrite token
    localStorage.setItem("sb_access_token", data.access_token);

    // âœ… redirect after success only
    window.location.href = "dashboard-business.html";

  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.style.display = "block";
  } finally {
    loginBtn.disabled = false;
  }
}

loginBtn.onclick = login;
password.addEventListener("keydown", e => {
  if (e.key === "Enter") login();
});
</script>

</body>
</html>
