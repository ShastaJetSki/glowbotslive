<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Scheduler</title>
  <style>
    :root {
      --bg-primary: #0b0f14; --bg-secondary: #0f1621; --bg-card: #1a2535; --bg-hover: #223044;
      --border-default: #223044; --text-primary: #e8eef6; --text-secondary: #9fb0c3;
      --accent-primary: #3b82f6; --accent-light: #60a5fa;
      --month-alt-bg: #0d1218;
    }
    [data-theme="dark-blue"] {
      --bg-primary: #0b0f14; --bg-secondary: #0f1621; --bg-card: #1a2535; --bg-hover: #223044;
      --border-default: #223044; --text-primary: #e8eef6; --text-secondary: #9fb0c3;
      --accent-primary: #3b82f6; --accent-light: #60a5fa;
      --month-alt-bg: #0d1218;
    }
    [data-theme="grey"] {
      --bg-primary: #111111; --bg-secondary: #1a1a1a; --bg-card: #242424; --bg-hover: #2e2e2e;
      --border-default: #333333; --text-primary: #e5e5e5; --text-secondary: #a3a3a3;
      --accent-primary: #525252; --accent-light: #737373;
      --month-alt-bg: #161616;
    }
    [data-theme="slate"] {
      --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-card: #273549; --bg-hover: #334155;
      --border-default: #334155; --text-primary: #f1f5f9; --text-secondary: #94a3b8;
      --accent-primary: #6366f1; --accent-light: #818cf8;
      --month-alt-bg: #141c2e;
    }
    [data-theme="midnight"] {
      --bg-primary: #09090b; --bg-secondary: #0f0f12; --bg-card: #18181d; --bg-hover: #222228;
      --border-default: #27272f; --text-primary: #eeeef0; --text-secondary: #9898a4;
      --accent-primary: #8b5cf6; --accent-light: #a78bfa;
      --month-alt-bg: #0c0c0f;
    }
    [data-theme="navy"] {
      --bg-primary: #0a0e1a; --bg-secondary: #0f1526; --bg-card: #182035; --bg-hover: #1f2a45;
      --border-default: #253352; --text-primary: #e8ecf4; --text-secondary: #9aa5bd;
      --accent-primary: #4a7cc9; --accent-light: #6b9ae0;
      --month-alt-bg: #0c111e;
    }
    [data-theme="graphite"] {
      --bg-primary: #0d0d0d; --bg-secondary: #141414; --bg-card: #1f1f1f; --bg-hover: #292929;
      --border-default: #2e2e2e; --text-primary: #e8e8e8; --text-secondary: #999999;
      --accent-primary: #4a9eff; --accent-light: #6bb3ff;
      --month-alt-bg: #101010;
    }
    [data-theme="ocean"] {
      --bg-primary: #0a1214; --bg-secondary: #0e181c; --bg-card: #152228; --bg-hover: #1c2d35;
      --border-default: #243842; --text-primary: #e5f0f3; --text-secondary: #8faab5;
      --accent-primary: #14b8a6; --accent-light: #2dd4bf;
      --month-alt-bg: #0c1517;
    }
    [data-theme="forest"] {
      --bg-primary: #0a100c; --bg-secondary: #0f1812; --bg-card: #16221a; --bg-hover: #1e2e24;
      --border-default: #263830; --text-primary: #e5f0e8; --text-secondary: #8faa96;
      --accent-primary: #22c55e; --accent-light: #4ade80;
      --month-alt-bg: #0c130e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    html, body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow-x: hidden;
      user-select: none;
      -webkit-user-select: none;
    }

    body { padding-bottom: 165px; }

    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-default);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      gap: 12px;
    }

    .header-left { display: flex; align-items: center; gap: 12px; }

    .menu-btn, .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid var(--border-default);
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-appearance: none;
    }

    .header-title { font-size: 18px; font-weight: 700; }
    .header-actions { display: flex; gap: 4px; align-items: center; }

    .view-style-toggle {
      display: flex;
      gap: 4px;
      background: var(--bg-card);
      padding: 4px;
      border-radius: 10px;
      border: 1px solid var(--border-default);
    }

    .view-style-btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      -webkit-appearance: none;
    }

    .view-style-btn.active { background: var(--accent-primary); color: white; }

    .main-tabs {
      display: flex;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-default);
    }

    .main-tab {
      flex: 1;
      padding: 14px 12px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      -webkit-appearance: none;
    }

    .main-tab.active { color: var(--accent-light); border-bottom-color: var(--accent-primary); }

    .date-nav-container {
      display: none;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-default);
    }
    .date-nav-container.active { display: block; }

    .lanes-date-nav { padding: 12px 0; }

    .lanes-controls-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 16px 12px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .lanes-controls-row::-webkit-scrollbar { display: none; }

    .lanes-today-btn {
      flex-shrink: 0;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--accent-primary);
      background: var(--accent-primary);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      -webkit-appearance: none;
    }

    .lanes-filter-btn {
      flex-shrink: 0;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-default);
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      -webkit-appearance: none;
    }

    .lanes-filter-btn.active {
      background: color-mix(in srgb, var(--accent-primary) 20%, transparent);
      border-color: var(--accent-primary);
      color: var(--accent-light);
    }

    .lanes-filter-btn .count {
      background: var(--bg-hover);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
    }

    .expand-toggle-btn {
      flex-shrink: 0;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 1px solid var(--border-default);
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: auto;
      -webkit-appearance: none;
    }

    .expand-toggle-btn.expanded {
      background: color-mix(in srgb, var(--accent-primary) 30%, transparent);
      border-color: var(--accent-primary);
      color: var(--accent-light);
    }

    .lanes-date-chips {
      display: flex;
      gap: 6px;
      padding: 0 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x mandatory;
      overscroll-behavior-x: contain;
    }
    .lanes-date-chips::-webkit-scrollbar { display: none; }

    .month-section {
      display: flex;
      gap: 6px;
      padding: 8px;
      border-radius: 12px;
      margin-right: 4px;
      flex-shrink: 0;
    }

    .month-section.even { background: var(--bg-secondary); }
    .month-section.odd { background: var(--month-alt-bg); }

    .month-label {
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
      font-size: 9px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 4px 2px;
      opacity: 0.7;
    }

    .month-days { display: flex; gap: 6px; }

    .lanes-date-chip {
      flex-shrink: 0;
      padding: 8px 10px;
      border-radius: 10px;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 48px;
      -webkit-appearance: none;
      scroll-snap-align: center;
    }

    .lanes-date-chip.active { background: var(--accent-primary); border-color: var(--accent-primary); color: white; }
    .lanes-date-chip.today:not(.active) { border-color: var(--accent-light); border-width: 2px; }
    .lanes-date-chip .day-name { font-size: 9px; text-transform: uppercase; opacity: 0.8; }
    .lanes-date-chip .day-num { font-size: 16px; font-weight: 700; margin-top: 2px; }
    .lanes-date-chip .job-count { font-size: 8px; margin-top: 2px; opacity: 0.8; }

    /* Swipe container - Tinder style */
    .content-area {
      position: relative;
      overflow: hidden;
      min-height: calc(100vh - 350px);
    }

    .swipe-page {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      min-height: 100%;
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.35s ease;
      will-change: transform, opacity;
    }

    .swipe-page.current { transform: translateX(0); opacity: 1; z-index: 2; }
    .swipe-page.prev { transform: translateX(-100%); opacity: 0.5; z-index: 1; }
    .swipe-page.next { transform: translateX(100%); opacity: 0.5; z-index: 1; }
    .swipe-page.exit-left { transform: translateX(-100%); opacity: 0; }
    .swipe-page.exit-right { transform: translateX(100%); opacity: 0; }
    .swipe-page.enter-left { transform: translateX(-100%); opacity: 0; }
    .swipe-page.enter-right { transform: translateX(100%); opacity: 0; }
    .swipe-page.dragging { transition: none; }

    /* Edge indicators */
    .edge-indicator {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      width: 60px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--accent-light);
      background: linear-gradient(90deg, var(--accent-primary), transparent);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 200;
      border-radius: 0 12px 12px 0;
    }

    .edge-indicator.left { left: 0; }
    .edge-indicator.right { 
      right: 0; 
      background: linear-gradient(-90deg, var(--accent-primary), transparent);
      border-radius: 12px 0 0 12px;
    }
    .edge-indicator.active { opacity: 0.9; }
    .edge-indicator .date-preview { font-size: 11px; font-weight: 700; text-align: center; line-height: 1.3; }

    /* Lanes */
    .lanes-container { padding: 12px 0; }
    
    .tech-lane {
      margin-bottom: 8px;
      background: var(--bg-card);
      margin: 0 12px 8px;
      border-radius: 12px;
      border: 1px solid var(--border-default);
      overflow: hidden;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .tech-lane.drop-target {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px var(--accent-primary);
    }

    .lane-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      cursor: pointer;
    }

    .lane-header:active { background: var(--bg-hover); }
    .lane-info { display: flex; align-items: center; gap: 12px; }

    .tech-avatar {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--accent-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: white;
    }
    .tech-avatar.green { background: #22c55e; }
    .tech-avatar.orange { background: #f97316; }
    .tech-avatar.purple { background: #8b5cf6; }

    .tech-details h3 { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
    .tech-details span { font-size: 12px; color: var(--text-secondary); }

    .lane-header-right { display: flex; align-items: center; gap: 16px; }
    .lane-stats { display: flex; gap: 16px; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 16px; font-weight: 700; }
    .stat-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; }

    .lane-expand-icon { font-size: 14px; color: var(--text-secondary); transition: transform 0.2s; }
    .tech-lane.expanded .lane-expand-icon { transform: rotate(180deg); }

    .lane-cards-wrapper {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .tech-lane.expanded .lane-cards-wrapper { max-height: 500px; }

    .lane-cards {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 0 16px 12px;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;
    }
    .lane-cards::-webkit-scrollbar { display: none; }

    /* Work Order Card */
    .wo-card {
      flex-shrink: 0;
      width: 200px;
      background: var(--bg-secondary);
      border-radius: 10px;
      border: 1px solid var(--border-default);
      padding: 10px 12px;
      cursor: grab;
      position: relative;
      border-left: 4px solid var(--accent-primary);
      touch-action: none;
    }

    .wo-card:active { cursor: grabbing; }
    .wo-card.status-in_progress { border-left-color: var(--accent-primary); }
    .wo-card.status-waiting { border-left-color: #eab308; }
    .wo-card.status-completed { border-left-color: #22c55e; }
    .wo-card.status-urgent { border-left-color: #ef4444; }

    .wo-card.fleet::after {
      content: 'FLEET';
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 7px;
      font-weight: 700;
      padding: 2px 4px;
      border-radius: 3px;
      background: #14b8a6;
      color: white;
    }

    .wo-card.dragging { opacity: 0.5; transform: scale(0.95); }

    .card-time { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; }
    .card-customer {
      font-size: 14px; font-weight: 600; margin-bottom: 4px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      padding-right: 35px;
    }

    .card-info-row { display: flex; align-items: center; gap: 6px; }
    .card-vehicle {
      font-size: 11px; color: var(--text-secondary);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;
    }
    .card-dot { width: 3px; height: 3px; border-radius: 50%; background: var(--text-secondary); }

    .card-status {
      font-size: 9px; font-weight: 600; text-transform: uppercase;
      padding: 2px 5px; border-radius: 4px;
    }
    .card-status.in_progress { background: rgba(59,130,246,0.2); color: var(--accent-light); }
    .card-status.waiting { background: rgba(234,179,8,0.15); color: #eab308; }
    .card-status.completed { background: rgba(34,197,94,0.15); color: #22c55e; }
    .card-status.urgent { background: rgba(239,68,68,0.15); color: #ef4444; }
    .card-status.scheduled { background: var(--bg-hover); color: var(--text-secondary); }

    .card-amount { font-size: 12px; font-weight: 700; margin-left: auto; }

    .add-card {
      flex-shrink: 0;
      width: 70px;
      min-height: 60px;
      background: var(--bg-primary);
      border-radius: 10px;
      border: 2px dashed var(--border-default);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
    }
    .add-card-icon {
      width: 22px; height: 22px; border-radius: 6px;
      background: var(--bg-hover);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; color: var(--text-secondary);
    }
    .add-card span { font-size: 9px; color: var(--text-secondary); }

    /* Drag ghost */
    .drag-ghost {
      position: fixed;
      z-index: 1000;
      pointer-events: none;
      opacity: 0.9;
      transform: scale(1.05) rotate(2deg);
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state-text { font-size: 16px; }

    /* Mobile buttons */
    .mobile-action-buttons {
      position: fixed;
      bottom: 102px;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-default);
      padding: 8px 8px 0 8px;
      z-index: 101;
    }

    .mobile-action-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 6px;
    }

    .mobile-action-btn {
      padding: 10px 8px;
      border-radius: 8px;
      background: color-mix(in srgb, var(--accent-primary) 10%, transparent);
      border: 1px solid color-mix(in srgb, var(--accent-primary) 30%, transparent);
      color: var(--accent-light);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-appearance: none;
    }
    .mobile-action-btn.active {
      background: color-mix(in srgb, var(--accent-primary) 60%, transparent);
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .mobile-bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-default);
      padding: 8px;
      z-index: 100;
    }

    .mobile-nav-top { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-bottom: 6px; }
    .mobile-nav-secondary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }

    .mobile-nav-btn {
      padding: 10px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-default);
      background: var(--bg-card);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 44px;
    }

    .mobile-nav-btn.related {
      background: color-mix(in srgb, var(--accent-primary) 10%, transparent);
      border-color: color-mix(in srgb, var(--accent-primary) 30%, transparent);
      color: var(--text-primary);
    }

    @supports not (background: color-mix(in srgb, red 50%, blue)) {
      .mobile-nav-btn.related, .mobile-action-btn { background: var(--bg-hover); }
      .lanes-filter-btn.active { background: var(--bg-hover); }
      .expand-toggle-btn.expanded { background: var(--accent-primary); }
    }

    .toast {
      position: fixed;
      bottom: 200px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--accent-primary);
      color: var(--text-primary);
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      z-index: 1000;
      display: none;
    }
    .toast.show { display: block; animation: toastIn 0.3s ease; }
    @keyframes toastIn {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="header-top">
    <div class="header-left">
      <button class="menu-btn" onclick="location.href='dashboard-service.html'">‚Üê</button>
      <h1 class="header-title">Scheduler</h1>
    </div>
    <div class="header-actions">
      <div class="view-style-toggle">
        <button class="view-style-btn active" id="styleLanes" onclick="setViewStyle('lanes')">Lanes</button>
        <button class="view-style-btn" id="styleStack" onclick="setViewStyle('stack')">Stack</button>
        <button class="view-style-btn" id="styleGrid" onclick="setViewStyle('grid')">Grid</button>
      </div>
      <button class="icon-btn" onclick="cycleTheme()">üé®</button>
    </div>
  </div>
</header>

<div class="main-tabs">
  <button class="main-tab active" id="tabService" onclick="switchTab('service')">Service</button>
  <button class="main-tab" id="tabSales" onclick="switchTab('sales')">Sales</button>
  <button class="main-tab" id="tabFleet" onclick="switchTab('fleet')">Fleet</button>
</div>

<div class="date-nav-container active" id="lanesDateNav">
  <div class="lanes-date-nav">
    <div class="lanes-controls-row" id="lanesControlsRow"></div>
    <div class="lanes-date-chips" id="lanesDateChips"></div>
  </div>
</div>

<div class="edge-indicator left" id="edgeLeft"><div class="date-preview" id="edgeLeftPreview">‚Üê</div></div>
<div class="edge-indicator right" id="edgeRight"><div class="date-preview" id="edgeRightPreview">‚Üí</div></div>

<div class="content-area" id="contentArea">
  <div class="swipe-page current" id="currentPage"></div>
  <div class="swipe-page prev" id="prevPage"></div>
  <div class="swipe-page next" id="nextPage"></div>
</div>

<div class="mobile-action-buttons">
  <div class="mobile-action-grid">
    <button class="mobile-action-btn" onclick="location.href='work-order-new.html'">+ Work Order</button>
    <button class="mobile-action-btn active">Scheduler</button>
    <button class="mobile-action-btn" onclick="location.href='appointment-new.html'">+ Appointment</button>
  </div>
</div>

<nav class="mobile-bottom-nav">
  <div class="mobile-nav-top">
    <button class="mobile-nav-btn related" onclick="location.href='dashboard-business.html'">Business</button>
    <button class="mobile-nav-btn" onclick="location.href='dashboard-search.html'">Search</button>
  </div>
  <div class="mobile-nav-secondary">
    <button class="mobile-nav-btn related" onclick="location.href='dashboard-service.html'">Service</button>
    <button class="mobile-nav-btn related" onclick="location.href='dashboard-parts.html'">Parts</button>
    <button class="mobile-nav-btn related" onclick="location.href='dashboard-sales.html'">Sales</button>
  </div>
</nav>

<div class="toast" id="toast"></div>

<script>
var technicians = [
  { id: 'mike', name: 'Mike Rodriguez', role: 'Master Tech', bay: 'Bay 1', initials: 'MR', color: '' },
  { id: 'tom', name: 'Tom Jackson', role: 'Senior Tech', bay: 'Bay 2', initials: 'TJ', color: 'green' },
  { id: 'alex', name: 'Alex Lee', role: 'Technician', bay: 'Bay 3', initials: 'AL', color: 'orange' },
  { id: 'unassigned', name: 'Unassigned', role: 'Drag to assign', bay: '', initials: '?', color: 'purple' }
];

var serviceJobs = [
  { id: 'WO-2847', customer: 'James Wilson', vehicle: 'Ford F-150', time: '8:00 AM', status: 'in_progress', tech: 'mike', amount: '$485', date: 0, fleet: false },
  { id: 'WO-2851', customer: 'Sarah Chen', vehicle: 'Tesla Model Y', time: '10:30 AM', status: 'waiting', tech: 'mike', amount: '$890', date: 0, fleet: false },
  { id: 'WO-2856', customer: 'Robert Martinez', vehicle: 'Chevy Silverado', time: '1:00 PM', status: 'scheduled', tech: 'mike', amount: '$245', date: 0, fleet: false },
  { id: 'WO-2860', customer: 'Emily Thompson', vehicle: 'Honda CR-V', time: '3:30 PM', status: 'scheduled', tech: 'mike', amount: '$320', date: 0, fleet: false },
  { id: 'WO-2845', customer: 'David Kim', vehicle: 'BMW X5', time: '8:00 AM', status: 'completed', tech: 'tom', amount: '$125', date: 0, fleet: false },
  { id: 'WO-2849', customer: 'Maria Garcia', vehicle: 'Toyota Camry', time: '9:30 AM', status: 'in_progress', tech: 'tom', amount: '$1,250', date: 0, fleet: false },
  { id: 'WO-2862', customer: "Kevin O'Brien", vehicle: 'Jeep Wrangler', time: '2:00 PM', status: 'urgent', tech: 'tom', amount: 'TBD', date: 0, fleet: false },
  { id: 'WO-2844', customer: 'Lisa Brown', vehicle: 'Mazda CX-5', time: '8:30 AM', status: 'completed', tech: 'alex', amount: '$185', date: 0, fleet: false },
  { id: 'WO-2853', customer: 'Chris Taylor', vehicle: 'Audi Q7', time: '11:00 AM', status: 'in_progress', tech: 'alex', amount: '$395', date: 0, fleet: false },
  { id: 'WO-2858', customer: 'Amanda White', vehicle: 'Hyundai Tucson', time: '2:30 PM', status: 'scheduled', tech: 'alex', amount: '$0', date: 0, fleet: false },
  { id: 'WO-2864', customer: 'Michael Chang', vehicle: 'Kia Telluride', time: 'TBD', status: 'scheduled', tech: 'unassigned', amount: '$220', date: 0, fleet: false },
  { id: 'WO-2865', customer: 'Jennifer Lopez', vehicle: 'Lexus RX', time: 'TBD', status: 'waiting', tech: 'unassigned', amount: '$400', date: 0, fleet: false },
  { id: 'WO-2870', customer: 'Tom Hanks', vehicle: 'Mercedes GLE', time: '9:00 AM', status: 'scheduled', tech: 'mike', amount: '$550', date: 1, fleet: false },
  { id: 'WO-2871', customer: 'Jane Doe', vehicle: 'Volvo XC90', time: '10:00 AM', status: 'scheduled', tech: 'tom', amount: '$320', date: 1, fleet: false },
  { id: 'WO-2875', customer: 'Bob Smith', vehicle: 'Porsche Cayenne', time: '8:00 AM', status: 'scheduled', tech: 'alex', amount: '$780', date: 2, fleet: false },
  { id: 'WO-2880', customer: 'Alice Wonder', vehicle: 'Subaru Outback', time: '9:00 AM', status: 'scheduled', tech: 'mike', amount: '$290', date: 3, fleet: false },
  { id: 'WO-2881', customer: 'John Wick', vehicle: 'Ford Mustang', time: '11:00 AM', status: 'scheduled', tech: 'tom', amount: '$650', date: 5, fleet: false }
];

var fleetJobs = [
  { id: 'FL-1001', customer: 'ABC Trucking', vehicle: 'Freightliner #101', time: '7:00 AM', status: 'in_progress', tech: 'mike', amount: '$1,200', date: 0, fleet: true },
  { id: 'FL-1002', customer: 'ABC Trucking', vehicle: 'Freightliner #102', time: '8:00 AM', status: 'scheduled', tech: 'tom', amount: '$850', date: 0, fleet: true },
  { id: 'FL-1003', customer: 'City Transit', vehicle: 'Bus #45', time: '9:00 AM', status: 'waiting', tech: 'alex', amount: '$2,100', date: 0, fleet: true },
  { id: 'FL-1004', customer: 'ABC Trucking', vehicle: 'Freightliner #103', time: '1:00 PM', status: 'scheduled', tech: 'unassigned', amount: '$950', date: 0, fleet: true },
  { id: 'FL-1010', customer: 'City Transit', vehicle: 'Bus #46', time: '8:00 AM', status: 'scheduled', tech: 'mike', amount: '$1,800', date: 1, fleet: true },
  { id: 'FL-1011', customer: 'XYZ Logistics', vehicle: 'Van #22', time: '10:00 AM', status: 'scheduled', tech: 'tom', amount: '$450', date: 1, fleet: true }
];

var salesAppointments = [
  { id: 'SA-501', customer: 'Mark Johnson', time: '9:00 AM', type: 'Test Drive', vehicle: '2024 Honda Accord', salesperson: 'John Smith', status: 'confirmed', date: 0 },
  { id: 'SA-502', customer: 'Linda Williams', time: '10:30 AM', type: 'New Purchase', vehicle: '2024 Toyota RAV4', salesperson: 'Sarah Davis', status: 'confirmed', date: 0 },
  { id: 'SA-503', customer: 'Steve Rogers', time: '1:00 PM', type: 'Trade-In', vehicle: '2024 Ford Bronco', salesperson: 'John Smith', status: 'scheduled', date: 0 },
  { id: 'SA-504', customer: 'Nancy Drew', time: '3:00 PM', type: 'Financing', vehicle: '2024 Chevy Equinox', salesperson: 'Sarah Davis', status: 'scheduled', date: 0 }
];

var currentTab = 'service';
var currentViewStyle = 'lanes';
var selectedDate = 0;
var currentFilter = 'all';
var lanesExpanded = false;

var themes = ['dark-blue','grey','slate','midnight','navy','graphite','ocean','forest'];
var themeIndex = 0;

function loadTheme() {
  var t = localStorage.getItem('app-theme') || 'dark-blue';
  document.documentElement.setAttribute('data-theme', t);
  themeIndex = themes.indexOf(t);
  if (themeIndex < 0) themeIndex = 0;
}

function cycleTheme() {
  themeIndex = (themeIndex + 1) % themes.length;
  document.documentElement.setAttribute('data-theme', themes[themeIndex]);
  localStorage.setItem('app-theme', themes[themeIndex]);
  showToast('Theme: ' + themes[themeIndex]);
}

loadTheme();

var savedExpand = localStorage.getItem('lanes-expanded');
if (savedExpand === 'true') lanesExpanded = true;

function setViewStyle(style) {
  currentViewStyle = style;
  document.querySelectorAll('.view-style-btn').forEach(function(b) { b.classList.remove('active'); });
  document.getElementById('style' + style.charAt(0).toUpperCase() + style.slice(1)).classList.add('active');
  localStorage.setItem('scheduler-view-style', style);
  renderAll();
  showToast(style.charAt(0).toUpperCase() + style.slice(1) + ' view');
}

var savedStyle = localStorage.getItem('scheduler-view-style');
if (savedStyle && ['lanes', 'stack', 'grid'].indexOf(savedStyle) !== -1) {
  currentViewStyle = savedStyle;
}

function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.main-tab').forEach(function(b) { b.classList.remove('active'); });
  document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
  currentFilter = 'all';
  renderAll();
}

function toggleExpandPreference() {
  lanesExpanded = !lanesExpanded;
  localStorage.setItem('lanes-expanded', lanesExpanded ? 'true' : 'false');
  renderLanesControls();
  renderPages();
}

function renderLanesControls() {
  var jobs = getJobsForDateOffset(selectedDate);
  var all = jobs.length;
  var waiting = jobs.filter(function(j) { return j.status === 'waiting'; }).length;
  var done = jobs.filter(function(j) { return j.status === 'completed'; }).length;
  
  var expandIcon = lanesExpanded ? '‚ñº' : '‚òê';
  var expandClass = lanesExpanded ? ' expanded' : '';
  
  var html = '<button class="lanes-today-btn" onclick="goToToday()">Today</button>';
  html += '<button class="lanes-filter-btn ' + (currentFilter === 'all' ? 'active' : '') + '" onclick="setFilter(\'all\')">All <span class="count">' + all + '</span></button>';
  html += '<button class="lanes-filter-btn ' + (currentFilter === 'waiting' ? 'active' : '') + '" onclick="setFilter(\'waiting\')">Waiting <span class="count">' + waiting + '</span></button>';
  html += '<button class="lanes-filter-btn ' + (currentFilter === 'completed' ? 'active' : '') + '" onclick="setFilter(\'completed\')">Done <span class="count">' + done + '</span></button>';
  html += '<button class="expand-toggle-btn' + expandClass + '" onclick="toggleExpandPreference()">' + expandIcon + '</button>';
  
  document.getElementById('lanesControlsRow').innerHTML = html;
}

function goToToday() {
  selectedDate = 0;
  renderAll();
  setTimeout(centerOnToday, 50);
  showToast('Today');
}

function centerOnToday() {
  var container = document.getElementById('lanesDateChips');
  var todayChip = document.getElementById('today-chip');
  if (todayChip && container) {
    var containerWidth = container.offsetWidth;
    var chipLeft = todayChip.offsetLeft;
    var chipWidth = todayChip.offsetWidth;
    var scrollTarget = chipLeft - (containerWidth / 2) + (chipWidth / 2);
    container.scrollLeft = scrollTarget;
  }
}

function renderLanesDateChips() {
  var container = document.getElementById('lanesDateChips');
  var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var today = new Date();
  var startOffset = -60;
  var endOffset = 120;
  var monthGroups = {};
  var monthOrder = [];
  
  for (var i = startOffset; i < endOffset; i++) {
    var d = new Date(today);
    d.setDate(d.getDate() + i);
    var monthKey = d.getFullYear() + '-' + d.getMonth();
    
    if (!monthGroups[monthKey]) {
      monthGroups[monthKey] = { month: d.getMonth(), year: d.getFullYear(), label: months[d.getMonth()], days: [] };
      monthOrder.push(monthKey);
    }
    
    monthGroups[monthKey].days.push({ offset: i, date: d, dayName: days[d.getDay()], dayNum: d.getDate(), isToday: i === 0 });
  }
  
  var html = '';
  var monthIndex = 0;
  
  for (var k = 0; k < monthOrder.length; k++) {
    var key = monthOrder[k];
    var group = monthGroups[key];
    var evenOdd = monthIndex % 2 === 0 ? 'even' : 'odd';
    
    html += '<div class="month-section ' + evenOdd + '">';
    html += '<div class="month-label">' + group.label + '</div>';
    html += '<div class="month-days">';
    
    for (var j = 0; j < group.days.length; j++) {
      var day = group.days[j];
      var jobCount = getJobsForDateOffset(day.offset).length;
      var isActive = day.offset === selectedDate;
      var classes = 'lanes-date-chip';
      if (isActive) classes += ' active';
      if (day.isToday) classes += ' today';
      var idAttr = day.isToday ? ' id="today-chip"' : '';
      
      html += '<button class="' + classes + '"' + idAttr + ' onclick="selectDate(' + day.offset + ')">';
      html += '<span class="day-name">' + day.dayName + '</span>';
      html += '<span class="day-num">' + day.dayNum + '</span>';
      if (jobCount > 0) html += '<span class="job-count">' + jobCount + '</span>';
      html += '</button>';
    }
    
    html += '</div></div>';
    monthIndex++;
  }
  
  container.innerHTML = html;
}

function selectDate(offset) {
  var direction = offset > selectedDate ? 'left' : 'right';
  animateToDate(offset, direction);
}

function setFilter(f) {
  currentFilter = f;
  renderLanesControls();
  renderPages();
}

function getDateLabel(offset) {
  if (offset === 0) return 'Today';
  if (offset === 1) return 'Tomorrow';
  if (offset === -1) return 'Yesterday';
  var today = new Date();
  var d = new Date(today);
  d.setDate(d.getDate() + offset);
  return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
}

function getJobsForDateOffset(offset) {
  var jobs = [];
  if (currentTab === 'service') {
    jobs = serviceJobs.filter(function(j) { return j.date === offset; });
  } else if (currentTab === 'fleet') {
    jobs = fleetJobs.filter(function(j) { return j.date === offset; });
  } else {
    jobs = salesAppointments.filter(function(a) { return a.date === offset; });
  }
  return jobs;
}

function getTechById(id) {
  for (var i = 0; i < technicians.length; i++) {
    if (technicians[i].id === id) return technicians[i];
  }
  return { id: id, name: id, initials: '?', color: 'purple' };
}

var statusLabels = { 'in_progress': 'Active', 'waiting': 'Parts', 'completed': 'Done', 'urgent': 'Urgent', 'scheduled': 'Scheduled', 'confirmed': 'Confirmed' };

function toggleLane(techId, dateOffset) {
  var lane = document.getElementById('lane-' + techId + '-' + dateOffset);
  if (lane) lane.classList.toggle('expanded');
}

function renderLanesView(dateOffset) {
  var jobs = getJobsForDateOffset(dateOffset);
  if (currentFilter !== 'all') {
    jobs = jobs.filter(function(j) { return j.status === currentFilter; });
  }
  
  if (jobs.length === 0) return '<div class="empty-state"><div class="empty-state-icon">üîß</div><div class="empty-state-text">No jobs for ' + getDateLabel(dateOffset) + '</div></div>';
  
  var html = '<div class="lanes-container">';
  technicians.forEach(function(tech) {
    var techJobs = jobs.filter(function(j) { return j.tech === tech.id; });
    var hours = (techJobs.length * 1.5).toFixed(1);
    var expandedClass = lanesExpanded ? ' expanded' : '';
    
    html += '<div class="tech-lane' + expandedClass + '" id="lane-' + tech.id + '-' + dateOffset + '" data-tech="' + tech.id + '" data-date="' + dateOffset + '">';
    html += '<div class="lane-header" onclick="toggleLane(\'' + tech.id + '\', ' + dateOffset + ')">';
    html += '<div class="lane-info">';
    html += '<div class="tech-avatar ' + tech.color + '">' + tech.initials + '</div>';
    html += '<div class="tech-details"><h3>' + tech.name + '</h3><span>' + tech.role + (tech.bay ? ' ‚Ä¢ ' + tech.bay : '') + '</span></div></div>';
    html += '<div class="lane-header-right">';
    html += '<div class="lane-stats"><div class="stat-item"><div class="stat-value">' + techJobs.length + '</div><div class="stat-label">Jobs</div></div>';
    html += '<div class="stat-item"><div class="stat-value">' + hours + 'h</div><div class="stat-label">Booked</div></div></div>';
    html += '<span class="lane-expand-icon">‚ñº</span>';
    html += '</div></div>';
    html += '<div class="lane-cards-wrapper"><div class="lane-cards">';
    techJobs.forEach(function(j) {
      html += '<div class="wo-card status-' + j.status + (j.fleet ? ' fleet' : '') + '" data-job-id="' + j.id + '" data-tech="' + j.tech + '" data-date="' + j.date + '">';
      html += '<div class="card-time">' + j.time + '</div><div class="card-customer">' + j.customer + '</div>';
      html += '<div class="card-info-row"><span class="card-vehicle">' + j.vehicle + '</span><span class="card-dot"></span>';
      html += '<span class="card-status ' + j.status + '">' + (statusLabels[j.status] || j.status) + '</span>';
      html += '<span class="card-amount">' + j.amount + '</span></div></div>';
    });
    html += '<div class="add-card" onclick="event.stopPropagation(); location.href=\'work-order-new.html\'"><div class="add-card-icon">+</div><span>Add</span></div>';
    html += '</div></div></div>';
  });
  html += '</div>';
  return html;
}

function renderPages() {
  document.getElementById('currentPage').innerHTML = renderLanesView(selectedDate);
  document.getElementById('prevPage').innerHTML = renderLanesView(selectedDate - 1);
  document.getElementById('nextPage').innerHTML = renderLanesView(selectedDate + 1);
  setupDragAndDrop();
}

function renderAll() {
  renderLanesControls();
  renderLanesDateChips();
  renderPages();
}

// Tinder-style swipe animation
function animateToDate(newDate, direction) {
  var currentPage = document.getElementById('currentPage');
  var prevPage = document.getElementById('prevPage');
  var nextPage = document.getElementById('nextPage');
  
  if (direction === 'left') {
    // Going forward - current exits left, next becomes current
    currentPage.className = 'swipe-page exit-left';
    nextPage.className = 'swipe-page current';
  } else {
    // Going backward - current exits right, prev becomes current
    currentPage.className = 'swipe-page exit-right';
    prevPage.className = 'swipe-page current';
  }
  
  setTimeout(function() {
    selectedDate = newDate;
    
    // Reset classes
    currentPage.className = 'swipe-page current';
    prevPage.className = 'swipe-page prev';
    nextPage.className = 'swipe-page next';
    
    // Update content
    renderAll();
    
    // Scroll date chips
    var container = document.getElementById('lanesDateChips');
    var activeChip = container.querySelector('.lanes-date-chip.active');
    if (activeChip) {
      activeChip.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    }
  }, 350);
  
  showToast(getDateLabel(newDate));
}

// Swipe handling
var contentArea = document.getElementById('contentArea');
var currentPage = document.getElementById('currentPage');
var swipeStartX = 0;
var swipeStartY = 0;
var swipeCurrentX = 0;
var isSwiping = false;
var swipeThreshold = 80;
var isInsideLaneCards = false;

contentArea.addEventListener('touchstart', function(e) {
  if (isDragging) return;
  
  // Check if touch started inside lane-cards (expanded tech row)
  var target = e.target;
  isInsideLaneCards = false;
  while (target && target !== contentArea) {
    if (target.classList && target.classList.contains('lane-cards')) {
      // Check if parent lane is expanded
      var lane = target.closest('.tech-lane');
      if (lane && lane.classList.contains('expanded')) {
        isInsideLaneCards = true;
        break;
      }
    }
    target = target.parentElement;
  }
  
  if (isInsideLaneCards) return; // Let native scroll handle it
  
  swipeStartX = e.touches[0].clientX;
  swipeStartY = e.touches[0].clientY;
  swipeCurrentX = swipeStartX;
  isSwiping = true;
  
  currentPage.classList.add('dragging');
}, { passive: true });

contentArea.addEventListener('touchmove', function(e) {
  if (!isSwiping || isDragging || isInsideLaneCards) return;
  
  var touchX = e.touches[0].clientX;
  var touchY = e.touches[0].clientY;
  
  // Check if vertical scroll is dominant
  var deltaX = Math.abs(touchX - swipeStartX);
  var deltaY = Math.abs(touchY - swipeStartY);
  
  if (deltaY > deltaX && deltaY > 10) {
    // Vertical scroll - cancel swipe
    isSwiping = false;
    currentPage.classList.remove('dragging');
    currentPage.style.transform = '';
    currentPage.style.opacity = '';
    return;
  }
  
  swipeCurrentX = touchX;
  var diff = swipeCurrentX - swipeStartX;
  
  // Apply transform with resistance
  var resistance = 0.4;
  currentPage.style.transform = 'translateX(' + (diff * resistance) + 'px)';
  currentPage.style.opacity = 1 - Math.abs(diff) / window.innerWidth * 0.3;
}, { passive: true });

contentArea.addEventListener('touchend', function(e) {
  if (!isSwiping || isDragging || isInsideLaneCards) {
    isInsideLaneCards = false;
    return;
  }
  
  isSwiping = false;
  currentPage.classList.remove('dragging');
  
  var diff = swipeCurrentX - swipeStartX;
  
  // Reset styles
  currentPage.style.transform = '';
  currentPage.style.opacity = '';
  
  if (diff > swipeThreshold) {
    // Swipe right - go to previous day
    animateToDate(selectedDate - 1, 'right');
  } else if (diff < -swipeThreshold) {
    // Swipe left - go to next day
    animateToDate(selectedDate + 1, 'left');
  }
});

// Drag and Drop
var isDragging = false;
var draggedJob = null;
var dragGhost = null;
var dragStartX = 0;
var dragStartY = 0;
var edgeScrollInterval = null;
var currentDragDate = 0;

function setupDragAndDrop() {
  var cards = document.querySelectorAll('.wo-card');
  cards.forEach(function(card) {
    card.addEventListener('touchstart', onDragStart, { passive: false });
  });
}

function onDragStart(e) {
  var card = e.currentTarget;
  var touch = e.touches[0];
  
  dragStartX = touch.clientX;
  dragStartY = touch.clientY;
  
  var holdTimer = setTimeout(function() {
    isDragging = true;
    draggedJob = {
      id: card.dataset.jobId,
      tech: card.dataset.tech,
      date: parseInt(card.dataset.date)
    };
    currentDragDate = selectedDate;
    
    card.classList.add('dragging');
    
    dragGhost = card.cloneNode(true);
    dragGhost.classList.add('drag-ghost');
    dragGhost.style.width = card.offsetWidth + 'px';
    document.body.appendChild(dragGhost);
    
    positionGhost(touch.clientX, touch.clientY);
    
    navigator.vibrate && navigator.vibrate(50);
  }, 400);
  
  var moveHandler = function(ev) {
    var t = ev.touches[0];
    if (Math.abs(t.clientX - dragStartX) > 10 || Math.abs(t.clientY - dragStartY) > 10) {
      clearTimeout(holdTimer);
      card.removeEventListener('touchmove', moveHandler);
    }
  };
  
  card.addEventListener('touchmove', moveHandler, { passive: true });
  
  card.addEventListener('touchend', function endHandler() {
    clearTimeout(holdTimer);
    card.removeEventListener('touchmove', moveHandler);
    card.removeEventListener('touchend', endHandler);
  });
}

document.addEventListener('touchmove', function(e) {
  if (!isDragging) return;
  e.preventDefault();
  
  var touch = e.touches[0];
  positionGhost(touch.clientX, touch.clientY);
  
  checkEdgeScroll(touch.clientX);
  highlightDropTarget(touch.clientX, touch.clientY);
}, { passive: false });

document.addEventListener('touchend', function(e) {
  if (!isDragging) return;
  
  clearInterval(edgeScrollInterval);
  edgeScrollInterval = null;
  
  document.getElementById('edgeLeft').classList.remove('active');
  document.getElementById('edgeRight').classList.remove('active');
  
  var lanes = document.querySelectorAll('.tech-lane');
  lanes.forEach(function(l) { l.classList.remove('drop-target'); });
  
  var touch = e.changedTouches[0];
  var dropTarget = findDropTarget(touch.clientX, touch.clientY);
  
  if (dropTarget && draggedJob) {
    var newTech = dropTarget.dataset.tech;
    var newDate = currentDragDate;
    
    if (newTech !== draggedJob.tech || newDate !== draggedJob.date) {
      updateJobAssignment(draggedJob.id, newTech, newDate);
      showToast('Moved to ' + getTechById(newTech).name + ' on ' + getDateLabel(newDate));
    }
  }
  
  if (dragGhost) {
    dragGhost.remove();
    dragGhost = null;
  }
  
  var draggingCards = document.querySelectorAll('.wo-card.dragging');
  draggingCards.forEach(function(c) { c.classList.remove('dragging'); });
  
  isDragging = false;
  draggedJob = null;
  
  renderAll();
});

function positionGhost(x, y) {
  if (!dragGhost) return;
  dragGhost.style.left = (x - 100) + 'px';
  dragGhost.style.top = (y - 40) + 'px';
}

function checkEdgeScroll(x) {
  var screenWidth = window.innerWidth;
  var edgeZone = 60;
  var leftEdge = document.getElementById('edgeLeft');
  var rightEdge = document.getElementById('edgeRight');
  
  if (x < edgeZone) {
    leftEdge.classList.add('active');
    document.getElementById('edgeLeftPreview').innerHTML = getDateLabel(currentDragDate - 1);
    
    if (!edgeScrollInterval) {
      edgeScrollInterval = setInterval(function() {
        currentDragDate--;
        document.getElementById('edgeLeftPreview').innerHTML = getDateLabel(currentDragDate - 1);
        navigator.vibrate && navigator.vibrate(20);
      }, 500);
    }
  } else if (x > screenWidth - edgeZone) {
    rightEdge.classList.add('active');
    document.getElementById('edgeRightPreview').innerHTML = getDateLabel(currentDragDate + 1);
    
    if (!edgeScrollInterval) {
      edgeScrollInterval = setInterval(function() {
        currentDragDate++;
        document.getElementById('edgeRightPreview').innerHTML = getDateLabel(currentDragDate + 1);
        navigator.vibrate && navigator.vibrate(20);
      }, 500);
    }
  } else {
    leftEdge.classList.remove('active');
    rightEdge.classList.remove('active');
    if (edgeScrollInterval) {
      clearInterval(edgeScrollInterval);
      edgeScrollInterval = null;
    }
  }
}

function highlightDropTarget(x, y) {
  var lanes = document.querySelectorAll('.tech-lane');
  lanes.forEach(function(lane) {
    var rect = lane.getBoundingClientRect();
    if (y >= rect.top && y <= rect.bottom) {
      lane.classList.add('drop-target');
    } else {
      lane.classList.remove('drop-target');
    }
  });
}

function findDropTarget(x, y) {
  var lanes = document.querySelectorAll('.tech-lane');
  for (var i = 0; i < lanes.length; i++) {
    var rect = lanes[i].getBoundingClientRect();
    if (y >= rect.top && y <= rect.bottom) {
      return lanes[i];
    }
  }
  return null;
}

function updateJobAssignment(jobId, newTech, newDate) {
  for (var i = 0; i < serviceJobs.length; i++) {
    if (serviceJobs[i].id === jobId) {
      serviceJobs[i].tech = newTech;
      serviceJobs[i].date = newDate;
      return;
    }
  }
  
  for (var i = 0; i < fleetJobs.length; i++) {
    if (fleetJobs[i].id === jobId) {
      fleetJobs[i].tech = newTech;
      fleetJobs[i].date = newDate;
      return;
    }
  }
}

function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2000);
}

function init() {
  document.querySelectorAll('.view-style-btn').forEach(function(b) { b.classList.remove('active'); });
  document.getElementById('style' + currentViewStyle.charAt(0).toUpperCase() + currentViewStyle.slice(1)).classList.add('active');
  
  renderAll();
  
  requestAnimationFrame(function() {
    requestAnimationFrame(function() {
      centerOnToday();
    });
  });
}

init();
</script>
</body>
</html>
