<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Key Test - WorkLogicPro</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:monospace;
      background:#0a0e1a;
      color:#e8eef6;
      padding:40px;
    }
    .test {
      background:#0f1621;
      border:1px solid #223044;
      border-radius:12px;
      padding:20px;
      margin-bottom:20px;
    }
    h2 { color:#60a5fa; margin-bottom:12px; }
    button {
      padding:12px 24px;
      background:#2563eb;
      border:none;
      border-radius:8px;
      color:#fff;
      cursor:pointer;
      margin:8px 8px 8px 0;
    }
    button:hover { background:#1d4ed8; }
    .result {
      margin-top:12px;
      padding:12px;
      border-radius:8px;
    }
    .success { background:#064e3b; border:1px solid #065f46; color:#a7f3d0; }
    .error { background:#7f1d1d; border:1px solid #991b1b; color:#fecaca; }
    pre {
      background:#1a2535;
      padding:8px;
      border-radius:6px;
      overflow-x:auto;
      font-size:11px;
      margin:8px 0;
    }
  </style>
</head>
<body>

<h1 style="margin-bottom:24px;">üîç API Key Test</h1>

<div class="test">
  <h2>Key 1 (From Dashboard/Work Orders)</h2>
  <pre>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMzMzUzNDcsImV4cCI6MjA0ODkxMTM0N30.lXiCI05K9r_1vd6qPn-bXWzRJjQgs38geg71uxiv4CU</pre>
  <button onclick="testKey1()">Test Key 1</button>
  <div id="result1"></div>
</div>

<div class="test">
  <h2>Key 2 (From Original Login)</h2>
  <pre>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4</pre>
  <button onclick="testKey2()">Test Key 2</button>
  <div id="result2"></div>
</div>

<div class="test">
  <h2>Test Login</h2>
  <input type="email" id="email" placeholder="Email" style="width:100%;padding:12px;background:#1a2535;border:1px solid #223044;border-radius:8px;color:#fff;margin:8px 0;">
  <input type="password" id="password" placeholder="Password" style="width:100%;padding:12px;background:#1a2535;border:1px solid #223044;border-radius:8px;color:#fff;margin:8px 0;">
  <button onclick="testLogin(1)">Try Login with Key 1</button>
  <button onclick="testLogin(2)">Try Login with Key 2</button>
  <div id="loginResult"></div>
</div>

<script>
  const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
  const API_BASE = `https://${PROJECT_REF}.supabase.co`;
  
  const KEY1 = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMzMzUzNDcsImV4cCI6MjA0ODkxMTM0N30.lXiCI05K9r_1vd6qPn-bXWzRJjQgs38geg71uxiv4CU";
  const KEY2 = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4";

  async function testKey1() {
    const output = document.getElementById('result1');
    output.innerHTML = '<div style="color:#9fb0c3;">Testing...</div>';
    
    try {
      console.log('Testing Key 1...');
      const res = await fetch(`${API_BASE}/rest/v1/`, {
        headers: { "apikey": KEY1 }
      });
      
      console.log('Key 1 response:', res.status);
      
      if (res.ok) {
        output.innerHTML = '<div class="result success">‚úÖ Key 1 WORKS! Use this key.</div>';
      } else {
        const error = await res.text();
        output.innerHTML = `<div class="result error">‚ùå Key 1 failed: ${res.status}<br><pre>${error}</pre></div>`;
      }
    } catch (err) {
      console.error('Key 1 error:', err);
      output.innerHTML = `<div class="result error">‚ùå Key 1 error: ${err.message}</div>`;
    }
  }

  async function testKey2() {
    const output = document.getElementById('result2');
    output.innerHTML = '<div style="color:#9fb0c3;">Testing...</div>';
    
    try {
      console.log('Testing Key 2...');
      const res = await fetch(`${API_BASE}/rest/v1/`, {
        headers: { "apikey": KEY2 }
      });
      
      console.log('Key 2 response:', res.status);
      
      if (res.ok) {
        output.innerHTML = '<div class="result success">‚úÖ Key 2 WORKS! Use this key.</div>';
      } else {
        const error = await res.text();
        output.innerHTML = `<div class="result error">‚ùå Key 2 failed: ${res.status}<br><pre>${error}</pre></div>`;
      }
    } catch (err) {
      console.error('Key 2 error:', err);
      output.innerHTML = `<div class="result error">‚ùå Key 2 error: ${err.message}</div>`;
    }
  }

  async function testLogin(keyNum) {
    const output = document.getElementById('loginResult');
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    if (!email || !password) {
      output.innerHTML = '<div class="result error">‚ùå Enter email and password</div>';
      return;
    }
    
    const key = keyNum === 1 ? KEY1 : KEY2;
    output.innerHTML = `<div style="color:#9fb0c3;">Testing login with Key ${keyNum}...</div>`;
    
    try {
      console.log(`Testing login with Key ${keyNum}...`);
      const res = await fetch(`${API_BASE}/auth/v1/token?grant_type=password`, {
        method: "POST",
        headers: { 
          "Content-Type": "application/json", 
          "apikey": key 
        },
        body: JSON.stringify({ email, password })
      });
      
      console.log(`Login response with Key ${keyNum}:`, res.status);
      const data = await res.json();
      console.log('Response data:', data);
      
      if (res.ok && data.access_token) {
        output.innerHTML = `<div class="result success">‚úÖ LOGIN SUCCESSFUL WITH KEY ${keyNum}!<br>Use Key ${keyNum} in all your pages.<br><pre>Token: ${data.access_token.substring(0, 50)}...</pre></div>`;
      } else {
        output.innerHTML = `<div class="result error">‚ùå Login failed with Key ${keyNum}: ${data.error_description || data.error || res.status}<br><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
      }
    } catch (err) {
      console.error(`Login error with Key ${keyNum}:`, err);
      output.innerHTML = `<div class="result error">‚ùå Error with Key ${keyNum}: ${err.message}</div>`;
    }
  }
</script>

</body>
</html>
