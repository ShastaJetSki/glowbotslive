<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - WorkLogicPro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --accent: #60a5fa;
      --bg: #0b0f14;
      --surface: #0f1621;
      --card: #1a2535;
      --text: #e8eef6;
      --text-secondary: #9fb0c3;
      --text-muted: #6b7280;
      --border: #223044;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --purple: #8b5cf6;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .business-name {
      font-size: 14px;
      color: var(--primary);
    }

    .header-nav {
      display: flex;
      gap: 8px;
    }

    .header-nav a {
      padding: 8px 16px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .header-nav a:hover { background: var(--card); color: var(--text); }
    .header-nav a.active { background: var(--primary); color: #fff; }

    .logout-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      border-color: var(--red);
      color: var(--red);
    }

    /* Main Content */
    .main-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    .page-title {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      margin-bottom: 32px;
    }

    /* Settings Navigation */
    .settings-nav {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .settings-nav-btn {
      padding: 10px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-nav-btn:hover { border-color: var(--primary); color: var(--text); }
    .settings-nav-btn.active { background: var(--primary); border-color: var(--primary); color: #fff; }

    /* Cards */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .card-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Section Toggle */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Form Elements */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-success {
      background: var(--green);
      color: #fff;
    }

    .btn-success:hover {
      filter: brightness(1.1);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-outline:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--red);
      color: var(--red);
    }

    .btn-danger:hover {
      background: var(--red);
      color: #fff;
    }

    /* ============================================ */
    /* EMPLOYEE CARDS */
    /* ============================================ */
    .employee-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .employee-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.2s;
    }

    .employee-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .employee-photo-container {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 16px;
    }

    .employee-photo {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: 700;
      color: #fff;
      border: 3px solid var(--border);
      overflow: hidden;
    }

    .employee-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .employee-photo-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }

    .photo-action-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s;
    }

    .photo-action-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .photo-action-btn.delete:hover {
      border-color: var(--red);
      color: var(--red);
      background: rgba(239, 68, 68, 0.1);
    }

    .employee-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .employee-role {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .role-owner { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .role-manager { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
    .role-technician { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .role-sales { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .role-parts { background: rgba(236, 72, 153, 0.2); color: #f472b6; }
    .role-service_advisor { background: rgba(20, 184, 166, 0.2); color: #2dd4bf; }

    .employee-details {
      text-align: left;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .employee-detail-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 6px 0;
    }

    .employee-detail-label {
      color: var(--text-muted);
    }

    .employee-detail-value {
      font-weight: 600;
      color: var(--text);
    }

    .employee-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 16px;
    }

    .employee-stat {
      background: var(--surface);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }

    .employee-stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .employee-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .employee-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .employee-actions .btn {
      flex: 1;
      padding: 8px 12px;
      font-size: 13px;
    }

    /* Add Employee Card */
    .add-employee-card {
      background: var(--card);
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .add-employee-card:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
    }

    .add-employee-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(59, 130, 246, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: var(--primary);
      margin-bottom: 16px;
    }

    .add-employee-text {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    /* ============================================ */
    /* PROMOTIONS SECTION */
    /* ============================================ */
    .promo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }

    .promo-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .promo-card:hover {
      border-color: var(--primary);
    }

    .promo-header {
      padding: 16px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%);
      color: #fff;
    }

    .promo-badge {
      display: inline-block;
      padding: 4px 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .promo-title {
      font-size: 18px;
      font-weight: 700;
    }

    .promo-discount {
      font-size: 28px;
      font-weight: 800;
      margin-top: 8px;
    }

    .promo-body {
      padding: 16px;
    }

    .promo-detail {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    .promo-detail:last-child {
      border-bottom: none;
    }

    .promo-detail-label {
      color: var(--text-muted);
    }

    .promo-detail-value {
      font-weight: 600;
    }

    .promo-code {
      background: var(--surface);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-top: 12px;
    }

    .promo-code-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .promo-code-value {
      font-size: 18px;
      font-weight: 700;
      font-family: monospace;
      color: var(--green);
      letter-spacing: 2px;
    }

    .promo-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .promo-actions .btn {
      flex: 1;
      font-size: 13px;
    }

    .promo-status {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .status-active { background: rgba(16, 185, 129, 0.2); color: var(--green); }
    .status-scheduled { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
    .status-expired { background: rgba(107, 114, 128, 0.2); color: var(--text-muted); }

    /* Add Promo Card */
    .add-promo-card {
      background: var(--card);
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 280px;
    }

    .add-promo-card:hover {
      border-color: var(--green);
      background: rgba(16, 185, 129, 0.05);
    }

    /* ============================================ */
    /* MEDIA SECTION */
    /* ============================================ */
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .media-upload-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .media-upload-label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .media-preview {
      width: 100%;
      height: 120px;
      border: 2px dashed var(--border);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      overflow: hidden;
      background: var(--surface);
    }

    .media-preview:hover {
      border-color: var(--primary);
    }

    .media-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .media-preview-icon {
      font-size: 32px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .media-preview-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    .media-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .media-actions .btn {
      flex: 1;
      font-size: 12px;
      padding: 8px 12px;
    }

    .media-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* Social Links */
    .social-links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .social-link-item {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .social-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .social-icon.facebook { background: #1877f2; color: #fff; }
    .social-icon.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: #fff; }
    .social-icon.google { background: #4285f4; color: #fff; }
    .social-icon.yelp { background: #d32323; color: #fff; }
    .social-icon.website { background: var(--primary); color: #fff; }
    .social-icon.tiktok { background: #000; color: #fff; }

    .social-link-item input {
      flex: 1;
      padding: 10px 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
    }

    /* Toggle Switch */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: var(--card);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .toggle-info h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .toggle-info p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: 0.3s;
      border-radius: 26px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--green);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* Alert */
    .alert {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 24px;
      border-radius: 8px;
      font-weight: 600;
      display: none;
      z-index: 1001;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .alert.show { display: block; }
    .alert.success { background: var(--green); color: #fff; }
    .alert.error { background: var(--red); color: #fff; }

    /* Mobile */
    @media (max-width: 768px) {
      .header-nav { display: none; }
      .settings-nav { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 8px; }
      .employee-grid, .promo-grid, .media-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <h1>Settings</h1>
        <div class="business-name" id="businessName">Loading...</div>
      </div>
      <div class="header-nav">
        <a href="dashboard-business.html">Dashboard</a>
        <a href="dashboard-customer-search.html">Customers</a>
        <a href="dashboard-vehicle-search.html">Vehicles</a>
        <a href="dashboard-scheduling.html">Scheduling</a>
        <a href="dashboard-settings.html" class="active">Settings</a>
      </div>
      <button class="logout-btn" onclick="logout()">Sign Out</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <h1 class="page-title">Business Settings</h1>
    <p class="page-subtitle">Manage your business configuration, team, promotions, and media</p>

    <!-- Settings Navigation -->
    <div class="settings-nav">
      <button class="settings-nav-btn active" onclick="showSection('general')">‚öôÔ∏è General</button>
      <button class="settings-nav-btn" onclick="showSection('employees')">üë• Employees</button>
      <button class="settings-nav-btn" onclick="showSection('promotions')">üéÅ Promotions</button>
      <button class="settings-nav-btn" onclick="showSection('media')">üñºÔ∏è Media & Branding</button>
      <button class="settings-nav-btn" onclick="showSection('notifications')">üîî Notifications</button>
    </div>

    <!-- ============================================ -->
    <!-- GENERAL SECTION -->
    <!-- ============================================ -->
    <div id="section-general" class="section active">
      <!-- Business Info -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--primary);">üè¢</span>
              Business Information
            </div>
            <div class="card-subtitle">Your business contact details</div>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Business Name</label>
            <input type="text" id="bizName" placeholder="Your Business Name">
          </div>
          <div class="form-group">
            <label>Contact Name</label>
            <input type="text" id="bizContact" placeholder="Owner/Manager Name">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="bizEmail" placeholder="contact@business.com">
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="bizPhone" placeholder="(555) 555-5555">
          </div>
          <div class="form-group" style="grid-column: span 2;">
            <label>Address</label>
            <input type="text" id="bizAddress" placeholder="Street Address">
          </div>
          <div class="form-group">
            <label>City, State, ZIP</label>
            <input type="text" id="bizCityState" placeholder="City, ST 12345">
          </div>
        </div>
      </div>

      <!-- Rates & Pricing -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--green);">üí∞</span>
              Rates & Pricing
            </div>
            <div class="card-subtitle">Default labor rates and tax settings</div>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Labor Rate ($/hour)</label>
            <input type="number" id="laborRate" step="0.01" placeholder="95.00">
          </div>
          <div class="form-group">
            <label>Tax Rate (%)</label>
            <input type="number" id="taxRate" step="0.01" placeholder="8.5">
          </div>
          <div class="form-group">
            <label>Parts Markup (%)</label>
            <input type="number" id="partsMarkup" step="0.01" placeholder="35">
          </div>
          <div class="form-group">
            <label>Shop Supplies Fee (%)</label>
            <input type="number" id="shopFee" step="0.01" placeholder="3">
          </div>
        </div>
      </div>

      <button class="btn btn-success" onclick="saveGeneralSettings()" style="width: 100%;">
        üíæ Save General Settings
      </button>
    </div>

    <!-- ============================================ -->
    <!-- EMPLOYEES SECTION -->
    <!-- ============================================ -->
    <div id="section-employees" class="section">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(139, 92, 246, 0.1); color: var(--purple);">üë•</span>
              Team Members
            </div>
            <div class="card-subtitle">Manage your employees, roles, and assignments</div>
          </div>
          <button class="btn btn-primary" onclick="openEmployeeModal()">+ Add Employee</button>
        </div>

        <div class="employee-grid" id="employeeGrid">
          <!-- Employee cards will be loaded here -->
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- PROMOTIONS SECTION -->
    <!-- ============================================ -->
    <div id="section-promotions" class="section">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--yellow);">üéÅ</span>
              Active Promotions
            </div>
            <div class="card-subtitle">Manage discounts, coupons, and special offers</div>
          </div>
          <button class="btn btn-primary" onclick="openPromoModal()">+ Create Promotion</button>
        </div>

        <div class="promo-grid" id="promoGrid">
          <!-- Promo cards will be loaded here -->
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="card">
        <div class="card-title" style="margin-bottom: 16px;">üìä Promotion Performance</div>
        <div class="form-grid">
          <div style="background: var(--card); padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--green);" id="promoRedeemed">0</div>
            <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Times Redeemed</div>
          </div>
          <div style="background: var(--card); padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--primary);" id="promoRevenue">$0</div>
            <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Revenue Generated</div>
          </div>
          <div style="background: var(--card); padding: 20px; border-radius: 8px; text-align: center;">
            <div style="font-size: 28px; font-weight: 700; color: var(--yellow);" id="promoActive">0</div>
            <div style="font-size: 12px; color: var(--text-muted); text-transform: uppercase;">Active Promos</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- MEDIA & BRANDING SECTION -->
    <!-- ============================================ -->
    <div id="section-media" class="section">
      <!-- Logo & Images -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(236, 72, 153, 0.1); color: #ec4899;">üñºÔ∏è</span>
              Business Logo & Images
            </div>
            <div class="card-subtitle">Upload your branding assets</div>
          </div>
        </div>

        <div class="media-grid">
          <!-- Business Logo -->
          <div class="media-upload-card">
            <div class="media-upload-label">üìå Business Logo</div>
            <div class="media-preview" onclick="triggerUpload('logoUpload')">
              <div class="media-preview-icon">üè¢</div>
              <div class="media-preview-text">Click to upload logo</div>
            </div>
            <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="previewImage(this, 'logoPreview')">
            <div class="media-hint">Recommended: 200x200px, PNG or SVG</div>
            <div class="media-actions">
              <button class="btn btn-outline" onclick="triggerUpload('logoUpload')">üì§ Upload</button>
              <button class="btn btn-danger" onclick="removeImage('logo')">üóëÔ∏è Remove</button>
            </div>
          </div>

          <!-- Invoice Header -->
          <div class="media-upload-card">
            <div class="media-upload-label">üìÑ Invoice Header Image</div>
            <div class="media-preview" onclick="triggerUpload('invoiceUpload')">
              <div class="media-preview-icon">üìã</div>
              <div class="media-preview-text">Click to upload</div>
            </div>
            <input type="file" id="invoiceUpload" accept="image/*" style="display: none;">
            <div class="media-hint">Appears at top of invoices. Recommended: 600x100px</div>
            <div class="media-actions">
              <button class="btn btn-outline" onclick="triggerUpload('invoiceUpload')">üì§ Upload</button>
              <button class="btn btn-danger">üóëÔ∏è Remove</button>
            </div>
          </div>

          <!-- Email Header -->
          <div class="media-upload-card">
            <div class="media-upload-label">‚úâÔ∏è Email Header Image</div>
            <div class="media-preview" onclick="triggerUpload('emailUpload')">
              <div class="media-preview-icon">üìß</div>
              <div class="media-preview-text">Click to upload</div>
            </div>
            <input type="file" id="emailUpload" accept="image/*" style="display: none;">
            <div class="media-hint">Used in customer email notifications. Recommended: 600x150px</div>
            <div class="media-actions">
              <button class="btn btn-outline" onclick="triggerUpload('emailUpload')">üì§ Upload</button>
              <button class="btn btn-danger">üóëÔ∏è Remove</button>
            </div>
          </div>

          <!-- Receipt Footer -->
          <div class="media-upload-card">
            <div class="media-upload-label">üßæ Receipt Footer</div>
            <div class="media-preview" onclick="triggerUpload('receiptUpload')">
              <div class="media-preview-icon">üñ®Ô∏è</div>
              <div class="media-preview-text">Click to upload</div>
            </div>
            <input type="file" id="receiptUpload" accept="image/*" style="display: none;">
            <div class="media-hint">Appears at bottom of printed receipts</div>
            <div class="media-actions">
              <button class="btn btn-outline" onclick="triggerUpload('receiptUpload')">üì§ Upload</button>
              <button class="btn btn-danger">üóëÔ∏è Remove</button>
            </div>
          </div>

          <!-- Photo Watermark -->
          <div class="media-upload-card">
            <div class="media-upload-label">üíß Photo Watermark</div>
            <div class="media-preview" onclick="triggerUpload('watermarkUpload')">
              <div class="media-preview-icon">üîí</div>
              <div class="media-preview-text">Click to upload</div>
            </div>
            <input type="file" id="watermarkUpload" accept="image/*" style="display: none;">
            <div class="media-hint">Watermark for work order photos. Recommended: Transparent PNG</div>
            <div class="media-actions">
              <button class="btn btn-outline" onclick="triggerUpload('watermarkUpload')">üì§ Upload</button>
              <button class="btn btn-danger">üóëÔ∏è Remove</button>
            </div>
          </div>

          <!-- QR Code -->
          <div class="media-upload-card">
            <div class="media-upload-label">üì± Review QR Code</div>
            <div class="media-preview" style="background: #fff;">
              <div class="media-preview-icon" style="color: #000;">‚¨ú</div>
              <div class="media-preview-text" style="color: #666;">Auto-generated from Google link</div>
            </div>
            <div class="media-hint">Customers can scan to leave a Google review</div>
            <div class="media-actions">
              <button class="btn btn-primary" onclick="generateQRCode()">üîÑ Generate QR</button>
              <button class="btn btn-outline">üì• Download</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Social Links -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--primary);">üîó</span>
              Social Media & Links
            </div>
            <div class="card-subtitle">Connect your online presence</div>
          </div>
        </div>

        <div class="social-links-grid">
          <div class="social-link-item">
            <div class="social-icon website">üåê</div>
            <input type="url" id="linkWebsite" placeholder="https://yourwebsite.com">
          </div>
          <div class="social-link-item">
            <div class="social-icon facebook">f</div>
            <input type="url" id="linkFacebook" placeholder="https://facebook.com/yourbusiness">
          </div>
          <div class="social-link-item">
            <div class="social-icon instagram">üì∑</div>
            <input type="url" id="linkInstagram" placeholder="https://instagram.com/yourbusiness">
          </div>
          <div class="social-link-item">
            <div class="social-icon google">G</div>
            <input type="url" id="linkGoogle" placeholder="https://g.page/yourbusiness">
          </div>
          <div class="social-link-item">
            <div class="social-icon yelp">Y</div>
            <input type="url" id="linkYelp" placeholder="https://yelp.com/biz/yourbusiness">
          </div>
          <div class="social-link-item">
            <div class="social-icon tiktok">‚ô™</div>
            <input type="url" id="linkTiktok" placeholder="https://tiktok.com/@yourbusiness">
          </div>
        </div>

        <button class="btn btn-success" onclick="saveSocialLinks()" style="width: 100%; margin-top: 20px;">
          üíæ Save Social Links
        </button>
      </div>

      <!-- Branding Options -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(139, 92, 246, 0.1); color: var(--purple);">üé®</span>
              Branding Options
            </div>
            <div class="card-subtitle">Customize how your business appears</div>
          </div>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Show Logo on Invoices</h4>
            <p>Display your business logo at the top of all invoices</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleInvoiceLogo" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Watermark Work Order Photos</h4>
            <p>Add your watermark to all photos attached to work orders</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleWatermark">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Include Social Links in Emails</h4>
            <p>Add social media icons to customer email footers</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleSocialEmails" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Show QR Code on Receipts</h4>
            <p>Print Google review QR code on receipts</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleQRReceipt" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- NOTIFICATIONS SECTION -->
    <!-- ============================================ -->
    <div id="section-notifications" class="section">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-title-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--green);">üîî</span>
              Notification Preferences
            </div>
            <div class="card-subtitle">Control what notifications you and your customers receive</div>
          </div>
        </div>

        <h4 style="margin-bottom: 16px; color: var(--text-secondary);">Customer Notifications</h4>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Work Order Created</h4>
            <p>Email customer when a new work order is created for their vehicle</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Ready for Pickup</h4>
            <p>Notify customer when their vehicle is ready to pick up</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Invoice Sent</h4>
            <p>Email invoice copy to customer automatically</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Service Reminders</h4>
            <p>Send automated service reminder emails</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <h4 style="margin: 24px 0 16px; color: var(--text-secondary);">Staff Notifications</h4>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>New Work Order Assigned</h4>
            <p>Notify technician when a work order is assigned to them</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Low Inventory Alert</h4>
            <p>Notify parts manager when parts fall below minimum stock</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="toggle-row">
          <div class="toggle-info">
            <h4>Daily Summary Email</h4>
            <p>Send daily business summary to owners/managers</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Employee Modal -->
  <div id="employeeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="employeeModalTitle">Add Employee</h3>
        <button class="modal-close" onclick="closeEmployeeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Photo</label>
          <div style="display: flex; align-items: center; gap: 16px;">
            <div id="empPhotoPreview" style="width: 80px; height: 80px; border-radius: 50%; background: var(--card); border: 2px dashed var(--border); display: flex; align-items: center; justify-content: center; font-size: 32px; color: var(--text-muted); overflow: hidden;">
              üë§
            </div>
            <div>
              <button class="btn btn-outline" onclick="triggerUpload('empPhotoUpload')" style="font-size: 12px;">üì∑ Upload Photo</button>
              <input type="file" id="empPhotoUpload" accept="image/*" style="display: none;">
              <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Max 2MB, JPG or PNG</div>
            </div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label>First Name *</label>
            <input type="text" id="empFirstName" required>
          </div>
          <div class="form-group">
            <label>Last Name *</label>
            <input type="text" id="empLastName" required>
          </div>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="empEmail" required>
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" id="empPhone" placeholder="(555) 555-5555">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label>Role *</label>
            <select id="empRole" required>
              <option value="technician">Technician</option>
              <option value="manager">Manager</option>
              <option value="service_advisor">Service Advisor</option>
              <option value="parts_manager">Parts Manager</option>
              <option value="sales">Sales</option>
            </select>
          </div>
          <div class="form-group">
            <label>Hourly Rate ($)</label>
            <input type="number" id="empRate" step="0.01" placeholder="65.00">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeEmployeeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEmployee()">Save Employee</button>
      </div>
    </div>
  </div>

  <!-- Promotion Modal -->
  <div id="promoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create Promotion</h3>
        <button class="modal-close" onclick="closePromoModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Promotion Name *</label>
          <input type="text" id="promoName" placeholder="Summer Special">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="promoDesc" placeholder="Get 20% off all brake services..."></textarea>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label>Discount Type *</label>
            <select id="promoType">
              <option value="percent">Percentage Off</option>
              <option value="fixed">Fixed Amount Off</option>
              <option value="free_service">Free Service</option>
            </select>
          </div>
          <div class="form-group">
            <label>Discount Value *</label>
            <input type="number" id="promoValue" step="0.01" placeholder="20">
          </div>
        </div>
        <div class="form-group">
          <label>Promo Code</label>
          <input type="text" id="promoCode" placeholder="SUMMER20" style="text-transform: uppercase;">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label>Start Date</label>
            <input type="date" id="promoStart">
          </div>
          <div class="form-group">
            <label>End Date</label>
            <input type="date" id="promoEnd">
          </div>
        </div>
        <div class="form-group">
          <label>Usage Limit (0 = unlimited)</label>
          <input type="number" id="promoLimit" value="0">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closePromoModal()">Cancel</button>
        <button class="btn btn-primary" onclick="savePromotion()">Create Promotion</button>
      </div>
    </div>
  </div>

  <!-- Alert -->
  <div id="alert" class="alert"></div>

<script>
const SUPABASE_URL = 'https://kxqkwpkmtgvmthpafoqx.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';

const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let employees = [];
let promotions = [];
let workOrders = [];
let currentSection = 'general';

// ============================================
// AUTH
// ============================================
async function checkAuth() {
  let { data: { session } } = await sb.auth.getSession();
  
  if (!session) {
    const token = localStorage.getItem('sb_access_token');
    const refreshToken = localStorage.getItem('sb_refresh_token');
    
    if (token && refreshToken) {
      const { data, error } = await sb.auth.setSession({
        access_token: token,
        refresh_token: refreshToken
      });
      if (error || !data.session) {
        window.location.href = 'login-worklogic.html';
        return null;
      }
      return data.session;
    }
    window.location.href = 'login-worklogic.html';
    return null;
  }
  return session;
}

async function logout() {
  await sb.auth.signOut();
  localStorage.removeItem('sb_access_token');
  localStorage.removeItem('sb_refresh_token');
  Object.keys(localStorage).forEach(key => {
    if (key.startsWith('sb-')) localStorage.removeItem(key);
  });
  window.location.href = 'login-worklogic.html?logout=1';
}

// ============================================
// SECTION NAVIGATION
// ============================================
function showSection(section) {
  currentSection = section;
  
  // Update nav buttons
  document.querySelectorAll('.settings-nav-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.textContent.toLowerCase().includes(section)) {
      btn.classList.add('active');
    }
  });
  
  // Show/hide sections
  document.querySelectorAll('.section').forEach(sec => {
    sec.classList.remove('active');
  });
  document.getElementById(`section-${section}`).classList.add('active');
}

// ============================================
// EMPLOYEES
// ============================================
function renderEmployees() {
  const grid = document.getElementById('employeeGrid');
  
  if (employees.length === 0) {
    grid.innerHTML = `
      <div class="add-employee-card" onclick="openEmployeeModal()">
        <div class="add-employee-icon">+</div>
        <div class="add-employee-text">Add Your First Employee</div>
      </div>
    `;
    return;
  }
  
  let html = employees.map(emp => {
    const initials = `${(emp.first_name || '?')[0]}${(emp.last_name || '?')[0]}`.toUpperCase();
    const fullName = `${emp.first_name || ''} ${emp.last_name || ''}`.trim();
    const role = emp.role || 'employee';
    const roleDisplay = role.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
    const rate = emp.hourly_labor_rate ? `$${parseFloat(emp.hourly_labor_rate).toFixed(2)}/hr` : '‚Äî';
    
    // Count work orders
    const assignedWOs = workOrders.filter(wo => wo.assigned_to === emp.employee_id).length;
    const completedWOs = workOrders.filter(wo => wo.assigned_to === emp.employee_id && (wo.status === 'completed' || wo.status === 'closed')).length;
    
    return `
      <div class="employee-card">
        <div class="employee-photo-container">
          <div class="employee-photo">
            ${emp.photo_url ? `<img src="${emp.photo_url}" alt="${fullName}">` : initials}
          </div>
          <div class="employee-photo-actions">
            <button class="photo-action-btn" onclick="editEmployee('${emp.employee_id}')" title="Edit">‚úèÔ∏è</button>
            <button class="photo-action-btn delete" onclick="deleteEmployee('${emp.employee_id}', '${fullName}')" title="Delete">üóëÔ∏è</button>
          </div>
        </div>
        
        <div class="employee-name">${fullName}</div>
        <div class="employee-role role-${role}">${roleDisplay}</div>
        
        <div class="employee-details">
          <div class="employee-detail-row">
            <span class="employee-detail-label">Email</span>
            <span class="employee-detail-value" style="font-size: 12px;">${emp.email || '‚Äî'}</span>
          </div>
          <div class="employee-detail-row">
            <span class="employee-detail-label">Phone</span>
            <span class="employee-detail-value">${emp.phone || '‚Äî'}</span>
          </div>
          <div class="employee-detail-row">
            <span class="employee-detail-label">Rate</span>
            <span class="employee-detail-value" style="color: var(--green);">${rate}</span>
          </div>
        </div>
        
        <div class="employee-stats">
          <div class="employee-stat">
            <div class="employee-stat-value">${assignedWOs}</div>
            <div class="employee-stat-label">Assigned</div>
          </div>
          <div class="employee-stat">
            <div class="employee-stat-value" style="color: var(--green);">${completedWOs}</div>
            <div class="employee-stat-label">Completed</div>
          </div>
        </div>
        
        <div class="employee-actions">
          <button class="btn btn-outline" onclick="viewEmployeeDetails('${emp.employee_id}')">üìã Details</button>
          <button class="btn btn-primary" onclick="editEmployee('${emp.employee_id}')">‚úèÔ∏è Edit</button>
        </div>
      </div>
    `;
  }).join('');
  
  // Add the "Add Employee" card at the end
  html += `
    <div class="add-employee-card" onclick="openEmployeeModal()">
      <div class="add-employee-icon">+</div>
      <div class="add-employee-text">Add Employee</div>
    </div>
  `;
  
  grid.innerHTML = html;
}

function openEmployeeModal() {
  document.getElementById('employeeModalTitle').textContent = 'Add Employee';
  document.getElementById('empFirstName').value = '';
  document.getElementById('empLastName').value = '';
  document.getElementById('empEmail').value = '';
  document.getElementById('empPhone').value = '';
  document.getElementById('empRole').value = 'technician';
  document.getElementById('empRate').value = '';
  document.getElementById('employeeModal').classList.add('show');
}

function closeEmployeeModal() {
  document.getElementById('employeeModal').classList.remove('show');
}

function editEmployee(empId) {
  const emp = employees.find(e => e.employee_id === empId);
  if (!emp) return;
  
  document.getElementById('employeeModalTitle').textContent = 'Edit Employee';
  document.getElementById('empFirstName').value = emp.first_name || '';
  document.getElementById('empLastName').value = emp.last_name || '';
  document.getElementById('empEmail').value = emp.email || '';
  document.getElementById('empPhone').value = emp.phone || '';
  document.getElementById('empRole').value = emp.role || 'technician';
  document.getElementById('empRate').value = emp.hourly_labor_rate || '';
  document.getElementById('employeeModal').classList.add('show');
}

async function saveEmployee() {
  showAlert('Employee saved!', 'success');
  closeEmployeeModal();
}

async function deleteEmployee(empId, name) {
  if (!confirm(`Remove ${name} from your team?`)) return;
  showAlert(`${name} removed`, 'success');
  employees = employees.filter(e => e.employee_id !== empId);
  renderEmployees();
}

function viewEmployeeDetails(empId) {
  const emp = employees.find(e => e.employee_id === empId);
  if (!emp) return;
  alert(`Details for ${emp.first_name} ${emp.last_name}\n\nRole: ${emp.role}\nEmail: ${emp.email}\nRate: $${emp.hourly_labor_rate}/hr`);
}

// ============================================
// PROMOTIONS
// ============================================
function renderPromotions() {
  const grid = document.getElementById('promoGrid');
  
  // Demo promotions
  const demoPromos = [
    {
      id: 1,
      name: 'Summer Special',
      description: '20% off all brake services',
      type: 'percent',
      value: 20,
      code: 'SUMMER20',
      start_date: '2024-06-01',
      end_date: '2024-08-31',
      status: 'active',
      uses: 47,
      revenue: 8450
    },
    {
      id: 2,
      name: 'New Customer',
      description: '$50 off first service over $200',
      type: 'fixed',
      value: 50,
      code: 'WELCOME50',
      start_date: '2024-01-01',
      end_date: '2024-12-31',
      status: 'active',
      uses: 123,
      revenue: 24600
    },
    {
      id: 3,
      name: 'Oil Change Special',
      description: 'Free tire rotation with any oil change',
      type: 'free_service',
      value: 0,
      code: 'FREEROTATE',
      start_date: '2024-07-01',
      end_date: '2024-07-31',
      status: 'expired',
      uses: 89,
      revenue: 3560
    }
  ];
  
  let html = demoPromos.map(promo => {
    const discountDisplay = promo.type === 'percent' ? `${promo.value}% OFF` :
                            promo.type === 'fixed' ? `$${promo.value} OFF` : 'FREE SERVICE';
    
    return `
      <div class="promo-card">
        <div class="promo-header" style="${promo.status === 'expired' ? 'background: #374151;' : ''}">
          <div class="promo-badge">${promo.status === 'active' ? 'üî• Active' : '‚è∞ Expired'}</div>
          <div class="promo-title">${promo.name}</div>
          <div class="promo-discount">${discountDisplay}</div>
        </div>
        <div class="promo-body">
          <div class="promo-detail">
            <span class="promo-detail-label">Description</span>
            <span class="promo-detail-value">${promo.description}</span>
          </div>
          <div class="promo-detail">
            <span class="promo-detail-label">Valid</span>
            <span class="promo-detail-value">${promo.start_date} - ${promo.end_date}</span>
          </div>
          <div class="promo-detail">
            <span class="promo-detail-label">Times Used</span>
            <span class="promo-detail-value" style="color: var(--green);">${promo.uses}</span>
          </div>
          <div class="promo-detail">
            <span class="promo-detail-label">Revenue</span>
            <span class="promo-detail-value" style="color: var(--primary);">$${promo.revenue.toLocaleString()}</span>
          </div>
          
          <div class="promo-code">
            <div class="promo-code-label">Promo Code</div>
            <div class="promo-code-value">${promo.code}</div>
          </div>
          
          <div class="promo-actions">
            <button class="btn btn-outline">‚úèÔ∏è Edit</button>
            <button class="btn btn-danger">üóëÔ∏è Delete</button>
          </div>
        </div>
      </div>
    `;
  }).join('');
  
  // Add "Create Promotion" card
  html += `
    <div class="add-promo-card" onclick="openPromoModal()">
      <div class="add-employee-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--green);">+</div>
      <div class="add-employee-text">Create New Promotion</div>
    </div>
  `;
  
  grid.innerHTML = html;
  
  // Update stats
  const activePromos = demoPromos.filter(p => p.status === 'active').length;
  const totalRedeemed = demoPromos.reduce((sum, p) => sum + p.uses, 0);
  const totalRevenue = demoPromos.reduce((sum, p) => sum + p.revenue, 0);
  
  document.getElementById('promoActive').textContent = activePromos;
  document.getElementById('promoRedeemed').textContent = totalRedeemed;
  document.getElementById('promoRevenue').textContent = '$' + totalRevenue.toLocaleString();
}

function openPromoModal() {
  document.getElementById('promoModal').classList.add('show');
}

function closePromoModal() {
  document.getElementById('promoModal').classList.remove('show');
}

function savePromotion() {
  showAlert('Promotion created!', 'success');
  closePromoModal();
}

// ============================================
// MEDIA
// ============================================
function triggerUpload(inputId) {
  document.getElementById(inputId).click();
}

function removeImage(type) {
  showAlert(`${type} image removed`, 'success');
}

function generateQRCode() {
  showAlert('QR Code generated!', 'success');
}

function saveSocialLinks() {
  showAlert('Social links saved!', 'success');
}

// ============================================
// GENERAL SETTINGS
// ============================================
async function loadBusinessSettings() {
  const { data } = await sb.from('business_settings').select('*').single();
  if (data) {
    document.getElementById('businessName').textContent = data.business_name || '';
    document.getElementById('bizName').value = data.business_name || '';
    document.getElementById('bizContact').value = data.contact_name || '';
    document.getElementById('bizEmail').value = data.contact_email || '';
    document.getElementById('bizPhone').value = data.contact_phone || '';
    document.getElementById('bizAddress').value = data.address || '';
    document.getElementById('bizCityState').value = data.business_city_state_zip || '';
    document.getElementById('laborRate').value = data.labor_rate || '';
    document.getElementById('taxRate').value = data.local_tax || '';
    document.getElementById('partsMarkup').value = data.parts_markup || '';
  }
}

function saveGeneralSettings() {
  showAlert('General settings saved!', 'success');
}

// ============================================
// UTILITIES
// ============================================
function showAlert(message, type) {
  const alert = document.getElementById('alert');
  alert.textContent = message;
  alert.className = `alert ${type} show`;
  setTimeout(() => alert.classList.remove('show'), 3000);
}

// ============================================
// INIT
// ============================================
async function load() {
  const session = await checkAuth();
  if (!session) return;
  
  await loadBusinessSettings();
  
  // Load employees
  const { data: empData } = await sb.from('employees').select('*');
  employees = empData || [];
  
  // Load work orders for employee stats
  const { data: woData } = await sb.from('work_orders').select('*');
  workOrders = woData || [];
  
  renderEmployees();
  renderPromotions();
}

load();
</script>

</body>
</html>
