CREATE TABLE IF NOT EXISTS event_members (
  member_id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  tenant_id UUID NOT NULL,
  first_name TEXT NOT NULL,
  last_name TEXT,
  role TEXT,
  role_level TEXT DEFAULT 'team' CHECK (role_level IN ('admin','manager','team')),
  phone TEXT,
  email TEXT,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE event_members ENABLE ROW LEVEL SECURITY;

CREATE POLICY "event_members_all" ON event_members FOR ALL USING (true) WITH CHECK (true);

CREATE INDEX IF NOT EXISTS idx_event_members_tenant ON event_members(tenant_id);

CREATE TABLE IF NOT EXISTS event_task_line_items (
  line_item_id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  tenant_id UUID NOT NULL,
  event_task_id UUID REFERENCES event_tasks(event_task_id) ON DELETE CASCADE,
  description TEXT NOT NULL,
  amount NUMERIC(12,2) DEFAULT 0,
  sort_order INT DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE event_task_line_items ENABLE ROW LEVEL SECURITY;

CREATE POLICY "event_task_line_items_all" ON event_task_line_items FOR ALL USING (true) WITH CHECK (true);

CREATE INDEX IF NOT EXISTS idx_event_line_items_task ON event_task_line_items(event_task_id);
