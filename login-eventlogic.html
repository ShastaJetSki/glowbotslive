<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Event Logic Pro ‚Äì Sign In</title>
  <link rel="icon" href="favicon-eventlogic.ico">
  <link rel="icon" type="image/png" href="favicon-eventlogic-32.png" sizes="32x32">
  <link rel="apple-touch-icon" href="favicon-eventlogic-192.png">
  <meta name="apple-mobile-web-app-title" content="Event Logic Pro">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:#f4f5f7;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#1a1a1a;
    }
    .login-wrap{width:100%;max-width:460px;padding:20px;}

    /* Logo area */
    .brand{text-align:center;margin-bottom:36px;}
    .brand img{max-width:280px;height:auto;margin-bottom:6px;}
    .brand-tagline{font-size:12px;color:#888;margin-top:2px;letter-spacing:1.5px;text-transform:uppercase;}

    /* Card */
    .card{
      padding:36px 32px;border-radius:14px;
      background:#ffffff;
      border:1px solid #e2e4e8;
      box-shadow:0 2px 12px rgba(0,0,0,.06);
      position:relative;
    }
    .card-title{font-size:22px;font-weight:700;margin-bottom:4px;color:#111;}
    .card-sub{font-size:13px;color:#888;margin-bottom:28px;}

    /* Red accent bar at top of card */
    .card-accent{
      width:60px;height:4px;border-radius:2px;
      background:linear-gradient(90deg,#DC2626,#EF4444);
      margin-bottom:24px;
    }

    /* Form */
    .form-group{margin-bottom:18px;}
    .form-label{display:block;margin-bottom:6px;font-size:13px;font-weight:600;color:#555;letter-spacing:0.3px;}
    .form-input{
      width:100%;padding:13px 14px;font-size:15px;border-radius:8px;
      border:1px solid #d1d5db;background:#fafafa;color:#1a1a1a;
      transition:border-color .2s,box-shadow .2s;
    }
    .form-input:focus{outline:none;border-color:#DC2626;background:#fff;box-shadow:0 0 0 3px rgba(220,38,38,.08);}
    .form-input::placeholder{color:#aaa;}

    /* Password wrapper */
    .pw-wrap{position:relative;}
    .pw-toggle{
      position:absolute;right:12px;top:50%;transform:translateY(-50%);
      background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:4px;
    }
    .pw-toggle:hover{color:#DC2626;}

    /* Button */
    .btn-login{
      width:100%;padding:14px;border:none;border-radius:8px;
      background:#DC2626;
      color:#fff;font-size:15px;font-weight:700;cursor:pointer;
      transition:all .2s;margin-top:8px;
    }
    .btn-login:hover{background:#B91C1C;transform:translateY(-1px);box-shadow:0 4px 16px rgba(220,38,38,.25);}
    .btn-login:active{transform:translateY(0);}
    .btn-login:disabled{opacity:.5;cursor:not-allowed;transform:none;}

    /* Error/Success */
    .msg{padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:16px;display:none;}
    .msg-error{background:#FEF2F2;border:1px solid #FECACA;color:#DC2626;}
    .msg-success{background:#F0FDF4;border:1px solid #BBF7D0;color:#16A34A;}
    .msg.show{display:block;}

    /* Forgot password */
    .forgot{text-align:right;margin-top:6px;}
    .forgot a{color:#999;font-size:12px;text-decoration:none;}
    .forgot a:hover{color:#DC2626;}

    /* Signup link */
    .signup-link{text-align:center;margin-top:20px;padding-top:20px;border-top:1px solid #eee;}
    .signup-link span{color:#888;font-size:13px;}
    .signup-link a{color:#DC2626;font-size:13px;text-decoration:none;font-weight:600;}
    .signup-link a:hover{text-decoration:underline;}

    /* Footer */
    .footer{text-align:center;margin-top:28px;}
    .footer-powered{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:10px;}
    .footer-powered span{color:#aaa;font-size:11px;}
    .footer-powered img{height:30px;}
    .footer-powered a{color:#DC2626;text-decoration:none;font-weight:600;font-size:11px;}
    .footer-powered a:hover{color:#B91C1C;}
    .footer-links{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;}
    .footer-links a{color:#aaa;font-size:11px;text-decoration:none;}
    .footer-links a:hover{color:#DC2626;}
    .footer-copy{color:#ccc;font-size:10px;margin-top:10px;}

    /* Dark mode toggle */
    .dark-toggle{
      position:absolute;top:16px;right:16px;
      background:none;border:1px solid #d1d5db;border-radius:8px;
      padding:6px 10px;cursor:pointer;transition:all .2s;
      display:flex;align-items:center;gap:6px;
      color:#888;font-size:11px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;
    }
    .dark-toggle svg{width:16px;height:16px;fill:currentColor;}
    .dark-toggle:hover{border-color:#DC2626;color:#DC2626;}

    body.dark .dark-toggle{border-color:#333;color:#999;}
    body.dark .dark-toggle:hover{border-color:#DC2626;color:#DC2626;}

    /* Dark mode overrides */
    body.dark{background:#111111;}
    body.dark .card{background:#1a1a1a;border-color:#2a2a2a;box-shadow:0 2px 12px rgba(0,0,0,.3);}
    body.dark .card-title{color:#f0f0f0;}
    body.dark .card-sub{color:#777;}
    body.dark .form-label{color:#999;}
    body.dark .form-input{background:#111;border-color:#333;color:#f0f0f0;}
    body.dark .form-input:focus{background:#151515;border-color:#DC2626;}
    body.dark .form-input::placeholder{color:#555;}
    body.dark .forgot a{color:#666;}
    body.dark .forgot a:hover{color:#EF4444;}
    body.dark .signup-link{border-top-color:#2a2a2a;}
    body.dark .signup-link span{color:#666;}
    body.dark .msg-error{background:#1a0a0a;border-color:#5c1111;color:#f87171;}
    body.dark .msg-success{background:#0a1a0a;border-color:#115c11;color:#34d399;}
    body.dark .dark-toggle{border-color:#333;color:#777;}
    body.dark .dark-toggle:hover{border-color:#DC2626;color:#DC2626;}
    body.dark .footer-powered span{color:#555;}
    body.dark .footer-links a{color:#555;}
    body.dark .footer-copy{color:#333;}
    body.dark .brand-tagline{color:#666;}
    body.dark .pw-toggle{color:#666;}

    @media(max-width:480px){
      .brand img{max-width:220px;}
      .card{padding:28px 22px;}
    }
  </style>
</head>
<body>

<div class="login-wrap">
  <div class="brand">
    <img id="brandLogo" src="eventlogicpro-logo.png" alt="Event Logic Pro">
    <div class="brand-tagline">Professional Event Management</div>
  </div>

  <div class="card">
    <button class="dark-toggle" id="darkToggle" title="Toggle dark mode">
      <svg id="moonIcon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      <svg id="sunIcon" viewBox="0 0 24 24" style="display:none;"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span id="modeLabel">Dark</span>
    </button>
    <div class="card-accent"></div>
    <div class="card-title">Welcome back</div>
    <div class="card-sub">Sign in to continue to your dashboard</div>

    <div class="msg msg-error" id="errorMsg"></div>
    <div class="msg msg-success" id="successMsg"></div>

    <div class="form-group">
      <label class="form-label">Email Address</label>
      <input type="email" class="form-input" id="email" placeholder="you@yourbusiness.com" autocomplete="email">
    </div>

    <div class="form-group">
      <label class="form-label">Password</label>
      <div class="pw-wrap">
        <input type="password" class="form-input" id="password" placeholder="Enter your password" autocomplete="current-password">
        <button type="button" class="pw-toggle" id="pwToggle" tabindex="-1">üëÅ</button>
      </div>
      <div class="forgot"><a href="#">Forgot password?</a></div>
    </div>

    <button class="btn-login" id="loginBtn">Sign In</button>

    <div class="signup-link">
      <span>Don't have an account? </span><a href="signup-eventlogic.html">Start free trial</a>
    </div>
  </div>

  <div class="footer">
    <div class="footer-powered">
      <span>Powered by</span>
      <img src="glowbot.png" alt="GlowBot">
      <a href="https://glowbotslive.com" target="_blank">GlowBotsLive.com</a>
    </div>
    <div class="footer-links">
      <a href="#">Privacy</a>
      <a href="#">Terms</a>
      <a href="mailto:support@eventlogicpro.com">Support</a>
    </div>
    <div class="footer-copy">&copy; 2026 Event Logic Pro. All rights reserved.</div>
  </div>
</div>

<script>
(function(){
  const SB_URL = 'https://kxqkwpkmtgvmthpafoqx.supabase.co';
  const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';
  const sb = window.supabase.createClient(SB_URL, SB_KEY);

  // Dark mode toggle
  const darkToggle = document.getElementById('darkToggle');
  const moonIcon = document.getElementById('moonIcon');
  const sunIcon = document.getElementById('sunIcon');
  const modeLabel = document.getElementById('modeLabel');
  const brandLogo = document.getElementById('brandLogo');
  const savedMode = localStorage.getItem('elp_dark_mode');
  if (savedMode === 'true') {
    document.body.classList.add('dark');
    moonIcon.style.display = 'none';
    sunIcon.style.display = 'block';
    modeLabel.textContent = 'Light';
    brandLogo.src = 'eventlogicpro-logo-dark.png';
  }
  darkToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    const isDark = document.body.classList.contains('dark');
    moonIcon.style.display = isDark ? 'none' : 'block';
    sunIcon.style.display = isDark ? 'block' : 'none';
    modeLabel.textContent = isDark ? 'Light' : 'Dark';
    brandLogo.src = isDark ? 'eventlogicpro-logo-dark.png' : 'eventlogicpro-logo.png';
    localStorage.setItem('elp_dark_mode', isDark);
  });

  const emailInput    = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn      = document.getElementById('loginBtn');
  const pwToggle      = document.getElementById('pwToggle');
  const errorMsg      = document.getElementById('errorMsg');
  const successMsg    = document.getElementById('successMsg');

  pwToggle.addEventListener('click', () => {
    const isPassword = passwordInput.type === 'password';
    passwordInput.type = isPassword ? 'text' : 'password';
    pwToggle.textContent = isPassword ? 'üôà' : 'üëÅ';
  });

  function showError(msg) {
    errorMsg.textContent = msg;
    errorMsg.classList.add('show');
    successMsg.classList.remove('show');
  }
  function showSuccess(msg) {
    successMsg.textContent = msg;
    successMsg.classList.add('show');
    errorMsg.classList.remove('show');
  }
  function clearMessages() {
    errorMsg.classList.remove('show');
    successMsg.classList.remove('show');
  }

  async function checkExistingSession() {
    const token = localStorage.getItem('sb_access_token');
    const refresh = localStorage.getItem('sb_refresh_token');
    if (!token || !refresh) return;
    try {
      const { data } = await sb.auth.setSession({ access_token: token, refresh_token: refresh });
      if (data?.session) {
        const tenantId = await getUserTenantId(data.session.user.id, data.session.user.email);
        const dashUrl = await getTenantDashboard(tenantId);
        location.replace(dashUrl);
      }
    } catch (e) {
      localStorage.removeItem('sb_access_token');
      localStorage.removeItem('sb_refresh_token');
    }
  }
  checkExistingSession();

  async function getUserTenantId(authId, email) {
    let { data } = await sb.from('users').select('tenant_id').eq('auth_user_id', authId).single();
    if (data?.tenant_id) return data.tenant_id;
    ({ data } = await sb.from('users').select('tenant_id').eq('email', email).single());
    return data?.tenant_id || null;
  }

  async function getTenantDashboard(tenantId) {
    const defaultDash = 'eventlogicpro.html';
    if (!tenantId) return defaultDash;
    const { data } = await sb.from('tenants').select('dashboard_url').eq('tenant_id', tenantId).single();
    return data?.dashboard_url || defaultDash;
  }

  async function login() {
    clearMessages();
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    if (!email || !password) { showError('Please enter email and password'); return; }

    loginBtn.disabled = true;
    loginBtn.textContent = 'Signing in...';

    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if (error) throw error;

      localStorage.setItem('sb_access_token', data.session.access_token);
      localStorage.setItem('sb_refresh_token', data.session.refresh_token);

      showSuccess('Welcome back! Redirecting...');
      loginBtn.textContent = 'Loading dashboard...';

      const tenantId = await getUserTenantId(data.session.user.id, data.session.user.email);
      const dashUrl = await getTenantDashboard(tenantId);

      location.replace(dashUrl);

    } catch (err) {
      console.error('Login error:', err);
      showError(err.message || 'Login failed');
      loginBtn.textContent = 'Sign In';
    } finally {
      loginBtn.disabled = false;
    }
  }

  loginBtn.addEventListener('click', login);
  passwordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') login(); });
  emailInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') passwordInput.focus(); });
})();
</script>
</body>
</html>
