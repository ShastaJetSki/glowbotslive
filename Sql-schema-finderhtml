<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SQL Schema Finder</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #0f1621;
      color: #e8eef6;
    }
    .card {
      background: #1a2535;
      border: 1px solid #223044;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }
    h1, h2 { color: #e8eef6; }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover { background: #2563eb; }
    pre {
      background: #0f1621;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      border: 1px solid #223044;
      white-space: pre-wrap;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      text-align: left;
      padding: 8px;
      border-bottom: 1px solid #223044;
    }
    th {
      background: #0f1621;
      color: #9fb0c3;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>SQL Schema Finder</h1>

  <div class="card">
    <h2>Run This SQL in Supabase SQL Editor</h2>
    <p>Copy this SQL and run it in your Supabase dashboard â†’ SQL Editor:</p>
    <pre id="sqlQuery">SELECT 
  column_name,
  data_type,
  is_nullable,
  column_default
FROM information_schema.columns
WHERE table_name = 'employees'
ORDER BY ordinal_position;</pre>
    <button onclick="copySql()">Copy SQL</button>
  </div>

  <div class="card">
    <h2>Or Paste Your SQL Results Here</h2>
    <p>Run the SQL above in Supabase, then paste the results here:</p>
    <textarea id="sqlResults" rows="10" style="width:100%; padding:10px; background:#0f1621; color:#e8eef6; border:1px solid #223044; border-radius:8px; font-family:monospace;"></textarea>
    <br><br>
    <button onclick="parseResults()">Parse Results</button>
    <div id="parsedOutput"></div>
  </div>

  <div class="card">
    <h2>Alternative: Check via REST API</h2>
    <button onclick="checkViaREST()">Check Employees Table Structure</button>
    <div id="restResult"></div>
  </div>

  <script>
    const API_BASE = "https://kxqkwpkmtgvmthpafoqx.supabase.co";
    const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQzODE1MjksImV4cCI6MjA0OTk1NzUyOX0.wkret51JR-xvO92emp-2gFEFOPEP2u_wKvMKi4UrG-Q";

    function copySql() {
      const sql = document.getElementById('sqlQuery').textContent;
      navigator.clipboard.writeText(sql);
      alert('SQL copied to clipboard!');
    }

    function parseResults() {
      const results = document.getElementById('sqlResults').value;
      const output = document.getElementById('parsedOutput');
      
      if (!results.trim()) {
        output.innerHTML = '<p class="error">Please paste SQL results</p>';
        return;
      }

      output.innerHTML = `
        <h3 class="success">Results:</h3>
        <pre>${results}</pre>
      `;
    }

    async function checkViaREST() {
      const result = document.getElementById('restResult');
      result.innerHTML = '<p>Checking...</p>';

      const token = localStorage.getItem('sb_access_token');
      if (!token) {
        result.innerHTML = '<p class="error">Not logged in. Please log in to WorkLogic first.</p>';
        return;
      }

      try {
        // Get one employee to see structure
        const response = await fetch(`${API_BASE}/rest/v1/employees?limit=1`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'apikey': ANON_KEY
          }
        });

        if (!response.ok) {
          const error = await response.text();
          throw new Error(`HTTP ${response.status}: ${error}`);
        }

        const data = await response.json();
        
        if (data.length > 0) {
          const columns = Object.keys(data[0]);
          const sample = data[0];
          
          result.innerHTML = `
            <div class="success">
              <h3>Found ${columns.length} columns:</h3>
              <table>
                <tr>
                  <th>Column Name</th>
                  <th>Sample Value</th>
                  <th>Type</th>
                </tr>
                ${columns.map(col => `
                  <tr>
                    <td><strong>${col}</strong></td>
                    <td>${JSON.stringify(sample[col])}</td>
                    <td>${typeof sample[col]}</td>
                  </tr>
                `).join('')}
              </table>
              
              <h3>Full Sample Record:</h3>
              <pre>${JSON.stringify(sample, null, 2)}</pre>

              <h3>JavaScript Object to Use:</h3>
              <pre>const formData = {
${columns.filter(c => c !== 'employee_id').map(col => `  ${col}: value`).join(',\n')}
};</pre>
            </div>
          `;
        } else {
          result.innerHTML = '<p class="error">No employees found. Create one manually in Supabase first.</p>';
        }
      } catch (err) {
        result.innerHTML = `<p class="error">Error: ${err.message}</p>`;
        console.error(err);
      }
    }
  </script>
</body>
</html>
