<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Settings</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<meta name="supabase-anon-key"
content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4"/>

<style>
body{margin:0;padding:24px;font-family:system-ui;background:#0b0f14;color:#e8eef6}
.appName{position:fixed;top:10px;right:24px;font-size:12px;color:#9fb0c3}
header{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:16px;gap:16px;flex-wrap:wrap}
h1{margin:0;font-size:40px}
h2{margin:18px 0 10px;font-size:18px}

.sub-nav{display:flex;gap:16px;margin-top:8px;padding-bottom:10px;border-bottom:1px solid #1f2937}
.sub-nav-link{font-size:14px;color:#9ca3af;text-decoration:none}
.sub-nav-link:hover{color:#e5e7eb}

.header-buttons{display:flex;gap:8px}

button{padding:8px 14px;border-radius:10px;border:1px solid #2a3b55;background:#1a2535;color:#fff;cursor:pointer}
button:hover{background:#243648}

.card{background:#0f1621;border:1px solid #223044;border-radius:14px;padding:20px;margin-bottom:16px}

.employee-grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
gap:16px
}

.employee-card{
background:#0b0f14;
border:1px solid #223044;
border-radius:14px;
padding:16px;
text-align:center
}

.employee-avatar{
width:110px;
height:110px;
margin:0 auto 12px;
border-radius:14px;
background:#111;
border:2px solid #223044;
background-size:cover;
background-position:center;
filter:brightness(.88) saturate(.9);
cursor:pointer;
transition:.2s
}
.employee-avatar:hover{filter:brightness(.95)}

.employee-name{font-weight:600}
.employee-role{font-size:11px;color:#9fb0c3;margin-bottom:10px}

.upload-btn{width:100%;margin-top:8px;font-size:12px}
.remove-btn{
width:100%;
margin-top:6px;
font-size:12px;
background:#2b1111;
border-color:#5a1d1d;
color:#fca5a5
}
.remove-btn:hover{background:#3b1515}

.modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,.85);
z-index:999;
align-items:center;
justify-content:center
}
.modal.active{display:flex}
.modal-content{
background:#0f1621;
border:1px solid #223044;
border-radius:14px;
padding:24px;
max-width:600px;
width:100%
}
.modal-close{
background:none;
border:none;
color:#9fb0c3;
font-size:28px;
cursor:pointer
}
.modal-section{margin-bottom:16px}
.modal-section-title{font-size:12px;color:#9fb0c3;margin-bottom:6px}
.details-link{color:#38bdf8;font-size:13px;cursor:pointer}
</style>
</head>

<body>
<div class="appName">WorkLogicPro</div>

<header>
  <div>
    <h1 id="tenantTitle">Settings</h1>
    <div class="sub-nav">
      <a class="sub-nav-link" href="dashboard-business.html">Dashboard</a>
      <a class="sub-nav-link" href="dashboard-customer-search.html">Customers</a>
      <a class="sub-nav-link" href="dashboard-vehicle-search.html">Vehicles</a>
      <a class="sub-nav-link" href="dashboard-scheduling.html">Scheduling</a>
    </div>
  </div>
  <div class="header-buttons">
    <button onclick="location.reload()">Settings</button>
    <button onclick="logout()">Logout</button>
  </div>
</header>

<div class="card">
<h2>Employee Profiles</h2>
<div id="employeeGrid" class="employee-grid">Loading…</div>
</div>

<div id="employeeModal" class="modal" onclick="if(event.target===this)closeModal()">
<div class="modal-content">
<div style="display:flex;justify-content:space-between">
<h2 id="modalName"></h2>
<button class="modal-close" onclick="closeModal()">×</button>
</div>
<div id="modalBody"></div>
</div>
</div>

<script>
const PROJECT="kxqkwpkmtgvmthpafoqx"
const API=`https://${PROJECT}.supabase.co`
const STORAGE=`${API}/storage/v1/object/public/avatars`
const FN=`${API}/functions/v1/employees`
const ANON=document.querySelector('meta[name="supabase-anon-key"]').content

let employees=[]

function logout(){
localStorage.removeItem("sb_access_token")
location.href="login.html"
}

function roleRank(r){
return {owner:1,manager:2,technician:3,parts:4}[r]||99
}

function avatarURL(e){
return e.avatar_url?`${STORAGE}/${e.avatar_url}`:""
}

async function loadEmployees(){
const token=localStorage.getItem("sb_access_token")
const r=await fetch(FN,{headers:{Authorization:`Bearer ${token}`,apikey:ANON}})
employees=await r.json()
employees.sort((a,b)=>roleRank(a.role)-roleRank(b.role))
renderEmployees()
}

function renderEmployees(){
document.getElementById("employeeGrid").innerHTML=
employees.map(e=>`
<div class="employee-card">
<div class="employee-avatar"
style="background-image:url('${avatarURL(e)}')"
onclick="openModal('${e.employee_id}')"></div>
<div class="employee-name">${e.name}</div>
<div class="employee-role">${e.role.toUpperCase()}</div>
<button class="upload-btn">Change Photo</button>
<button class="remove-btn">Remove Photo</button>
</div>
`).join("")
}

function openModal(id){
const e=employees.find(x=>x.employee_id===id)
document.getElementById("modalName").textContent=e.name
document.getElementById("modalBody").innerHTML=`
<div class="modal-section">
<div class="modal-section-title">Role</div>${e.role}
</div>
<div class="modal-section">
<div class="modal-section-title">Hourly Rate</div>$${e.hourly_labor_rate}/hr
</div>
<div class="modal-section">
<span class="details-link">View Full Employee Details →</span>
</div>`
document.getElementById("employeeModal").classList.add("active")
}

function closeModal(){
document.getElementById("employeeModal").classList.remove("active")
}

loadEmployees()
</script>
</body>
</html>
