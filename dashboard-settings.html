<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Business Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="supabase-anon-key"
    content="YOUR_ANON_KEY_HERE" />

  <style>
    body {
      margin:0;
      padding:24px;
      font-family:system-ui;
      background:#0b0f14;
      color:#e8eef6;
    }

    .appName {
      position:fixed;
      top:10px;
      right:24px;
      font-size:12px;
      color:#9fb0c3;
    }

    h1 { font-size:40px; margin:0; }
    h2 { font-size:18px; margin:24px 0 12px; }

    .sub-nav {
      display:flex;
      gap:16px;
      margin:8px 0 20px;
      border-bottom:1px solid #1f2937;
      padding-bottom:10px;
    }

    .sub-nav a {
      font-size:14px;
      color:#9ca3af;
      text-decoration:none;
    }

    .sub-nav a.active {
      color:#38bdf8;
    }

    .section {
      background:#0f1621;
      border:1px solid #223044;
      border-radius:14px;
      padding:16px;
      margin-bottom:16px;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px;
    }

    label {
      font-size:12px;
      color:#9fb0c3;
    }

    input, select {
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid #223044;
      background:#0b0f14;
      color:#e8eef6;
    }

    button {
      margin-top:14px;
      padding:10px 16px;
      border-radius:10px;
      border:1px solid #2a3b55;
      background:#1a2535;
      color:#fff;
      cursor:pointer;
    }

    .employee {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px;
      border-bottom:1px solid #223044;
    }

    .employee:last-child {
      border-bottom:none;
    }

    .muted {
      font-size:12px;
      color:#9fb0c3;
    }
  </style>
</head>

<body>
<div class="appName">WorkLogicPro</div>

<h1>Business Settings</h1>

<div class="sub-nav">
  <a href="dashboard-business.html">Dashboard</a>
  <a href="dashboard-customer-search.html">Customers</a>
  <a href="dashboard-vehicle-search.html">Vehicles</a>
  <a class="active">Settings</a>
</div>

<!-- BUSINESS PROFILE -->
<div class="section">
  <h2>Business Profile</h2>
  <div class="grid">
    <div>
      <label>Business Name</label>
      <input id="biz_name" />
    </div>
    <div>
      <label>Street Address</label>
      <input id="biz_address" />
    </div>
    <div>
      <label>City</label>
      <input id="biz_city" />
    </div>
    <div>
      <label>State</label>
      <input id="biz_state" />
    </div>
    <div>
      <label>Zip</label>
      <input id="biz_zip" />
    </div>
    <div>
      <label>Timezone</label>
      <input id="biz_timezone" placeholder="America/Los_Angeles" />
    </div>
  </div>
</div>

<!-- HOURS -->
<div class="section">
  <h2>Business Hours</h2>
  <div class="grid">
    <div>
      <label>Open Time</label>
      <input type="time" id="open_time" />
    </div>
    <div>
      <label>Close Time</label>
      <input type="time" id="close_time" />
    </div>
  </div>
</div>

<!-- LABOR & PRICING -->
<div class="section">
  <h2>Labor & Pricing</h2>
  <div class="grid">
    <div>
      <label>Labor Rate ($/hr)</label>
      <input type="number" id="labor_rate" />
    </div>
    <div>
      <label>Diagnostic Fee</label>
      <input type="number" id="diag_fee" />
    </div>
    <div>
      <label>Shop Supplies %</label>
      <input type="number" id="shop_supplies" />
    </div>
    <div>
      <label>Local Tax %</label>
      <input type="number" id="tax_rate" />
    </div>
  </div>
</div>

<!-- SOCIAL -->
<div class="section">
  <h2>Social Links</h2>
  <div class="grid">
    <div>
      <label>Website</label>
      <input id="site_url" />
    </div>
    <div>
      <label>Facebook</label>
      <input id="facebook" />
    </div>
    <div>
      <label>Instagram</label>
      <input id="instagram" />
    </div>
  </div>
</div>

<!-- EMPLOYEES -->
<div class="section">
  <h2>Employees</h2>
  <div id="employees"></div>
</div>

<button onclick="saveSettings()">Save Settings</button>

<script>
const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
const API_BASE = `https://${PROJECT_REF}.supabase.co`;
const REST_BASE = `${API_BASE}/rest/v1`;
const ANON_KEY = document.querySelector('meta[name="supabase-anon-key"]').content;

async function validateAuth(){
  const t = localStorage.getItem("sb_access_token");
  if(!t) return null;
  const r = await fetch(`${API_BASE}/auth/v1/user`, {
    headers:{apikey:ANON_KEY, Authorization:`Bearer ${t}`}
  });
  return r.ok ? t : null;
}

async function fetchTable(table, token){
  const r = await fetch(`${REST_BASE}/${table}?select=*`, {
    headers:{apikey:ANON_KEY, Authorization:`Bearer ${token}`}
  });
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

async function load(){
  const token = await validateAuth();
  if(!token) return location.replace("login.html");

  const employees = await fetchTable("employees", token);

  employeesEl.innerHTML = employees.map(e=>`
    <div class="employee">
      <div>
        <strong>${e.first_name} ${e.last_name}</strong>
        <div class="muted">${e.role}</div>
      </div>
      <div class="muted">${e.active ? "Active" : "Inactive"}</div>
    </div>
  `).join("");
}

function saveSettings(){
  alert("Settings saved (DB wiring next)");
}

const employeesEl = document.getElementById("employees");
load();
</script>
</body>
</html>
