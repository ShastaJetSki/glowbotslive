<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Settings — WorkLogicPro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="supabase-anon-key"
    content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4" />

  <style>
    body { margin:0; padding:24px; font-family:system-ui; background:#0b0f14; color:#e8eef6; }
    .appName { position:fixed; top:10px; right:24px; font-size:12px; color:#9fb0c3; }

    header { margin-bottom:12px; }
    h1 { margin:0; font-size:40px; }

    .sub-nav {
      display:flex; gap:16px; margin:8px 0 20px;
      border-bottom:1px solid #1f2937; padding-bottom:10px;
    }
    .sub-nav a { font-size:14px; color:#9ca3af; text-decoration:none; }
    .sub-nav a.active { color:#38bdf8; }

    .settings-layout {
      display:grid;
      grid-template-columns:260px 1fr;
      gap:20px;
    }

    .settings-nav {
      background:#0f1621;
      border:1px solid #223044;
      border-radius:14px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      height:fit-content;
    }

    .settings-nav button {
      text-align:left;
      padding:10px 12px;
      border-radius:10px;
      background:none;
      border:1px solid transparent;
      color:#9fb0c3;
      cursor:pointer;
    }
    .settings-nav button.active {
      background:#0b1220;
      border-color:#3b82f6;
      color:#e8eef6;
    }

    .card {
      background:#0f1621;
      border:1px solid #223044;
      border-radius:14px;
      padding:16px 18px;
    }

    h2 { margin:0 0 12px; font-size:18px; }

    .employees-layout {
      display:grid;
      grid-template-columns:300px 1fr;
      gap:16px;
    }

    .emp-list { display:flex; flex-direction:column; gap:6px; }
    .emp-item {
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #223044;
      background:#0b1220;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .emp-item.active { border-color:#3b82f6; }
    .emp-name { font-size:14px; }
    .emp-role { font-size:12px; color:#9fb0c3; }

    .dot {
      width:8px; height:8px; border-radius:50%;
      background:#4ade80;
    }
    .dot.inactive { background:#64748b; }

    label { font-size:12px; color:#9fb0c3; display:block; margin-bottom:4px; }
    input, select {
      width:100%; padding:10px;
      border-radius:10px;
      border:1px solid #223044;
      background:#0b1220; color:#e8eef6;
    }

    .row { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:10px; }

    button.primary {
      padding:10px 16px;
      border-radius:10px;
      border:1px solid #2a3b55;
      background:#1a2535;
      color:#fff;
      cursor:pointer;
    }

    .muted { font-size:12px; color:#9fb0c3; }
  </style>
</head>

<body>
<div class="appName">WorkLogicPro</div>

<header>
  <h1>Settings</h1>
  <div class="sub-nav">
    <a href="dashboard-business.html">Dashboard</a>
    <a href="dashboard-customer-search.html">Customers</a>
    <a href="dashboard-vehicle-search.html">Vehicles</a>
    <a class="active">Settings</a>
  </div>
</header>

<div class="settings-layout">

  <div class="settings-nav">
    <button onclick="show('employees')" class="active">Employees</button>
  </div>

  <div class="card">
    <h2>Employees</h2>

    <div class="employees-layout">
      <!-- LIST -->
      <div class="emp-list" id="employeeList">Loading…</div>

      <!-- DETAIL -->
      <div id="employeeDetail" class="muted">
        Select an employee to view details
      </div>
    </div>
  </div>
</div>

<script>
const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
const API_BASE = `https://${PROJECT_REF}.supabase.co`;
const FUNCTIONS_BASE = `${API_BASE}/functions/v1`;
const ANON_KEY = document.querySelector('meta[name="supabase-anon-key"]').content;

async function validateAuth(){
  const t = localStorage.getItem("sb_access_token");
  if(!t) return null;
  const r = await fetch(`${API_BASE}/auth/v1/user`, {
    headers:{apikey:ANON_KEY, Authorization:`Bearer ${t}`}
  });
  return r.ok ? t : null;
}

async function fetchJson(url, token){
  const r = await fetch(url, {
    headers:{apikey:ANON_KEY, Authorization:`Bearer ${token}`}
  });
  if(!r.ok) throw new Error(await r.text());
  return r.json();
}

let employees=[];
let selected=null;

function renderList(){
  employeeList.innerHTML = employees.map(e=>`
    <div class="emp-item ${selected?.employee_id===e.employee_id?'active':''}"
      onclick="selectEmp('${e.employee_id}')">
      <div>
        <div class="emp-name">${e.first_name} ${e.last_name}</div>
        <div class="emp-role">${e.role}</div>
      </div>
      <div class="dot ${e.active===false?'inactive':''}"></div>
    </div>
  `).join("");
}

function selectEmp(id){
  selected = employees.find(e=>e.employee_id===id);
  renderList();

  employeeDetail.innerHTML = `
    <div class="row">
      <div><label>First Name</label><input value="${selected.first_name||""}" /></div>
      <div><label>Last Name</label><input value="${selected.last_name||""}" /></div>
      <div>
        <label>Role</label>
        <select>
          <option ${selected.role==="owner"?"selected":""}>owner</option>
          <option ${selected.role==="manager"?"selected":""}>manager</option>
          <option ${selected.role==="technician"?"selected":""}>technician</option>
        </select>
      </div>
    </div>

    <h3 style="margin-top:16px;">Availability</h3>
    <div class="row">
      <div><label>Start Time</label><input type="time" /></div>
      <div><label>End Time</label><input type="time" /></div>
      <div><label>Max Hours / Day</label><input type="number" /></div>
      <div><label>Max Hours / Week</label><input type="number" /></div>
    </div>

    <br />
    <button class="primary" disabled>Save (Coming Next)</button>
  `;
}

async function load(){
  const token = await validateAuth();
  if(!token) return location.replace("login.html");

  employees = await fetchJson(`${FUNCTIONS_BASE}/employees`, token);
  renderList();
}

load();
</script>
</body>
</html>
