-- Schedule Items table
CREATE TABLE IF NOT EXISTS event_schedule_items (
  schedule_item_id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  tenant_id UUID NOT NULL,
  event_project_id UUID REFERENCES event_projects(event_project_id) ON DELETE SET NULL,
  title TEXT NOT NULL,
  item_date DATE NOT NULL,
  start_time TIME,
  end_time TIME,
  category TEXT DEFAULT 'meeting',
  assigned_to UUID,
  location TEXT,
  notes TEXT,
  created_by TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE event_schedule_items ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "event_schedule_items_all" ON event_schedule_items;
CREATE POLICY "event_schedule_items_all" ON event_schedule_items FOR ALL USING (true) WITH CHECK (true);
CREATE INDEX IF NOT EXISTS idx_schedule_items_tenant ON event_schedule_items(tenant_id);
CREATE INDEX IF NOT EXISTS idx_schedule_items_date ON event_schedule_items(item_date);

-- Add member detail columns
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS phone TEXT;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS birthday DATE;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS anniversary DATE;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS shirt_size TEXT;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS blood_type TEXT;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS ec_name TEXT;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS ec_phone TEXT;
ALTER TABLE event_members ADD COLUMN IF NOT EXISTS ec_relationship TEXT;
