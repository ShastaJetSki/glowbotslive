<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Event Estimator â€” EventLogicPro</title>
  <script>(function(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);})();</script>
  <link rel="stylesheet" href="themes.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    [data-theme="dark-blue"]{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="blue-light"],[data-theme="light-blue"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#2563eb;--accent-light:#3b82f6;}
    [data-theme="slate-dark"],[data-theme="slate"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#273549;--bg-hover:#334155;--border-default:#334155;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--accent-primary:#6366f1;--accent-light:#818cf8;}
    [data-theme="slate-light"],[data-theme="light-grey"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#e5e5e5;--border-default:#d4d4d4;--text-primary:#171717;--text-secondary:#525252;--accent-primary:#404040;--accent-light:#525252;}
    [data-theme="ocean-dark"],[data-theme="ocean"]{--bg-primary:#0a1214;--bg-secondary:#0e181c;--bg-card:#152228;--bg-hover:#1c2d35;--border-default:#243842;--text-primary:#e5f0f3;--text-secondary:#8faab5;--accent-primary:#14b8a6;--accent-light:#2dd4bf;}
    [data-theme="ocean-light"],[data-theme="light-ocean"]{--bg-primary:#f0fdfa;--bg-secondary:#ccfbf1;--bg-card:#fff;--bg-hover:#99f6e4;--border-default:#5eead4;--text-primary:#134e4a;--text-secondary:#0f766e;--accent-primary:#0d9488;--accent-light:#14b8a6;}
    [data-theme="midnight-dark"],[data-theme="midnight"]{--bg-primary:#09090b;--bg-secondary:#0f0f12;--bg-card:#18181d;--bg-hover:#222228;--border-default:#27272f;--text-primary:#eeeef0;--text-secondary:#9898a4;--accent-primary:#8b5cf6;--accent-light:#a78bfa;}
    [data-theme="lavender-light"],[data-theme="lavender"]{--bg-primary:#faf5ff;--bg-secondary:#f3e8ff;--bg-card:#fff;--bg-hover:#ede4ff;--border-default:#d8b4fe;--text-primary:#3b1d5c;--text-secondary:#6b4d8a;--accent-primary:#9333ea;--accent-light:#a855f7;}
    [data-theme="forest-dark"],[data-theme="forest"]{--bg-primary:#0a100c;--bg-secondary:#0f1812;--bg-card:#16221a;--bg-hover:#1e2e24;--border-default:#263830;--text-primary:#e5f0e8;--text-secondary:#8faa96;--accent-primary:#22c55e;--accent-light:#4ade80;}
    [data-theme="mint-light"],[data-theme="mint"],[data-theme="light-forest"]{--bg-primary:#f0fdf4;--bg-secondary:#dcfce7;--bg-card:#fff;--bg-hover:#bbf7d0;--border-default:#86efac;--text-primary:#14532d;--text-secondary:#166534;--accent-primary:#16a34a;--accent-light:#22c55e;}
    [data-theme="crimson-dark"],[data-theme="crimson"]{--bg-primary:#0f0708;--bg-secondary:#1a0c0e;--bg-card:#261214;--bg-hover:#331a1c;--border-default:#442225;--text-primary:#fee2e2;--text-secondary:#c9a3a5;--accent-primary:#dc2626;--accent-light:#ef4444;}
    [data-theme="coral-light"],[data-theme="coral"]{--bg-primary:#fff5f5;--bg-secondary:#fee2e2;--bg-card:#fff;--bg-hover:#fecaca;--border-default:#fca5a5;--text-primary:#7f1d1d;--text-secondary:#a04444;--accent-primary:#ef4444;--accent-light:#f87171;}
    [data-theme="amber-dark"],[data-theme="amber"]{--bg-primary:#0f0c05;--bg-secondary:#1a1508;--bg-card:#26200c;--bg-hover:#332a10;--border-default:#443815;--text-primary:#fef3c7;--text-secondary:#c9b896;--accent-primary:#f59e0b;--accent-light:#fbbf24;}
    [data-theme="honey-light"],[data-theme="honey"]{--bg-primary:#fffbeb;--bg-secondary:#fef3c7;--bg-card:#fff;--bg-hover:#fde68a;--border-default:#fcd34d;--text-primary:#78350f;--text-secondary:#a06020;--accent-primary:#d97706;--accent-light:#f59e0b;}
    [data-theme="rose-dark"],[data-theme="rose"]{--bg-primary:#0f070a;--bg-secondary:#1a0c12;--bg-card:#26121a;--bg-hover:#331a24;--border-default:#44222e;--text-primary:#ffe4ec;--text-secondary:#c9a3b0;--accent-primary:#ec4899;--accent-light:#f472b6;}
    [data-theme="sky-light"],[data-theme="sky"]{--bg-primary:#f0f9ff;--bg-secondary:#e0f2fe;--bg-card:#fff;--bg-hover:#bae6fd;--border-default:#7dd3fc;--text-primary:#0c4a6e;--text-secondary:#3a6a8a;--accent-primary:#0284c7;--accent-light:#0ea5e9;}
    [data-theme="cyber-dark"],[data-theme="cyber"]{--bg-primary:#0a0a0f;--bg-secondary:#0f0f18;--bg-card:#151522;--bg-hover:#1c1c2e;--border-default:#2a2a44;--text-primary:#e0e0ff;--text-secondary:#9090c0;--accent-primary:#00ff88;--accent-light:#44ffaa;}
    [data-theme="sand-light"],[data-theme="sand"]{--bg-primary:#fefcf8;--bg-secondary:#faf6ee;--bg-card:#fff;--bg-hover:#f5efe0;--border-default:#e8dcc8;--text-primary:#44402a;--text-secondary:#6a6550;--accent-primary:#a89060;--accent-light:#c4aa78;}
    [data-theme="grey"]{--bg-primary:#111;--bg-secondary:#1a1a1a;--bg-card:#242424;--bg-hover:#2e2e2e;--border-default:#333;--text-primary:#e5e5e5;--text-secondary:#a3a3a3;--accent-primary:#525252;--accent-light:#737373;}
    [data-theme="charcoal"]{--bg-primary:#121214;--bg-secondary:#18181b;--bg-card:#27272a;--bg-hover:#3f3f46;--border-default:#3f3f46;--text-primary:#fafafa;--text-secondary:#a1a1aa;--accent-primary:#a1a1aa;--accent-light:#d4d4d8;}
    [data-theme="navy"]{--bg-primary:#0a0e1a;--bg-secondary:#0f1526;--bg-card:#182035;--bg-hover:#1f2a45;--border-default:#253352;--text-primary:#e8ecf4;--text-secondary:#9aa5bd;--accent-primary:#4a7cc9;--accent-light:#6b9ae0;}
    [data-theme="graphite"]{--bg-primary:#0d0d0d;--bg-secondary:#141414;--bg-card:#1f1f1f;--bg-hover:#292929;--border-default:#2e2e2e;--text-primary:#e8e8e8;--text-secondary:#999;--accent-primary:#4a9eff;--accent-light:#6bb3ff;}
    [data-theme="obsidian"]{--bg-primary:#050505;--bg-secondary:#0a0a0a;--bg-card:#141414;--bg-hover:#1c1c1c;--border-default:#252525;--text-primary:#e0e0e0;--text-secondary:#888;--accent-primary:#0ea5e9;--accent-light:#38bdf8;}
    [data-theme="steel"]{--bg-primary:#0c0f13;--bg-secondary:#12161c;--bg-card:#1a2028;--bg-hover:#242c38;--border-default:#2c3644;--text-primary:#e4e8ed;--text-secondary:#8b95a5;--accent-primary:#64748b;--accent-light:#94a3b8;}
    [data-theme="espresso"]{--bg-primary:#0f0c0a;--bg-secondary:#161210;--bg-card:#211c18;--bg-hover:#2c2520;--border-default:#382f28;--text-primary:#f0ebe5;--text-secondary:#a89e94;--accent-primary:#a78b6e;--accent-light:#c4a88a;}
    [data-theme="onyx"]{--bg-primary:#000;--bg-secondary:#080808;--bg-card:#121212;--bg-hover:#1a1a1a;--border-default:#222;--text-primary:#f5f5f5;--text-secondary:#8c8c8c;--accent-primary:#06b6d4;--accent-light:#22d3ee;}
    [data-theme="light-slate"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#4f46e5;--accent-light:#6366f1;}

    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary);overflow-x:hidden;}
    body{padding-bottom:100px;}

    /* === DESKTOP HEADER === */
    .desktop-header{position:sticky;top:0;z-index:100;background:var(--bg-primary);border-bottom:1px solid var(--border-default);}
    .desktop-header-inner{padding:16px 24px 8px;display:flex;justify-content:space-between;align-items:center;}
    .desktop-header h1{margin:0;font-size:28px;font-weight:700;}
    .business-name{font-size:12px;color:var(--accent-primary);}
    .desktop-nav{display:flex;gap:24px;align-items:center;padding:0 24px 12px;}
    .desktop-nav a{padding:10px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;font-weight:500;border-bottom:2px solid transparent;transition:all 0.2s;}
    .desktop-nav a:hover{color:var(--text-primary);}
    .desktop-nav a.active{color:var(--accent-primary);border-bottom-color:var(--accent-primary);}
    .header-actions{display:flex;align-items:center;gap:12px;}

    /* === MOBILE HEADER === */
    .mobile-header{display:none;position:sticky;top:0;z-index:100;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);padding:12px 16px;}
    .mobile-header-bar{display:flex;justify-content:space-between;align-items:center;}
    .mobile-header h2{font-size:18px;font-weight:700;}
    .mobile-bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg-secondary);padding:8px;z-index:100;border-top:1px solid var(--border-default);}
    .mobile-nav-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:6px;}
    .mobile-nav-row:last-child{margin-bottom:0;}
    .mobile-nav-btn{padding:10px 8px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;display:flex;align-items:center;justify-content:center;min-height:44px;}
    .mobile-nav-btn.active{background:color-mix(in srgb,var(--accent-primary) 60%,transparent);border-color:var(--accent-primary);color:var(--text-primary);}

    @media(max-width:768px){
      .desktop-header{display:none!important;}
      .mobile-header{display:block;}
      .mobile-bottom-nav{display:block;}
      body{padding-bottom:140px;}
    }
    @media(min-width:769px){
      .mobile-header{display:none!important;}
      .mobile-bottom-nav{display:none!important;}
    }

    /* === MAIN LAYOUT === */
    .page-container{max-width:1200px;margin:0 auto;padding:20px 16px;}

    /* === SUMMARY DASHBOARD === */
    .summary-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px;}
    .summary-card{background:var(--bg-card);border:1px solid var(--border-default);border-radius:12px;padding:16px 20px;text-align:center;}
    .summary-card .label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-secondary);margin-bottom:6px;}
    .summary-card .value{font-size:24px;font-weight:800;font-variant-numeric:tabular-nums;}
    .summary-card.expense .value{color:#ef4444;}
    .summary-card.revenue .value{color:#22c55e;}
    .summary-card.profit .value.positive{color:#22c55e;}
    .summary-card.profit .value.negative{color:#ef4444;}
    .summary-card.items .value{color:var(--accent-light);}
    @media(max-width:640px){.summary-bar{grid-template-columns:repeat(2,1fr);}}

    /* === EVENT HEADER === */
    .event-header{background:var(--bg-card);border:1px solid var(--border-default);border-radius:12px;padding:20px;margin-bottom:24px;}
    .event-header-row{display:grid;grid-template-columns:2fr 1fr 1fr;gap:16px;align-items:end;}
    .event-header-row .form-group{margin:0;}
    @media(max-width:640px){.event-header-row{grid-template-columns:1fr;}}

    /* === CATEGORY SECTIONS === */
    .category-section{background:var(--bg-card);border:1px solid var(--border-default);border-radius:12px;margin-bottom:12px;overflow:hidden;transition:border-color 0.2s;}
    .category-section:hover{border-color:color-mix(in srgb,var(--accent-primary) 50%,var(--border-default));}
    .category-header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;cursor:pointer;user-select:none;-webkit-user-select:none;transition:background 0.15s;}
    .category-header:hover{background:var(--bg-hover);}
    .category-header:active{background:var(--bg-hover);}
    .cat-left{display:flex;align-items:center;gap:12px;}
    .cat-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
    .cat-title{font-size:15px;font-weight:700;}
    .cat-count{font-size:11px;color:var(--text-secondary);}
    .cat-right{display:flex;align-items:center;gap:16px;}
    .cat-total{font-size:16px;font-weight:700;font-variant-numeric:tabular-nums;}
    .cat-chevron{font-size:12px;color:var(--text-secondary);transition:transform 0.2s;}
    .category-section.expanded .cat-chevron{transform:rotate(180deg);}
    .category-body{max-height:0;overflow:hidden;transition:max-height 0.35s ease;}
    .category-section.expanded .category-body{max-height:3000px;}
    .category-content{padding:0 20px 16px;}

    /* === LINE ITEMS TABLE === */
    .line-items{width:100%;}
    .line-item{display:grid;grid-template-columns:1fr 120px 120px 40px;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border-default);}
    .line-item:last-child{border-bottom:none;}
    .line-item-name{font-size:13px;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .line-item-name.custom-input{background:transparent;border:none;color:var(--text-primary);font-size:13px;font-family:inherit;width:100%;outline:none;padding:4px 0;}
    .line-item-name.custom-input::placeholder{color:var(--text-secondary);opacity:0.5;}
    .line-item input[type="number"]{width:100%;padding:6px 8px;border-radius:6px;border:1px solid var(--border-default);background:var(--bg-primary);color:var(--text-primary);font-size:13px;font-family:inherit;text-align:right;font-variant-numeric:tabular-nums;-moz-appearance:textfield;}
    .line-item input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;}
    .line-item input[type="number"]:focus{outline:none;border-color:var(--accent-primary);}
    .line-item-remove{width:28px;height:28px;border-radius:6px;border:none;background:transparent;color:var(--text-secondary);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.15s;}
    .line-item-remove:hover{background:rgba(239,68,68,0.15);color:#ef4444;}
    .line-header{display:grid;grid-template-columns:1fr 120px 120px 40px;gap:8px;padding:0 0 6px;border-bottom:2px solid var(--border-default);margin-bottom:4px;}
    .line-header span{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-secondary);}
    .line-header span:nth-child(2),.line-header span:nth-child(3){text-align:right;}
    .add-line-btn{display:flex;align-items:center;gap:6px;padding:8px 0;font-size:12px;font-weight:600;color:var(--accent-light);background:transparent;border:none;cursor:pointer;font-family:inherit;margin-top:4px;}
    .add-line-btn:hover{text-decoration:underline;}
    @media(max-width:640px){
      .line-item{grid-template-columns:1fr 80px 80px 32px;}
      .line-header{grid-template-columns:1fr 80px 80px 32px;}
      .line-item input[type="number"]{padding:6px 4px;font-size:12px;}
    }

    /* === REVENUE SECTION === */
    .revenue-header{background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(34,197,94,0.05));border-color:rgba(34,197,94,0.3);}
    .revenue-header:hover{border-color:rgba(34,197,94,0.5);}
    .revenue-header .cat-icon{background:rgba(34,197,94,0.15);}
    .revenue-header .cat-total{color:#22c55e;}

    /* === FORM ELEMENTS === */
    .form-group{margin-bottom:0;}
    .form-label{display:block;font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;}
    .form-input,.form-select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-primary);color:var(--text-primary);font-size:14px;font-family:inherit;}
    .form-input:focus,.form-select:focus{outline:none;border-color:var(--accent-primary);}

    /* === BUTTONS === */
    .btn-primary{padding:10px 20px;border-radius:8px;border:none;background:var(--accent-primary);color:white;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:opacity 0.15s;}
    .btn-primary:hover{opacity:0.9;}
    .btn-secondary{padding:10px 20px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;}
    .btn-secondary:hover{background:var(--bg-hover);color:var(--text-primary);}
    .btn-icon{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all 0.15s;}
    .btn-icon:hover{background:var(--bg-hover);color:var(--text-primary);}
    .btn-icon svg{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none;}

    /* === ACTION BAR === */
    .action-bar{display:flex;gap:10px;justify-content:flex-end;margin-top:24px;padding-top:20px;border-top:1px solid var(--border-default);}
    @media(max-width:640px){.action-bar{flex-wrap:wrap;}.action-bar .btn-primary,.action-bar .btn-secondary{flex:1;text-align:center;}}

    /* === TOAST === */
    .toast{position:fixed;bottom:160px;left:50%;transform:translateX(-50%);background:var(--bg-card);border:1px solid var(--accent-primary);color:var(--text-primary);padding:12px 20px;border-radius:10px;font-size:14px;font-weight:500;z-index:1000;display:none;}
    .toast.show{display:block;animation:toastIn 0.3s ease;}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px);}to{opacity:1;transform:translateX(-50%) translateY(0);}}

    /* === EXPAND/COLLAPSE ALL === */
    .toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px;}
    .toolbar-left{display:flex;align-items:center;gap:10px;}
    .toolbar-right{display:flex;align-items:center;gap:8px;}
    .toggle-all-btn{padding:6px 14px;border-radius:6px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all 0.15s;}
    .toggle-all-btn:hover{background:var(--bg-hover);color:var(--text-primary);}
    .section-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text-secondary);}

    /* === PRINT === */
    @media print{
      .desktop-header,.mobile-header,.mobile-bottom-nav,.action-bar,.add-line-btn,.line-item-remove,.toolbar-right,.btn-icon{display:none!important;}
      body{background:#fff;color:#000;padding:0;}
      .page-container{max-width:100%;padding:10px;}
      .summary-card,.category-section,.event-header{border:1px solid #ddd;break-inside:avoid;}
      .category-body{max-height:none!important;overflow:visible!important;}
      .category-section{margin-bottom:8px;}
      .summary-card .value{color:#000!important;}
      .summary-card.expense .value{color:#dc2626!important;}
      .summary-card.revenue .value{color:#16a34a!important;}
    }
  </style>
</head>
<body>

<!-- DESKTOP HEADER -->
<div class="desktop-header">
  <div class="desktop-header-inner">
    <div>
      <h1>Event Estimator</h1>
      <div class="business-name" id="desktopEmail">Loading...</div>
    </div>
    <div class="header-actions">
      <button class="btn-icon" onclick="cycleTheme()" title="Change theme"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button>
      <a onclick="logout()" style="color:var(--text-secondary);cursor:pointer;font-size:14px;">Logout</a>
    </div>
  </div>
  <nav class="desktop-nav">
    <a href="eventlogicpro.html">Dashboard</a>
    <a href="eventlogicpro-scheduler.html">Scheduler</a>
    <a href="eventlogicpro-members.html">Members</a>
    <a href="eventlogicpro-estimator.html" class="active">Estimator</a>
    <a href="eventlogicpro-settings.html">Settings</a>
  </nav>
</div>

<!-- MOBILE HEADER -->
<div class="mobile-header">
  <div class="mobile-header-bar">
    <h2>Event Estimator</h2>
    <button class="btn-icon" onclick="cycleTheme()"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button>
  </div>
</div>

<div class="page-container">
  <!-- EVENT INFO -->
  <div class="event-header">
    <div class="event-header-row">
      <div class="form-group">
        <label class="form-label">Event Name</label>
        <input type="text" class="form-input" id="eventName" placeholder="e.g., Summer Bash 2026" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="form-label">Event Date</label>
        <input type="date" class="form-input" id="eventDate" oninput="autoSave()">
      </div>
      <div class="form-group">
        <label class="form-label">Expected Attendance</label>
        <input type="number" class="form-input" id="eventAttendance" placeholder="200" oninput="autoSave()">
      </div>
    </div>
  </div>

  <!-- SUMMARY DASHBOARD -->
  <div class="summary-bar">
    <div class="summary-card expense"><div class="label">Total Expenses</div><div class="value" id="totalExpenses">$0</div></div>
    <div class="summary-card revenue"><div class="label">Total Revenue</div><div class="value" id="totalRevenue">$0</div></div>
    <div class="summary-card profit"><div class="label">Net Profit / Loss</div><div class="value" id="netProfit">$0</div></div>
    <div class="summary-card items"><div class="label">Line Items</div><div class="value" id="totalItems">0</div></div>
  </div>

  <!-- TOOLBAR -->
  <div class="toolbar">
    <div class="toolbar-left">
      <span class="section-title">Expense Categories</span>
    </div>
    <div class="toolbar-right">
      <button class="toggle-all-btn" onclick="toggleAllSections()">Expand All</button>
      <button class="btn-secondary" onclick="window.print()" style="padding:6px 14px;font-size:12px;">Print</button>
    </div>
  </div>

  <!-- CATEGORIES WILL BE RENDERED HERE -->
  <div id="categoriesContainer"></div>

  <!-- REVENUE -->
  <div class="toolbar" style="margin-top:32px;">
    <div class="toolbar-left">
      <span class="section-title" style="color:#22c55e;">Revenue Sources</span>
    </div>
  </div>
  <div id="revenueContainer"></div>

  <!-- ACTIONS -->
  <div class="action-bar">
    <button class="btn-secondary" onclick="resetEstimate()">Reset All</button>
    <button class="btn-secondary" onclick="exportCSV()">Export CSV</button>
    <button class="btn-primary" onclick="saveEstimate()">Save Estimate</button>
  </div>
</div>

<div id="toast" class="toast"></div>

<!-- MOBILE NAV -->
<div class="mobile-bottom-nav">
  <div class="mobile-nav-row">
    <a href="eventlogicpro.html" class="mobile-nav-btn">Dashboard</a>
    <a href="eventlogicpro-scheduler.html" class="mobile-nav-btn">Scheduler</a>
    <a href="eventlogicpro-estimator.html" class="mobile-nav-btn active">Estimator</a>
  </div>
  <div class="mobile-nav-row">
    <a href="eventlogicpro-members.html" class="mobile-nav-btn">Members</a>
    <a href="eventlogicpro-settings.html" class="mobile-nav-btn">Settings</a>
    <button class="mobile-nav-btn" onclick="saveEstimate()" style="background:var(--accent-primary);color:white;border-color:var(--accent-primary);">Save</button>
  </div>
</div>

<script>
const SUPABASE_URL='https://kxqkwpkmtgvmthpafoqx.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';
const sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
var tenantId=null,userId=null;

// ============ CATEGORY DEFINITIONS ============
var EXPENSE_CATEGORIES = [
  { id:'venue',        icon:'ðŸ›ï¸', color:'#3b82f6', title:'Venue',                items:['Locate potential venues / get rental details','Construct proposal with budget','Secure venue','Site plan for event considering all depts','Power upgrades'] },
  { id:'food',         icon:'ðŸ½ï¸', color:'#f97316', title:'Food',                 items:['Multi-level menu creation','Sponsor menu','Food shopping','Food service area setup','Rental equipment for food service'] },
  { id:'bar',          icon:'ðŸ¸', color:'#8b5cf6', title:'Bar',                  items:['Inventory & restock order','Specials drink menu','Sponsor drink special','Hire bartenders / bar backs','Ice machine / coolers','Outside bar setup'] },
  { id:'entertainment',icon:'ðŸŽ¤', color:'#ec4899', title:'Entertainment Booking', items:['Headliner booking','Band support','Band opener','Go-Go dancers / performers','Deposits & payments','Backstage area setup','Sound/stage requirements'] },
  { id:'rentals',      icon:'ðŸš›', color:'#14b8a6', title:'Rentals',              items:['Department rental needs collection','Porta potties & sinks','Shuttle vans','Tables / chairs / tents','Delivery & pickup scheduling'] },
  { id:'stage_sound',  icon:'ðŸ”Š', color:'#6366f1', title:'Stage / Lights / Sound',items:['Indoor equipment test & setup','Outdoor equipment test & setup','XLR cables count & test','Speaker repair/replace','Dance platform setup','Lighting setup (indoor/outdoor/cage)','Live sound operation'] },
  { id:'security',     icon:'ðŸ›¡ï¸', color:'#ef4444', title:'Security',             items:['Pay gate setup','Lower gate post','Guard schedules (pay gate & lower gate)','Shuttle driver schedules','Radios (inspect/test/charge)','Security post manning','Personnel pay'] },
  { id:'parking',      icon:'ðŸ…¿ï¸', color:'#0ea5e9', title:'Parking',              items:['Secure Parking Lot A','Secure Parking Lot B','Secure Parking Lot C (overflow)','Security coordination per lot','Signage creation','Post locations to socials & web'] },
  { id:'permits',      icon:'ðŸ“‹', color:'#a78bfa', title:'Permits & Licenses',   items:['Identify permits & licenses needed','Application fees','Permit processing'] },
  { id:'media',        icon:'ðŸŽ¨', color:'#f472b6', title:'Media & Print',        items:['Handbill flyer design & print','Poster AD 11x17','Event ticket design & print','Shirt design (front & back)','Poster for sale at event','Website ads','Mobile ads'] },
  { id:'merch',        icon:'ðŸ‘•', color:'#fbbf24', title:'Merchandise',          items:['Merch budget establishment','Event shirt order','Merch booth items (shirts, hats, etc.)','Poker chips','Sponsor shirt bagging','Thank you notes with event art','Merch booth setup'] },
  { id:'sponsors',     icon:'ðŸ¤', color:'#22c55e', title:'Sponsors',             items:['Sponsor donation collection','VIP sponsor experience package','Banner locations & posting','Sponsor certificates','Thank you notes & invoices'] },
  { id:'vendors',      icon:'ðŸª', color:'#fb923c', title:'Vendors',              items:['Vendor power mapping','Web booking slot setup','Vendor site map creation','Powered/non-powered zone pricing','Vendor location verification'] },
  { id:'medical',      icon:'ðŸ¥', color:'#dc2626', title:'Medical',              items:['Medical supply inventory','Supply restock','Emergency medical location/tent','Medical water cooler'] },
  { id:'socials',      icon:'ðŸ“±', color:'#06b6d4', title:'Social Media',         items:['Social media countdown campaign','Media asset meetings','Campaign ad creation','Post scheduling'] },
  { id:'website',      icon:'ðŸŒ', color:'#84cc16', title:'Website',              items:['Event page creation/updates','Ticket integration','Site map hosting','Event info updates'] }
];

var REVENUE_CATEGORIES = [
  { id:'rev_tickets',  icon:'ðŸŽŸï¸', color:'#22c55e', title:'Ticket Sales',        items:['General admission','VIP tickets','Early bird tickets'] },
  { id:'rev_sponsors', icon:'ðŸ’°', color:'#16a34a', title:'Sponsor Revenue',      items:['Platinum sponsors','Gold sponsors','Silver sponsors','Media sponsors'] },
  { id:'rev_vendors',  icon:'ðŸª', color:'#059669', title:'Vendor Fees',          items:['Powered booth fees','Non-powered booth fees'] },
  { id:'rev_bar',      icon:'ðŸ¸', color:'#10b981', title:'Bar Revenue',          items:['Drink sales estimate'] },
  { id:'rev_merch',    icon:'ðŸ‘•', color:'#34d399', title:'Merch Sales',          items:['Shirt sales','Hat sales','Other merch'] }
];

// ============ STATE ============
var estimateData = {};  // { categoryId: [ {name, estimated, actual} ] }
var allSectionsExpanded = false;

function initData() {
  EXPENSE_CATEGORIES.forEach(function(cat) {
    if (!estimateData[cat.id]) {
      estimateData[cat.id] = cat.items.map(function(item) {
        return { name: item, estimated: 0, actual: 0 };
      });
    }
  });
  REVENUE_CATEGORIES.forEach(function(cat) {
    if (!estimateData[cat.id]) {
      estimateData[cat.id] = cat.items.map(function(item) {
        return { name: item, estimated: 0, actual: 0 };
      });
    }
  });
}

// ============ RENDERING ============
function renderCategories() {
  var container = document.getElementById('categoriesContainer');
  var h = '';
  EXPENSE_CATEGORIES.forEach(function(cat) {
    h += renderCategorySection(cat, false);
  });
  container.innerHTML = h;

  var revContainer = document.getElementById('revenueContainer');
  var rh = '';
  REVENUE_CATEGORIES.forEach(function(cat) {
    rh += renderCategorySection(cat, true);
  });
  revContainer.innerHTML = rh;
}

function renderCategorySection(cat, isRevenue) {
  var items = estimateData[cat.id] || [];
  var total = items.reduce(function(s, i) { return s + (parseFloat(i.estimated) || 0); }, 0);
  var actualTotal = items.reduce(function(s, i) { return s + (parseFloat(i.actual) || 0); }, 0);
  var filledCount = items.filter(function(i) { return (parseFloat(i.estimated) || 0) > 0; }).length;

  var h = '<div class="category-section' + (isRevenue ? ' revenue-header' : '') + '" id="section-' + cat.id + '">';
  h += '<div class="category-header" onclick="toggleSection(\'' + cat.id + '\')">';
  h += '<div class="cat-left"><div class="cat-icon" style="background:' + cat.color + '22;color:' + cat.color + ';">' + cat.icon + '</div>';
  h += '<div><div class="cat-title">' + cat.title + '</div>';
  h += '<div class="cat-count">' + filledCount + ' of ' + items.length + ' items budgeted</div></div></div>';
  h += '<div class="cat-right"><div class="cat-total" style="color:' + cat.color + ';">$' + formatNum(total) + '</div>';
  h += '<span class="cat-chevron">â–¼</span></div></div>';

  h += '<div class="category-body"><div class="category-content">';
  h += '<div class="line-header"><span>Item</span><span>Estimated</span><span>Actual</span><span></span></div>';
  h += '<div class="line-items">';
  items.forEach(function(item, idx) {
    h += '<div class="line-item">';
    h += '<input type="text" class="line-item-name custom-input" value="' + escHtml(item.name) + '" onchange="updateItemName(\'' + cat.id + '\',' + idx + ',this.value)" placeholder="Line item name">';
    h += '<input type="number" value="' + (item.estimated || '') + '" placeholder="0.00" step="0.01" oninput="updateItem(\'' + cat.id + '\',' + idx + ',\'estimated\',this.value)">';
    h += '<input type="number" value="' + (item.actual || '') + '" placeholder="0.00" step="0.01" oninput="updateItem(\'' + cat.id + '\',' + idx + ',\'actual\',this.value)">';
    h += '<button class="line-item-remove" onclick="removeItem(\'' + cat.id + '\',' + idx + ')" title="Remove">Ã—</button>';
    h += '</div>';
  });
  h += '</div>';
  h += '<button class="add-line-btn" onclick="addItem(\'' + cat.id + '\')">+ Add line item</button>';
  h += '</div></div></div>';
  return h;
}

// ============ INTERACTIONS ============
function toggleSection(id) {
  var el = document.getElementById('section-' + id);
  if (el) el.classList.toggle('expanded');
}

function toggleAllSections() {
  allSectionsExpanded = !allSectionsExpanded;
  document.querySelectorAll('.category-section').forEach(function(s) {
    if (allSectionsExpanded) s.classList.add('expanded');
    else s.classList.remove('expanded');
  });
  document.querySelector('.toggle-all-btn').textContent = allSectionsExpanded ? 'Collapse All' : 'Expand All';
}

function updateItem(catId, idx, field, value) {
  if (estimateData[catId] && estimateData[catId][idx]) {
    estimateData[catId][idx][field] = parseFloat(value) || 0;
    updateTotals();
    updateCategoryTotal(catId);
    autoSave();
  }
}

function updateItemName(catId, idx, value) {
  if (estimateData[catId] && estimateData[catId][idx]) {
    estimateData[catId][idx].name = value;
    autoSave();
  }
}

function addItem(catId) {
  if (!estimateData[catId]) estimateData[catId] = [];
  estimateData[catId].push({ name: '', estimated: 0, actual: 0 });
  var section = document.getElementById('section-' + catId);
  if (section && !section.classList.contains('expanded')) section.classList.add('expanded');
  renderCategories();
  restoreExpandedSections();
  section = document.getElementById('section-' + catId);
  if (section) {
    section.classList.add('expanded');
    var inputs = section.querySelectorAll('.custom-input');
    if (inputs.length) inputs[inputs.length - 1].focus();
  }
  updateTotals();
}

function removeItem(catId, idx) {
  if (estimateData[catId]) {
    estimateData[catId].splice(idx, 1);
    var expanded = getExpandedSections();
    renderCategories();
    restoreExpandedSectionsList(expanded);
    updateTotals();
    autoSave();
  }
}

function updateCategoryTotal(catId) {
  var items = estimateData[catId] || [];
  var total = items.reduce(function(s, i) { return s + (parseFloat(i.estimated) || 0); }, 0);
  var section = document.getElementById('section-' + catId);
  if (section) {
    var totalEl = section.querySelector('.cat-total');
    if (totalEl) totalEl.textContent = '$' + formatNum(total);
    var countEl = section.querySelector('.cat-count');
    if (countEl) {
      var filled = items.filter(function(i) { return (parseFloat(i.estimated) || 0) > 0; }).length;
      countEl.textContent = filled + ' of ' + items.length + ' items budgeted';
    }
  }
}

function updateTotals() {
  var expenses = 0, revenue = 0, totalItems = 0;
  EXPENSE_CATEGORIES.forEach(function(cat) {
    var items = estimateData[cat.id] || [];
    items.forEach(function(i) { expenses += (parseFloat(i.estimated) || 0); });
    totalItems += items.length;
  });
  REVENUE_CATEGORIES.forEach(function(cat) {
    var items = estimateData[cat.id] || [];
    items.forEach(function(i) { revenue += (parseFloat(i.estimated) || 0); });
    totalItems += items.length;
  });
  var net = revenue - expenses;
  document.getElementById('totalExpenses').textContent = '$' + formatNum(expenses);
  document.getElementById('totalRevenue').textContent = '$' + formatNum(revenue);
  var profitEl = document.getElementById('netProfit');
  profitEl.textContent = (net >= 0 ? '+$' : '-$') + formatNum(Math.abs(net));
  profitEl.className = 'value ' + (net >= 0 ? 'positive' : 'negative');
  document.getElementById('totalItems').textContent = totalItems;
}

function getExpandedSections() {
  var expanded = [];
  document.querySelectorAll('.category-section.expanded').forEach(function(s) {
    expanded.push(s.id.replace('section-', ''));
  });
  return expanded;
}

function restoreExpandedSections() {
  // keep all expanded if toggled
  if (allSectionsExpanded) {
    document.querySelectorAll('.category-section').forEach(function(s) { s.classList.add('expanded'); });
  }
}

function restoreExpandedSectionsList(list) {
  list.forEach(function(id) {
    var el = document.getElementById('section-' + id);
    if (el) el.classList.add('expanded');
  });
}

// ============ SAVE / LOAD ============
var autoSaveTimer = null;
function autoSave() {
  clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(function() {
    localStorage.setItem('eventlogicpro-estimate', JSON.stringify({
      eventName: document.getElementById('eventName').value,
      eventDate: document.getElementById('eventDate').value,
      eventAttendance: document.getElementById('eventAttendance').value,
      data: estimateData
    }));
  }, 500);
}

function loadFromLocal() {
  try {
    var saved = JSON.parse(localStorage.getItem('eventlogicpro-estimate'));
    if (saved) {
      if (saved.eventName) document.getElementById('eventName').value = saved.eventName;
      if (saved.eventDate) document.getElementById('eventDate').value = saved.eventDate;
      if (saved.eventAttendance) document.getElementById('eventAttendance').value = saved.eventAttendance;
      if (saved.data) {
        // Merge saved data with defaults (to pick up any new items)
        Object.keys(saved.data).forEach(function(k) { estimateData[k] = saved.data[k]; });
      }
    }
  } catch(e) { console.log('No saved data'); }
}

async function saveEstimate() {
  autoSave(); // save to local
  showToast('Estimate saved locally!');
  // Future: save to Supabase event_estimates table
}

function resetEstimate() {
  if (!confirm('Reset all line items to zero? This cannot be undone.')) return;
  localStorage.removeItem('eventlogicpro-estimate');
  estimateData = {};
  document.getElementById('eventName').value = '';
  document.getElementById('eventDate').value = '';
  document.getElementById('eventAttendance').value = '';
  initData();
  renderCategories();
  updateTotals();
  showToast('Estimate reset');
}

// ============ EXPORT CSV ============
function exportCSV() {
  var rows = [['Category', 'Item', 'Estimated', 'Actual']];
  var allCats = EXPENSE_CATEGORIES.concat(REVENUE_CATEGORIES);
  allCats.forEach(function(cat) {
    var items = estimateData[cat.id] || [];
    items.forEach(function(item) {
      rows.push([cat.title, '"' + (item.name || '').replace(/"/g, '""') + '"', item.estimated || 0, item.actual || 0]);
    });
  });
  var csv = rows.map(function(r) { return r.join(','); }).join('\n');
  var blob = new Blob([csv], { type: 'text/csv' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = (document.getElementById('eventName').value || 'event') + '-estimate.csv';
  a.click();
  URL.revokeObjectURL(url);
  showToast('CSV exported!');
}

// ============ UTILS ============
function formatNum(n) {
  return n.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
}

function escHtml(s) {
  return (s || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

function showToast(m) {
  var t = document.getElementById('toast');
  t.textContent = m;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2000);
}

// ============ THEME ============
var THEME_NAMES={'dark-blue':'Dark Blue','blue-light':'Blue Light','slate-dark':'Slate Dark','slate-light':'Slate Light','ocean-dark':'Ocean Dark','ocean-light':'Ocean Light','midnight-dark':'Midnight','lavender-light':'Lavender','forest-dark':'Forest','mint-light':'Mint','crimson-dark':'Crimson','coral-light':'Coral','amber-dark':'Amber','honey-light':'Honey','rose-dark':'Rose','sky-light':'Sky','cyber-dark':'Cyber','sand-light':'Sand','grey':'Grey','charcoal':'Charcoal','navy':'Navy','graphite':'Graphite','obsidian':'Obsidian','steel':'Steel','espresso':'Espresso','onyx':'Onyx'};
var themeKeys=Object.keys(THEME_NAMES),themeIndex=0;
function cycleTheme(){themeIndex=(themeIndex+1)%themeKeys.length;var t=themeKeys[themeIndex];document.documentElement.setAttribute('data-theme',t);localStorage.setItem('app-theme',t);showToast(THEME_NAMES[t]||t);}

// ============ AUTH ============
async function logout(){await sb.auth.signOut();localStorage.removeItem('sb_access_token');localStorage.removeItem('sb_refresh_token');window.location.href='login.html';}

async function init() {
  initData();
  loadFromLocal();
  renderCategories();
  updateTotals();

  // Auth
  try {
    var r=await sb.auth.getSession();
    var s=r.data.session;
    if(!s){
      var t=localStorage.getItem('sb_access_token'),rf=localStorage.getItem('sb_refresh_token');
      if(t&&rf){var sr=await sb.auth.setSession({access_token:t,refresh_token:rf});s=sr.data?.session;}
    }
    if(s&&s.user){
      document.getElementById('desktopEmail').textContent=s.user.email;
      var ur=await sb.from('users').select('user_id,tenant_id').eq('email',s.user.email).single();
      if(ur.data){userId=ur.data.user_id;tenantId=ur.data.tenant_id;}
    }
  } catch(e){console.log('Auth check:',e);}

  // Set theme index
  var currentTheme=localStorage.getItem('app-theme')||'dark-blue';
  themeIndex=themeKeys.indexOf(currentTheme);
  if(themeIndex<0)themeIndex=0;
}

init();
</script>
</body>
</html>
