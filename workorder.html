<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Work Order - Service Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #667eea;
      --primary-dark: #764ba2;
      --charcoal: #36454f;
      --white: #ffffff;
      --bg: #f5f7fa;
      --shadow: rgba(0, 0, 0, 0.08);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--charcoal);
      min-height: 100vh;
    }

    /* Topbar */
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: var(--white);
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      padding: 0 2rem;
      z-index: 100;
      box-shadow: 0 2px 10px var(--shadow);
    }

    .logo {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .back-btn {
      margin-left: auto;
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      padding: 0.625rem 1.25rem;
      background: var(--white);
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      color: var(--charcoal);
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
    }

    .back-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Main Content */
    .main-content {
      margin-top: 70px;
      padding: 2.5rem 2rem;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }

    .page-header {
      margin-bottom: 2.5rem;
    }

    .page-title {
      font-size: 2.5rem;
      font-weight: 800;
      letter-spacing: -1px;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .page-subtitle {
      font-size: 1rem;
      color: #666;
      font-weight: 500;
    }

    /* Form Card */
    .form-card {
      background: var(--white);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 4px 20px var(--shadow);
      border: 1px solid #f0f0f0;
    }

    .form-section {
      margin-bottom: 2.5rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .form-section:last-child {
      border-bottom: none;
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--charcoal);
      margin-bottom: 1.5rem;
      letter-spacing: -0.3px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .form-grid.two-col {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--charcoal);
      margin-bottom: 0.5rem;
      letter-spacing: 0.3px;
    }

    input, select, textarea {
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      padding: 0.875rem 1rem;
      background: var(--white);
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      color: var(--charcoal);
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    input::placeholder, textarea::placeholder {
      color: #999;
      font-weight: 400;
    }

    /* Buttons */
    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 2.5rem;
    }

    .btn {
      flex: 1;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      padding: 1rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: 0.2px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--white);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-secondary {
      background: var(--white);
      border: 2px solid #e0e0e0;
      color: var(--charcoal);
    }

    .btn-secondary:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    /* Alert */
    .alert {
      padding: 1.25rem;
      border-radius: 12px;
      margin-top: 1.5rem;
      font-weight: 600;
      text-align: center;
      display: none;
    }

    .alert.show {
      display: block;
    }

    .alert.success {
      background: #d1fae5;
      color: #065f46;
      border: 2px solid #10b981;
    }

    .alert.error {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #ef4444;
    }

    @media (max-width: 768px) {
      .page-title { font-size: 2rem; }
      .form-card { padding: 2rem 1.5rem; }
      .button-group { flex-direction: column; }
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="logo">Service Manager</div>
    <a href="dashboard.html" class="back-btn">← Back</a>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="page-header">
      <h1 class="page-title">New Work Order</h1>
      <p class="page-subtitle">Create a new service appointment for your customer</p>
    </div>

    <!-- Form -->
    <div class="form-card">
      <form id="workOrderForm">
        <!-- Customer Selection -->
        <div class="form-section">
          <h3 class="section-title">Customer Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Select Customer</label>
              <select id="customer" required>
                <option value="">Choose an existing customer...</option>
                <option value="Michael Brown|408-555-2001|2021 Honda Accord">Michael Brown - 408-555-2001</option>
                <option value="Amanda Davis|408-555-2002|2023 Tesla Model 3">Amanda Davis - 408-555-2002</option>
                <option value="Robert Martinez|510-555-1001|2019 Sea Ray Sundancer">Robert Martinez - 510-555-1001</option>
                <option value="James Miller|408-555-3001|2020 John Deere X350">James Miller - 408-555-3001</option>
                <option value="Daniel Taylor|650-555-4001|Refrigerator - Samsung RF28R7201SR">Daniel Taylor - 650-555-4001</option>
                <option value="new">+ Add New Customer</option>
              </select>
            </div>
          </div>

          <!-- New Customer Fields (hidden by default) -->
          <div id="newCustomerFields" style="display: none; margin-top: 1.5rem;">
            <div class="form-grid two-col">
              <div class="form-group">
                <label>First Name</label>
                <input type="text" id="firstName" placeholder="Enter first name">
              </div>
              <div class="form-group">
                <label>Last Name</label>
                <input type="text" id="lastName" placeholder="Enter last name">
              </div>
            </div>
            <div class="form-grid two-col" style="margin-top: 1.5rem;">
              <div class="form-group">
                <label>Phone</label>
                <input type="tel" id="phone" placeholder="Enter phone number">
              </div>
              <div class="form-group">
                <label>Vehicle/Equipment</label>
                <input type="text" id="vehicle" placeholder="e.g., 2021 Honda Accord">
              </div>
            </div>
          </div>
        </div>

        <!-- Service Details -->
        <div class="form-section">
          <h3 class="section-title">Service Details</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Service Type</label>
              <select id="serviceType" required>
                <option value="">Select service...</option>
                <option value="Oil Change & Filter">Oil Change & Filter</option>
                <option value="Brake Service">Brake Service</option>
                <option value="Engine Service">Engine Service</option>
                <option value="Boat Detailing">Boat Detailing</option>
                <option value="Mower Tune-Up">Mower Tune-Up</option>
                <option value="Refrigerator Repair">Refrigerator Repair</option>
                <option value="General Inspection">General Inspection</option>
                <option value="Transmission Service">Transmission Service</option>
              </select>
            </div>

            <div class="form-grid two-col">
              <div class="form-group">
                <label>Scheduled Date</label>
                <input type="date" id="scheduledDate" required>
              </div>
              <div class="form-group">
                <label>Start Time</label>
                <input type="time" id="startTime" value="10:00" required>
              </div>
            </div>

            <div class="form-grid two-col">
              <div class="form-group">
                <label>End Time</label>
                <input type="time" id="endTime" value="11:00" required>
              </div>
              <div class="form-group">
                <label>Priority</label>
                <select id="priority" required>
                  <option value="low">Low</option>
                  <option value="normal" selected>Normal</option>
                  <option value="high">High</option>
                  <option value="urgent">Urgent</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>Internal Notes</label>
              <textarea id="notes" placeholder="Add any internal notes or special instructions..."></textarea>
            </div>
          </div>
        </div>

        <!-- Pricing -->
        <div class="form-section">
          <h3 class="section-title">Pricing</h3>
          <div class="form-grid two-col">
            <div class="form-group">
              <label>Total Amount</label>
              <input type="number" id="totalAmount" step="0.01" placeholder="0.00" required>
            </div>
            <div class="form-group">
              <label>Labor Cost</label>
              <input type="number" id="laborTotal" step="0.01" placeholder="0.00" required>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="button-group">
          <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
          <button type="submit" class="btn btn-primary">Create Work Order</button>
        </div>
      </form>

      <div id="alert" class="alert"></div>
    </div>
  </div>

  <script>
    if (!sessionStorage.getItem('isAuthenticated')) {
      window.location.href = 'login.html';
    }

    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('scheduledDate').value = tomorrow.toISOString().split('T')[0];

    // Toggle new customer fields
    document.getElementById('customer').addEventListener('change', function() {
      const newCustomerFields = document.getElementById('newCustomerFields');
      if (this.value === 'new') {
        newCustomerFields.style.display = 'block';
        document.getElementById('firstName').required = true;
        document.getElementById('lastName').required = true;
        document.getElementById('phone').required = true;
        document.getElementById('vehicle').required = true;
      } else {
        newCustomerFields.style.display = 'none';
        document.getElementById('firstName').required = false;
        document.getElementById('lastName').required = false;
        document.getElementById('phone').required = false;
        document.getElementById('vehicle').required = false;
      }
    });

    document.getElementById('workOrderForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      await createWorkOrder();
    });

    async function createWorkOrder() {
      const customerSelect = document.getElementById('customer').value;
      
      let customerName, phone, vehicle;
      
      if (customerSelect === 'new') {
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        customerName = `${firstName} ${lastName}`;
        phone = document.getElementById('phone').value;
        vehicle = document.getElementById('vehicle').value;
      } else if (customerSelect) {
        const parts = customerSelect.split('|');
        customerName = parts[0];
        phone = parts[1];
        vehicle = parts[2];
      } else {
        showAlert('Please select a customer', 'error');
        return;
      }

      const serviceType = document.getElementById('serviceType').value;
      const scheduledDate = document.getElementById('scheduledDate').value;
      const totalAmount = parseFloat(document.getElementById('totalAmount').value);

      showAlert('Creating work order...', 'success');

      await new Promise(resolve => setTimeout(resolve, 1000));

      const orderNumber = 'RO-2025-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');

      let mockOrders = JSON.parse(sessionStorage.getItem('mockOrders') || '[]');
      mockOrders.push({
        id: mockOrders.length + 4,
        order_number: orderNumber,
        customer: customerName,
        phone: phone,
        vehicle: vehicle,
        service: serviceType,
        scheduled_date: scheduledDate,
        status: 'scheduled',
        total_amount: totalAmount
      });
      sessionStorage.setItem('mockOrders', JSON.stringify(mockOrders));

      showAlert(`✓ Work order ${orderNumber} created successfully for ${customerName}!`, 'success');
      
      setTimeout(() => {
        window.location.href = 'dashboard.html';
      }, 1500);
    }

    function showAlert(message, type) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = `alert ${type} show`;
    }

    function resetForm() {
      document.getElementById('workOrderForm').reset();
      document.getElementById('alert').classList.remove('show');
      document.getElementById('newCustomerFields').style.display = 'none';
      
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('scheduledDate').value = tomorrow.toISOString().split('T')[0];
    }
  </script>
</body>
</html>
