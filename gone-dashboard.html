<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gone – Your Story</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background: #0a0a0a;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: #ffffff;
    }

    /* Colors */
    :root {
      --primary: #0ea5e9;
      --primary-hover: #0284c7;
      --accent: #2dd4bf;
      --accent-hover: #14b8a6;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(10, 10, 10, 0.95);
      border-bottom: 1px solid #1a1a1a;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }

    .logo-box {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: #fff;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 600;
      color: #fff;
    }

    .nav {
      display: flex;
      gap: 8px;
    }

    .nav-btn {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 8px;
      border: 1px solid #2a2a2a;
      background: transparent;
      color: #888;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      border-color: #444;
      color: #fff;
    }

    .nav-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    /* Main Layout */
    .main {
      display: grid;
      grid-template-columns: 1fr 380px;
      min-height: 100vh;
      padding-top: 73px;
    }

    .content {
      padding: 24px;
      overflow-y: auto;
    }

    /* Stats Row */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      line-height: 1;
    }

    .stat-label {
      font-size: 11px;
      color: #666;
      margin-top: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Two Column Layout */
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    .two-col .section {
      margin-bottom: 0;
    }

    .two-col .current-question {
      padding: 20px 16px;
    }

    .two-col .question-number-large {
      width: 44px;
      height: 44px;
      font-size: 18px;
      margin-bottom: 16px;
    }

    .two-col .question-text-large {
      font-size: 15px;
      margin-bottom: 8px;
    }

    .two-col .question-category {
      margin-bottom: 20px;
    }

    .two-col .question-actions {
      gap: 8px;
    }

    .two-col .btn-answer,
    .two-col .btn-skip {
      padding: 10px 24px;
      font-size: 13px;
    }

    .two-col .question-nav {
      margin-top: 16px;
      padding-top: 16px;
    }

    /* Compact List */
    .compact-list {
      padding: 12px;
    }

    .compact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .compact-item:last-child {
      margin-bottom: 0;
    }

    .compact-avatar {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      flex-shrink: 0;
    }

    .compact-info {
      flex: 1;
      min-width: 0;
    }

    .compact-name {
      font-size: 13px;
      font-weight: 500;
    }

    .compact-sub {
      font-size: 11px;
      color: #666;
    }

    .compact-badge {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent);
      background: rgba(45, 212, 191, 0.1);
      padding: 2px 8px;
      border-radius: 10px;
    }

    .add-btn {
      padding: 4px 12px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 6px;
      border: 1px solid var(--primary);
      background: transparent;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-btn:hover {
      background: var(--primary);
      color: #fff;
    }

    /* Last Requests */
    .last-requests {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 16px;
    }

    .request-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .request-card:hover {
      border-color: var(--primary);
      background: #111;
    }

    .request-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .request-content {
      flex: 1;
      min-width: 0;
    }

    .request-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .request-desc {
      font-size: 11px;
      color: #666;
      line-height: 1.3;
    }

    .request-status {
      font-size: 10px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 12px;
      flex-shrink: 0;
    }

    .request-status.incomplete {
      background: rgba(14, 165, 233, 0.1);
      color: var(--primary);
    }

    .request-status.complete {
      background: rgba(45, 212, 191, 0.1);
      color: var(--accent);
    }

    /* Sections */
    .section {
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .section-header {
      padding: 16px 20px;
      border-bottom: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .section-tabs {
      display: flex;
      gap: 6px;
    }

    .section-tab {
      padding: 6px 14px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 6px;
      border: 1px solid #2a2a2a;
      background: transparent;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .section-tab:hover {
      border-color: #444;
      color: #fff;
    }

    .section-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    /* Question Progress */
    .question-progress {
      font-size: 12px;
      color: #666;
    }

    /* Current Question */
    .current-question {
      padding: 32px 24px;
    }

    .question-number-large {
      width: 60px;
      height: 60px;
      background: var(--primary);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 24px;
      margin: 0 auto 24px;
    }

    .question-number-large.answered {
      background: var(--accent);
    }

    .question-text-large {
      font-size: 20px;
      line-height: 1.6;
      text-align: center;
      margin-bottom: 12px;
      color: #fff;
    }

    .question-category {
      font-size: 12px;
      color: var(--accent);
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 32px;
    }

    .question-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .btn-answer {
      padding: 14px 40px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 10px;
      background: var(--primary);
      border: 1px solid var(--primary);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-answer:hover {
      background: var(--primary-hover);
      border-color: var(--primary-hover);
    }

    .btn-skip {
      padding: 14px 40px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 10px;
      background: transparent;
      border: 1px solid #2a2a2a;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-skip:hover {
      border-color: #444;
      color: #fff;
    }

    .question-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #1a1a1a;
    }

    .btn-nav {
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 8px;
      background: transparent;
      border: 1px solid #2a2a2a;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-nav:hover:not(:disabled) {
      border-color: #444;
      color: #fff;
    }

    .btn-nav:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .all-done {
      text-align: center;
      padding: 40px;
    }

    .all-done-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 12px;
    }

    .all-done-text {
      font-size: 14px;
      color: #888;
    }

    /* Category Pills */
    .category-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 16px 20px;
    }

    .category-pill {
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 20px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-pill:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .category-pill.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .category-pill .count {
      margin-left: 6px;
      opacity: 0.7;
    }

    /* Submit Button */
    .submit-btn {
      display: block;
      width: 100%;
      padding: 14px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 10px;
      border: 1px dashed var(--accent);
      background: transparent;
      color: var(--accent);
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 20px;
    }

    .submit-btn:hover {
      background: rgba(45, 212, 191, 0.1);
      border-style: solid;
    }

    /* Sidebar */
    .sidebar {
      background: #0f0f0f;
      border-left: 1px solid #1a1a1a;
      display: flex;
      flex-direction: column;
      height: calc(100vh - 73px);
      position: sticky;
      top: 73px;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #1a1a1a;
      flex-shrink: 0;
    }

    .sidebar-tabs {
      display: flex;
      gap: 6px;
    }

    .sidebar-tab {
      flex: 1;
      padding: 10px 8px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 8px;
      border: 1px solid #2a2a2a;
      background: transparent;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sidebar-tab:hover {
      border-color: #444;
      color: #fff;
    }

    .sidebar-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .sidebar-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      overflow: hidden;
      min-height: 0;
    }

    .sidebar-panel {
      display: none;
      flex: 1;
      flex-direction: column;
      min-height: 0;
      overflow-y: auto;
    }

    .sidebar-panel.active {
      display: flex;
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 16px;
    }

    /* Chat */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 8px;
      min-height: 0;
    }

    .chat-message {
      margin-bottom: 12px;
      max-width: 90%;
    }

    .chat-message.assistant {
      margin-right: auto;
    }

    .chat-message.user {
      margin-left: auto;
    }

    .chat-bubble {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.5;
    }

    .assistant .chat-bubble {
      background: #1a1a1a;
      border-bottom-left-radius: 4px;
    }

    .user .chat-bubble {
      background: var(--primary);
      border-bottom-right-radius: 4px;
    }

    .chat-input-row {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
      padding-top: 12px;
      border-top: 1px solid #1a1a1a;
      margin-top: auto;
    }

    .chat-input {
      flex: 1;
      padding: 12px 14px;
      font-size: 13px;
      border-radius: 10px;
      border: 1px solid #2a2a2a;
      background: #0a0a0a;
      color: #fff;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .chat-send {
      padding: 12px 16px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 10px;
      background: var(--primary);
      border: none;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .chat-send:hover {
      background: var(--primary-hover);
    }

    /* Assistant Mode Selection */
    .assistant-mode-select {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .mode-title {
      font-size: 14px;
      color: #888;
      margin-bottom: 24px;
      text-align: center;
    }

    .mode-cards {
      display: flex;
      gap: 12px;
      width: 100%;
    }

    .mode-card {
      flex: 1;
      padding: 24px 16px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .mode-card:hover {
      border-color: var(--primary);
      background: #111;
    }

    .mode-card-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }

    .mode-card-label {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }

    .mode-card-desc {
      font-size: 11px;
      color: #666;
    }

    /* Assistant Type Mode */
    .assistant-type {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .back-btn {
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 500;
      border-radius: 6px;
      border: 1px solid #2a2a2a;
      background: transparent;
      color: #666;
      cursor: pointer;
      margin-bottom: 12px;
      align-self: flex-start;
      transition: all 0.2s;
    }

    .back-btn:hover {
      border-color: #444;
      color: #fff;
    }

    /* Assistant Voice Mode */
    .assistant-voice {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .voice-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .voice-orb {
      width: 120px;
      height: 120px;
      position: relative;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .orb-inner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 50%;
      transition: all 0.3s;
    }

    .voice-orb:hover .orb-inner {
      transform: translate(-50%, -50%) scale(1.05);
    }

    .orb-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid var(--primary);
      border-radius: 50%;
      opacity: 0;
    }

    .orb-ring:nth-child(2) { width: 90px; height: 90px; }
    .orb-ring:nth-child(3) { width: 105px; height: 105px; }
    .orb-ring:nth-child(4) { width: 120px; height: 120px; }

    .voice-orb.listening .orb-inner {
      animation: orb-pulse 1.5s ease-in-out infinite;
    }

    .voice-orb.listening .orb-ring {
      animation: ring-expand 1.5s ease-out infinite;
    }

    .voice-orb.listening .orb-ring:nth-child(3) {
      animation-delay: 0.2s;
    }

    .voice-orb.listening .orb-ring:nth-child(4) {
      animation-delay: 0.4s;
    }

    @keyframes orb-pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
    }

    @keyframes ring-expand {
      0% { 
        opacity: 0.6; 
        transform: translate(-50%, -50%) scale(0.8);
      }
      100% { 
        opacity: 0; 
        transform: translate(-50%, -50%) scale(1.2);
      }
    }

    .voice-status {
      font-size: 13px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 16px;
    }

    .voice-transcript {
      width: 100%;
      padding: 16px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
      font-size: 13px;
      color: #666;
      line-height: 1.5;
      min-height: 80px;
      text-align: center;
    }

    /* Scheduled Section (Always Visible) */
    .scheduled-section {
      border-top: 1px solid #1a1a1a;
      flex-shrink: 0;
      max-height: 200px;
      display: flex;
      flex-direction: column;
    }

    .scheduled-header-bar {
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      background: #0a0a0a;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #888;
    }

    .scheduled-header-bar:hover {
      background: #111;
    }

    .scheduled-count {
      background: var(--accent);
      color: #000;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
    }

    .scheduled-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px 12px;
    }

    /* Time Capsule Panel */
    .capsule-form {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding-bottom: 8px;
    }

    .capsule-recipient {
      margin-bottom: 12px;
    }

    .capsule-label {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }

    .capsule-select {
      width: 100%;
      padding: 10px 12px;
      font-size: 13px;
      border-radius: 8px;
      border: 1px solid #2a2a2a;
      background: #0a0a0a;
      color: #fff;
    }

    .capsule-select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .capsule-date {
      margin-bottom: 12px;
    }

    .datetime-row {
      display: flex;
      gap: 8px;
    }

    .datetime-input {
      flex: 1;
      padding: 10px 12px;
      font-size: 13px;
      border-radius: 8px;
      border: 1px solid #2a2a2a;
      background: #0a0a0a;
      color: #fff;
      color-scheme: dark;
    }

    .datetime-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .date-presets {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .date-preset {
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 6px;
      border: 1px solid #2a2a2a;
      background: transparent;
      color: #888;
      cursor: pointer;
      transition: all 0.2s;
    }

    .date-preset:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .date-preset.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
    }

    .capsule-message {
      margin-bottom: 12px;
    }

    .capsule-textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 13px;
      border-radius: 10px;
      border: 1px solid #2a2a2a;
      background: #0a0a0a;
      color: #fff;
      resize: none;
      font-family: inherit;
      min-height: 80px;
    }

    .capsule-textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .capsule-attachments {
      margin-bottom: 12px;
    }

    .attachment-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 12px;
      font-size: 13px;
      border-radius: 10px;
      border: 1px dashed #2a2a2a;
      background: transparent;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .attachment-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .attachment-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .attachment-thumb {
      width: 60px;
      height: 60px;
      background: #2a2a2a;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }

    .attachment-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .attachment-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 18px;
      height: 18px;
      background: rgba(0,0,0,0.7);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }

    .capsule-send {
      width: 100%;
      padding: 12px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border: none;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .capsule-send:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    /* Scheduled Messages */
    .scheduled-list {
      flex: 1;
      overflow-y: auto;
    }

    .scheduled-item {
      padding: 10px 12px;
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .scheduled-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .scheduled-to {
      font-size: 12px;
      font-weight: 500;
    }

    .scheduled-date {
      font-size: 10px;
      color: var(--accent);
      background: rgba(45, 212, 191, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .scheduled-preview {
      font-size: 11px;
      color: #666;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .scheduled-attachments {
      display: flex;
      gap: 4px;
      margin-top: 4px;
    }

    .scheduled-attachments span {
      font-size: 10px;
      color: #555;
      background: #1a1a1a;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 18px;
      width: 100%;
      max-width: 560px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      background: transparent;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      color: #888;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-question {
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
      color: #ddd;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      color: #888;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 14px;
      font-size: 14px;
      border-radius: 10px;
      border: 1px solid #2a2a2a;
      background: #0a0a0a;
      color: #fff;
      transition: border-color 0.2s;
    }

    .form-textarea {
      min-height: 150px;
      resize: vertical;
      font-family: inherit;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .image-upload-area {
      border: 2px dashed #2a2a2a;
      border-radius: 10px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .image-upload-area:hover {
      border-color: var(--primary);
    }

    .image-upload-area.dragover {
      border-color: var(--primary);
      background: rgba(14, 165, 233, 0.1);
    }

    .upload-text {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    .upload-hint {
      font-size: 12px;
      color: #444;
    }

    .uploaded-images {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .uploaded-image {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .uploaded-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .uploaded-image button {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 20px;
      height: 20px;
      background: rgba(0,0,0,0.7);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }

    .previous-answer {
      padding: 14px;
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
      margin-top: 16px;
    }

    .previous-answer-label {
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .previous-answer-text {
      font-size: 13px;
      color: #888;
      line-height: 1.5;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #2a2a2a;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .btn {
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      border: 1px solid var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      border-color: var(--primary-hover);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid #2a2a2a;
      color: #888;
    }

    .btn-secondary:hover {
      border-color: #444;
      color: #fff;
    }

    .empty-state {
      padding: 40px 20px;
      text-align: center;
      color: #555;
      font-size: 14px;
    }

    /* Mobile */
    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .two-col {
        grid-template-columns: 1fr;
      }

      .last-requests {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .header {
        padding: 12px 16px;
      }

      .content {
        padding: 16px;
      }

      .nav-btn span {
        display: none;
      }
    }
  </style>
</head>
<body>

<!-- Header -->
<header class="header">
  <a href="#" class="logo">
    <div class="logo-box">G</div>
    <span class="logo-text">Gone</span>
  </a>
  <nav class="nav">
    <a href="gone-dashboard.html" class="nav-btn active">Dashboard</a>
    <a href="gone-mystory.html" class="nav-btn">My Story</a>
    <a href="#" class="nav-btn">Recipients</a>
    <a href="gone-settings.html" class="nav-btn">Settings</a>
    <button class="nav-btn" onclick="logout()">Logout</button>
  </nav>
</header>

<!-- Main -->
<div class="main">
  <div class="content">
    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value" id="statAnswered">0</div>
        <div class="stat-label">Answered</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statPhotos">0</div>
        <div class="stat-label">Photos</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statMessages">0</div>
        <div class="stat-label">Scheduled</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statRecipients">0</div>
        <div class="stat-label">Recipients</div>
      </div>
    </div>

    <!-- Two Column: Family & Life Story -->
    <div class="two-col">
      <!-- My Loved Ones -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Family & Friends</div>
          <button class="add-btn" onclick="openRecipientModal()">Add</button>
        </div>
        <div class="compact-list" id="recipientsList">
          <div class="compact-item">
            <div class="compact-avatar">S</div>
            <div class="compact-info">
              <div class="compact-name">Sarah</div>
              <div class="compact-sub">Daughter</div>
            </div>
            <div class="compact-badge">3</div>
          </div>
          <div class="compact-item">
            <div class="compact-avatar">M</div>
            <div class="compact-info">
              <div class="compact-name">Michael</div>
              <div class="compact-sub">Son</div>
            </div>
            <div class="compact-badge">2</div>
          </div>
        </div>
      </div>

      <!-- Current Question -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Life Story</div>
          <div class="question-progress" id="questionProgress">0 of 48</div>
        </div>
        <div class="current-question" id="currentQuestion">
          <div class="question-number-large">1</div>
          <div class="question-text-large">What is your earliest childhood memory?</div>
          <div class="question-category">Childhood</div>
          <div class="question-actions">
            <button class="btn-answer" onclick="openAnswerModal()">Answer</button>
            <button class="btn-skip" onclick="skipQuestion()">Skip</button>
          </div>
          <div class="question-nav">
            <button class="btn-nav" onclick="prevQuestion()" disabled>Prev</button>
            <span style="font-size:11px;color:#666;">1 / 48</span>
            <button class="btn-nav" onclick="nextQuestion()">Next</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Last Requests -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">Last Requests</div>
      </div>
      <div class="last-requests">
        <div class="request-card" onclick="openRequestModal('funeral')">
          <div class="request-icon">◯</div>
          <div class="request-content">
            <div class="request-title">Funeral Wishes</div>
            <div class="request-desc">Music, readings, and how you want to be remembered</div>
          </div>
          <div class="request-status incomplete">Add</div>
        </div>
        <div class="request-card" onclick="openRequestModal('belongings')">
          <div class="request-icon">◇</div>
          <div class="request-content">
            <div class="request-title">Special Belongings</div>
            <div class="request-desc">Who should receive meaningful items</div>
          </div>
          <div class="request-status incomplete">Add</div>
        </div>
        <div class="request-card" onclick="openRequestModal('words')">
          <div class="request-icon">♡</div>
          <div class="request-content">
            <div class="request-title">Final Words</div>
            <div class="request-desc">Messages to be shared after you're gone</div>
          </div>
          <div class="request-status incomplete">Add</div>
        </div>
        <div class="request-card" onclick="openRequestModal('practical')">
          <div class="request-icon">□</div>
          <div class="request-content">
            <div class="request-title">Practical Matters</div>
            <div class="request-desc">Account info, passwords, important documents</div>
          </div>
          <div class="request-status incomplete">Add</div>
        </div>
      </div>
    </div>

    <!-- Categories -->
    <div class="section">
      <div class="section-header">
        <div class="section-title">Categories</div>
      </div>
      <div class="category-pills" id="categoryPills">
        <button class="category-pill active" onclick="selectCategory('all', this)">All <span class="count">48</span></button>
        <button class="category-pill" onclick="selectCategory('childhood', this)">Childhood <span class="count">8</span></button>
        <button class="category-pill" onclick="selectCategory('family', this)">Family <span class="count">10</span></button>
        <button class="category-pill" onclick="selectCategory('love', this)">Love <span class="count">6</span></button>
        <button class="category-pill" onclick="selectCategory('career', this)">Career <span class="count">7</span></button>
        <button class="category-pill" onclick="selectCategory('lessons', this)">Life Lessons <span class="count">9</span></button>
        <button class="category-pill" onclick="selectCategory('dreams', this)">Dreams <span class="count">5</span></button>
        <button class="category-pill" onclick="selectCategory('favorites', this)">Favorites <span class="count">3</span></button>
      </div>
    </div>

    <button class="submit-btn" onclick="openSubmitModal()">Suggest a Question</button>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" onclick="switchSidebar('memory', this)">Memory</button>
        <button class="sidebar-tab" onclick="switchSidebar('message', this)">Message</button>
        <button class="sidebar-tab" onclick="switchSidebar('assistant', this)">Assistant</button>
      </div>
    </div>
    <div class="sidebar-content">
      <!-- Memory Panel -->
      <div class="sidebar-panel active" id="memoryPanel">
        <div class="capsule-form">
          <div class="panel-title">Record a Memory</div>
          <div class="capsule-message">
            <div class="capsule-label">What do you want to remember?</div>
            <textarea class="capsule-textarea" id="memoryText" placeholder="Write about a moment, a feeling, a person..."></textarea>
          </div>
          
          <div class="capsule-date">
            <div class="capsule-label">Year</div>
            <select class="capsule-select" id="memoryYear">
              <option value="">Select year...</option>
            </select>
          </div>
          
          <div class="capsule-recipient">
            <div class="capsule-label">Category</div>
            <select class="capsule-select" id="memoryCategory">
              <option value="childhood">Childhood</option>
              <option value="family">Family</option>
              <option value="love">Love</option>
              <option value="career">Career</option>
              <option value="lessons">Life Lessons</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <div class="capsule-attachments">
            <input type="file" id="memoryFiles" multiple accept="image/*" style="display:none" onchange="handleMemoryFiles(event)">
            <button class="attachment-btn" onclick="document.getElementById('memoryFiles').click()">
              Add Photos
            </button>
            <div class="attachment-preview" id="memoryPreview"></div>
          </div>
          
          <button class="capsule-send" onclick="saveMemory()">Save Memory</button>
        </div>
      </div>

      <!-- Message Panel -->
      <div class="sidebar-panel" id="messagePanel">
        <div class="capsule-form">
          <div class="panel-title">Send a Time Capsule</div>
          <div class="capsule-recipient">
            <div class="capsule-label">Send To</div>
            <select class="capsule-select" id="capsuleRecipient">
              <option value="">Select recipient...</option>
              <option value="sarah">Sarah (Daughter)</option>
              <option value="michael">Michael (Son)</option>
            </select>
          </div>
          
          <div class="capsule-date">
            <div class="capsule-label">Deliver On</div>
            <div class="datetime-row">
              <input type="date" class="datetime-input" id="capsuleDate">
              <input type="time" class="datetime-input" id="capsuleTime" value="09:00">
            </div>
            <div class="date-presets">
              <button class="date-preset" onclick="setDatePreset('birthday')">Birthday</button>
              <button class="date-preset" onclick="setDatePreset('graduation')">Graduation</button>
              <button class="date-preset" onclick="setDatePreset('wedding')">Wedding</button>
              <button class="date-preset" onclick="setDatePreset('1year')">1 Year</button>
              <button class="date-preset" onclick="setDatePreset('5years')">5 Years</button>
              <button class="date-preset" onclick="setDatePreset('passing')">After I Pass</button>
            </div>
          </div>
          
          <div class="capsule-message">
            <div class="capsule-label">Your Message</div>
            <textarea class="capsule-textarea" id="capsuleMessage" placeholder="Write your message..."></textarea>
          </div>
          
          <div class="capsule-attachments">
            <input type="file" id="capsuleFiles" multiple accept="image/*" style="display:none" onchange="handleFileSelect(event)">
            <button class="attachment-btn" onclick="document.getElementById('capsuleFiles').click()">
              Add Photos or Videos
            </button>
            <div class="attachment-preview" id="attachmentPreview"></div>
          </div>
          
          <button class="capsule-send" onclick="scheduleCapsule()">Schedule Message</button>
        </div>
      </div>
      
      <!-- Assistant Panel -->
      <div class="sidebar-panel" id="assistantPanel">
        <!-- Mode Selection -->
        <div class="assistant-mode-select" id="assistantModeSelect">
          <div class="mode-title">How would you like to connect?</div>
          <div class="mode-cards">
            <button class="mode-card" onclick="selectAssistantMode('type')">
              <div class="mode-card-icon">Aa</div>
              <div class="mode-card-label">Type</div>
              <div class="mode-card-desc">Chat with text</div>
            </button>
            <button class="mode-card" onclick="selectAssistantMode('voice')">
              <div class="mode-card-icon">●</div>
              <div class="mode-card-label">Voice</div>
              <div class="mode-card-desc">Speak naturally</div>
            </button>
          </div>
        </div>
        
        <!-- Type Mode -->
        <div class="assistant-type" id="assistantType" style="display:none;">
          <button class="back-btn" onclick="backToModeSelect()">Back</button>
          <div class="chat-messages" id="chatMessages">
            <div class="chat-message assistant">
              <div class="chat-bubble">Hi! I'm here to help you record your story. Ask me anything or tell me what you'd like to remember today.</div>
            </div>
          </div>
          <div class="chat-input-row">
            <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendChat()">
            <button class="chat-send" onclick="sendChat()">Go</button>
          </div>
        </div>
        
        <!-- Voice Mode -->
        <div class="assistant-voice" id="assistantVoice" style="display:none;">
          <button class="back-btn" onclick="backToModeSelect()">Back</button>
          <div class="voice-container">
            <div class="voice-orb" id="voiceOrb" onclick="toggleVoice()">
              <div class="orb-inner"></div>
              <div class="orb-ring"></div>
              <div class="orb-ring"></div>
              <div class="orb-ring"></div>
            </div>
            <div class="voice-status" id="voiceStatus">Tap to speak</div>
            <div class="voice-transcript" id="voiceTranscript">Your conversation will appear here...</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Scheduled Messages (Always Visible) -->
    <div class="scheduled-section">
      <div class="scheduled-header-bar" onclick="toggleScheduled()">
        <span>Scheduled Messages</span>
        <span class="scheduled-count" id="scheduledCount">2</span>
      </div>
      <div class="scheduled-list" id="scheduledList">
        <div class="scheduled-item">
          <div class="scheduled-header">
            <span class="scheduled-to">To Sarah</span>
            <span class="scheduled-date">Dec 15, 2030</span>
          </div>
          <div class="scheduled-preview">I want you to know how proud I am of everything you've accomplished...</div>
        </div>
        <div class="scheduled-item">
          <div class="scheduled-header">
            <span class="scheduled-to">To Michael</span>
            <span class="scheduled-date">Jun 1, 2028</span>
          </div>
          <div class="scheduled-preview">On your wedding day, I wanted to share some advice...</div>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- Answer Modal -->
<div class="modal-overlay" id="answerModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Record Your Answer</div>
      <button class="modal-close" onclick="closeAnswerModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="modal-question" id="modalQuestionText">What is your earliest childhood memory?</div>
      
      <div class="form-group">
        <label class="form-label">Your Answer</label>
        <textarea class="form-textarea" id="answerInput" placeholder="Share your story..."></textarea>
      </div>
      
      <div class="form-group">
        <label class="form-label">Add Photos</label>
        <div class="image-upload-area" id="uploadArea" onclick="document.getElementById('answerFiles').click()">
          <div class="upload-text">Click or drag photos here</div>
          <div class="upload-hint">JPG, PNG up to 10MB each</div>
        </div>
        <input type="file" id="answerFiles" multiple accept="image/*" style="display:none" onchange="handleAnswerFiles(event)">
        <div class="uploaded-images" id="uploadedImages"></div>
      </div>
      
      <div id="previousAnswer" class="previous-answer" style="display:none;">
        <div class="previous-answer-label">Previous Answer</div>
        <div class="previous-answer-text" id="previousAnswerText"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeAnswerModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitAnswer()">Save Answer</button>
    </div>
  </div>
</div>

<!-- Add Recipient Modal -->
<div class="modal-overlay" id="recipientModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Add Recipient</div>
      <button class="modal-close" onclick="closeRecipientModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="recipientName" placeholder="Their name">
      </div>
      <div class="form-group">
        <label class="form-label">Relationship</label>
        <select class="form-select" id="recipientRelation">
          <option value="">Select relationship...</option>
          <option value="spouse">Spouse</option>
          <option value="child">Child</option>
          <option value="grandchild">Grandchild</option>
          <option value="parent">Parent</option>
          <option value="sibling">Sibling</option>
          <option value="friend">Friend</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="recipientEmail" placeholder="Their email address">
      </div>
      <div class="form-group">
        <label class="form-label">Birthday (for scheduled messages)</label>
        <input type="date" class="form-input" id="recipientBirthday">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeRecipientModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addRecipient()">Add Recipient</button>
    </div>
  </div>
</div>

<!-- Suggest Question Modal -->
<div class="modal-overlay" id="submitModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Suggest a Question</div>
      <button class="modal-close" onclick="closeSubmitModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Your Question</label>
        <textarea class="form-textarea" id="submitQuestion" placeholder="What question would help people tell their story?"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Category</label>
        <select class="form-select" id="submitCategory">
          <option value="">Select category</option>
          <option value="childhood">Childhood</option>
          <option value="family">Family</option>
          <option value="love">Love & Relationships</option>
          <option value="career">Career & Work</option>
          <option value="lessons">Life Lessons</option>
          <option value="dreams">Dreams & Wishes</option>
          <option value="favorites">Favorites</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeSubmitModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitQuestion()">Submit</button>
    </div>
  </div>
</div>

<script>
// =====================================================
// SAMPLE QUESTIONS
// =====================================================
const lifeQuestions = [
  { id: 1, text: "What is your earliest childhood memory?", category: "Childhood" },
  { id: 2, text: "What was your favorite game or activity as a child?", category: "Childhood" },
  { id: 3, text: "Describe the house you grew up in.", category: "Childhood" },
  { id: 4, text: "Who was your best friend growing up?", category: "Childhood" },
  { id: 5, text: "What was school like for you?", category: "Childhood" },
  { id: 6, text: "What did you want to be when you grew up?", category: "Childhood" },
  { id: 7, text: "What was your favorite family tradition?", category: "Family" },
  { id: 8, text: "Tell me about your parents.", category: "Family" },
  { id: 9, text: "What values did your family instill in you?", category: "Family" },
  { id: 10, text: "What is your favorite family memory?", category: "Family" },
  { id: 11, text: "How did you meet your spouse/partner?", category: "Love" },
  { id: 12, text: "What was your wedding day like?", category: "Love" },
  { id: 13, text: "What advice would you give about love?", category: "Love" },
  { id: 14, text: "What was your first job?", category: "Career" },
  { id: 15, text: "What career are you most proud of?", category: "Career" },
  { id: 16, text: "What's the most important lesson life taught you?", category: "Life Lessons" },
  { id: 17, text: "What would you do differently if you could?", category: "Life Lessons" },
  { id: 18, text: "What advice would you give your younger self?", category: "Life Lessons" },
  { id: 19, text: "What are your hopes for your children/grandchildren?", category: "Dreams" },
  { id: 20, text: "What's on your bucket list?", category: "Dreams" },
  { id: 21, text: "What's your favorite book, movie, or song?", category: "Favorites" },
  { id: 22, text: "What's your favorite place you've ever visited?", category: "Favorites" },
  { id: 23, text: "What food reminds you of home?", category: "Favorites" },
  { id: 24, text: "What accomplishment are you most proud of?", category: "Life Lessons" },
];

let currentQuestionIndex = 0;
let currentCategory = 'all';
let answeredQuestions = [];
let uploadedFiles = [];
let capsuleAttachments = [];

// =====================================================
// INIT
// =====================================================
function init() {
  populateYearDropdown();
  renderCurrentQuestion();
  updateStats();
}

function populateYearDropdown() {
  const select = document.getElementById('memoryYear');
  const currentYear = new Date().getFullYear();
  for (let year = currentYear; year >= 1920; year--) {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    select.appendChild(option);
  }
}

// =====================================================
// LAST REQUESTS
// =====================================================
function openRequestModal(type) {
  const titles = {
    funeral: 'Funeral Wishes',
    belongings: 'Special Belongings',
    words: 'Final Words',
    practical: 'Practical Matters'
  };
  
  const prompts = {
    funeral: 'Share your wishes for your funeral or memorial service. What music would you like? Any specific readings or poems? How do you want to be remembered?',
    belongings: 'List any special items and who you\'d like to receive them. Include the story or meaning behind each item.',
    words: 'Write messages to your loved ones that will be shared after you\'re gone. These can be letters of love, advice, or simply goodbye.',
    practical: 'Document important information: account details, passwords, location of important documents, and any other practical matters your family should know.'
  };
  
  // For now, use the answer modal
  document.getElementById('modalQuestionText').textContent = prompts[type];
  document.getElementById('answerModal').classList.add('active');
}

// =====================================================
// RENDER
// =====================================================
function renderCurrentQuestion() {
  const filtered = currentCategory === 'all' 
    ? lifeQuestions 
    : lifeQuestions.filter(q => q.category.toLowerCase().includes(currentCategory));
  
  if (filtered.length === 0) {
    document.getElementById('currentQuestion').innerHTML = '<div class="empty-state">No questions in this category</div>';
    return;
  }
  
  if (currentQuestionIndex >= filtered.length) {
    currentQuestionIndex = 0;
  }
  
  const question = filtered[currentQuestionIndex];
  const isAnswered = answeredQuestions.includes(question.id);
  const answeredCount = answeredQuestions.length;
  
  document.getElementById('questionProgress').textContent = `${answeredCount} of ${lifeQuestions.length} Answered`;
  
  document.getElementById('currentQuestion').innerHTML = `
    <div class="question-number-large ${isAnswered ? 'answered' : ''}">${question.id}</div>
    <div class="question-text-large">${question.text}</div>
    <div class="question-category">${question.category}</div>
    <div class="question-actions">
      <button class="btn-answer" onclick="openAnswerModal()">${isAnswered ? 'Edit Answer' : 'Answer'}</button>
      <button class="btn-skip" onclick="skipQuestion()">Skip</button>
    </div>
    <div class="question-nav">
      <button class="btn-nav" onclick="prevQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''}>Previous</button>
      <span style="font-size:12px;color:#666;">${currentQuestionIndex + 1} / ${filtered.length}</span>
      <button class="btn-nav" onclick="nextQuestion()" ${currentQuestionIndex >= filtered.length - 1 ? 'disabled' : ''}>Next</button>
    </div>
  `;
}

function updateStats() {
  document.getElementById('statAnswered').textContent = answeredQuestions.length;
  document.getElementById('statPhotos').textContent = uploadedFiles.length;
  document.getElementById('statMessages').textContent = '2';
  document.getElementById('statRecipients').textContent = '2';
}

// =====================================================
// NAVIGATION
// =====================================================
function skipQuestion() {
  nextQuestion();
}

function nextQuestion() {
  const filtered = currentCategory === 'all' 
    ? lifeQuestions 
    : lifeQuestions.filter(q => q.category.toLowerCase().includes(currentCategory));
  
  if (currentQuestionIndex < filtered.length - 1) {
    currentQuestionIndex++;
    renderCurrentQuestion();
  }
}

function prevQuestion() {
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    renderCurrentQuestion();
  }
}

function selectCategory(category, btn) {
  currentCategory = category;
  currentQuestionIndex = 0;
  document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  renderCurrentQuestion();
}

// =====================================================
// ANSWER MODAL
// =====================================================
function openAnswerModal() {
  const filtered = currentCategory === 'all' 
    ? lifeQuestions 
    : lifeQuestions.filter(q => q.category.toLowerCase().includes(currentCategory));
  const question = filtered[currentQuestionIndex];
  
  document.getElementById('modalQuestionText').textContent = question.text;
  document.getElementById('answerInput').value = '';
  document.getElementById('uploadedImages').innerHTML = '';
  document.getElementById('answerModal').classList.add('active');
}

function closeAnswerModal() {
  document.getElementById('answerModal').classList.remove('active');
}

function submitAnswer() {
  const answerText = document.getElementById('answerInput').value.trim();
  if (!answerText) {
    alert('Please enter your answer');
    return;
  }
  
  const filtered = currentCategory === 'all' 
    ? lifeQuestions 
    : lifeQuestions.filter(q => q.category.toLowerCase().includes(currentCategory));
  const question = filtered[currentQuestionIndex];
  
  if (!answeredQuestions.includes(question.id)) {
    answeredQuestions.push(question.id);
  }
  
  closeAnswerModal();
  updateStats();
  renderCurrentQuestion();
  nextQuestion();
}

function handleAnswerFiles(event) {
  const files = event.target.files;
  const container = document.getElementById('uploadedImages');
  
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const div = document.createElement('div');
      div.className = 'uploaded-image';
      div.innerHTML = `
        <img src="${e.target.result}" alt="Upload">
        <button onclick="this.parentElement.remove()">×</button>
      `;
      container.appendChild(div);
      uploadedFiles.push(file);
      updateStats();
    };
    reader.readAsDataURL(file);
  }
}

// =====================================================
// RECIPIENT MODAL
// =====================================================
function openRecipientModal() {
  document.getElementById('recipientModal').classList.add('active');
}

function closeRecipientModal() {
  document.getElementById('recipientModal').classList.remove('active');
}

function addRecipient() {
  const name = document.getElementById('recipientName').value.trim();
  if (!name) {
    alert('Please enter a name');
    return;
  }
  
  // Add to list (in real app, save to database)
  const list = document.getElementById('recipientsList');
  const div = document.createElement('div');
  div.className = 'compact-item';
  div.innerHTML = `
    <div class="compact-avatar">${name.charAt(0)}</div>
    <div class="compact-info">
      <div class="compact-name">${name}</div>
      <div class="compact-sub">${document.getElementById('recipientRelation').value || 'Family'}</div>
    </div>
    <div class="compact-badge">0</div>
  `;
  list.appendChild(div);
  
  closeRecipientModal();
  document.getElementById('recipientName').value = '';
  document.getElementById('recipientRelation').value = '';
  document.getElementById('recipientEmail').value = '';
}

// =====================================================
// SUBMIT QUESTION MODAL
// =====================================================
function openSubmitModal() {
  document.getElementById('submitModal').classList.add('active');
}

function closeSubmitModal() {
  document.getElementById('submitModal').classList.remove('active');
}

function submitQuestion() {
  const text = document.getElementById('submitQuestion').value.trim();
  if (!text) {
    alert('Please enter a question');
    return;
  }
  
  alert('Thank you! Your question has been submitted for review.');
  closeSubmitModal();
  document.getElementById('submitQuestion').value = '';
  document.getElementById('submitCategory').value = '';
}

// =====================================================
// TIME CAPSULE / MESSAGE
// =====================================================
function switchSidebar(panel, btn) {
  document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.sidebar-panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(panel + 'Panel').classList.add('active');
}

// =====================================================
// MEMORY
// =====================================================
let memoryAttachments = [];

function handleMemoryFiles(event) {
  const files = event.target.files;
  const container = document.getElementById('memoryPreview');
  
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const div = document.createElement('div');
      div.className = 'attachment-thumb';
      div.innerHTML = `
        <img src="${e.target.result}" alt="Attachment">
        <button class="attachment-remove" onclick="this.parentElement.remove()">×</button>
      `;
      container.appendChild(div);
      memoryAttachments.push(file);
    };
    reader.readAsDataURL(file);
  }
}

function saveMemory() {
  const text = document.getElementById('memoryText').value.trim();
  if (!text) {
    alert('Please write your memory');
    return;
  }
  
  // In real app, save to database
  alert('Memory saved!');
  document.getElementById('memoryText').value = '';
  document.getElementById('memoryYear').value = '';
  document.getElementById('memoryPreview').innerHTML = '';
  memoryAttachments = [];
  updateStats();
}

// =====================================================
// CHAT / ASSISTANT
// =====================================================
function selectAssistantMode(mode) {
  document.getElementById('assistantModeSelect').style.display = 'none';
  
  if (mode === 'type') {
    document.getElementById('assistantType').style.display = 'flex';
    document.getElementById('assistantVoice').style.display = 'none';
  } else {
    document.getElementById('assistantType').style.display = 'none';
    document.getElementById('assistantVoice').style.display = 'flex';
  }
}

function backToModeSelect() {
  document.getElementById('assistantModeSelect').style.display = 'flex';
  document.getElementById('assistantType').style.display = 'none';
  document.getElementById('assistantVoice').style.display = 'none';
}

function sendChat() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  
  addChatMessage(text, 'user');
  input.value = '';
  
  // Simulate assistant response
  setTimeout(() => {
    const responses = [
      "That's a wonderful memory to capture. Would you like to add more details?",
      "Thank you for sharing. What feelings does this memory bring up for you?",
      "I can help you write that down. Would you like to record it as a memory or send it as a message to someone?",
      "That sounds meaningful. Who would you like to share this with someday?",
      "I'm here to help preserve your story. What else would you like to remember?"
    ];
    const response = responses[Math.floor(Math.random() * responses.length)];
    addChatMessage(response, 'assistant');
  }, 800);
}

function addChatMessage(text, type) {
  const container = document.getElementById('chatMessages');
  const msg = document.createElement('div');
  msg.className = `chat-message ${type}`;
  msg.innerHTML = `<div class="chat-bubble">${text}</div>`;
  container.appendChild(msg);
  container.scrollTop = container.scrollHeight;
}

// =====================================================
// VOICE ASSISTANT
// =====================================================
let isListening = false;

function toggleVoice() {
  const orb = document.getElementById('voiceOrb');
  const status = document.getElementById('voiceStatus');
  const transcript = document.getElementById('voiceTranscript');
  
  isListening = !isListening;
  
  if (isListening) {
    orb.classList.add('listening');
    status.textContent = 'Listening...';
    transcript.textContent = 'Speak now...';
    
    // Simulate voice recognition (replace with real VAPI integration)
    setTimeout(() => {
      if (isListening) {
        transcript.textContent = '"I want to record a memory about my grandmother..."';
        setTimeout(() => {
          if (isListening) {
            status.textContent = 'Processing...';
            setTimeout(() => {
              transcript.textContent = 'Assistant: That sounds lovely. Tell me more about your grandmother. What\'s your favorite memory of her?';
              status.textContent = 'Tap to speak';
              orb.classList.remove('listening');
              isListening = false;
            }, 1000);
          }
        }, 2000);
      }
    }, 1500);
  } else {
    orb.classList.remove('listening');
    status.textContent = 'Tap to speak';
  }
}

// =====================================================
// SCHEDULED MESSAGES
// =====================================================
function toggleScheduled() {
  const list = document.getElementById('scheduledList');
  list.style.display = list.style.display === 'none' ? 'block' : 'none';
}

function setDatePreset(preset) {
  const dateInput = document.getElementById('capsuleDate');
  const today = new Date();
  
  switch(preset) {
    case '1year':
      today.setFullYear(today.getFullYear() + 1);
      break;
    case '5years':
      today.setFullYear(today.getFullYear() + 5);
      break;
    case 'birthday':
    case 'graduation':
    case 'wedding':
    case 'passing':
      // These would pull from recipient data in real app
      today.setFullYear(today.getFullYear() + 1);
      break;
  }
  
  dateInput.value = today.toISOString().split('T')[0];
  
  document.querySelectorAll('.date-preset').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function handleFileSelect(event) {
  const files = event.target.files;
  const container = document.getElementById('attachmentPreview');
  
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const div = document.createElement('div');
      div.className = 'attachment-thumb';
      div.innerHTML = `
        <img src="${e.target.result}" alt="Attachment">
        <button class="attachment-remove" onclick="this.parentElement.remove()">×</button>
      `;
      container.appendChild(div);
      capsuleAttachments.push(file);
    };
    reader.readAsDataURL(file);
  }
}

function scheduleCapsule() {
  const recipient = document.getElementById('capsuleRecipient').value;
  const date = document.getElementById('capsuleDate').value;
  const message = document.getElementById('capsuleMessage').value.trim();
  
  if (!recipient) {
    alert('Please select a recipient');
    return;
  }
  if (!date) {
    alert('Please select a delivery date');
    return;
  }
  if (!message) {
    alert('Please write a message');
    return;
  }
  
  // Add to scheduled list
  const list = document.getElementById('scheduledList');
  const div = document.createElement('div');
  div.className = 'scheduled-item';
  div.innerHTML = `
    <div class="scheduled-header">
      <span class="scheduled-to">To ${recipient}</span>
      <span class="scheduled-date">${new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
    </div>
    <div class="scheduled-preview">${message.substring(0, 100)}...</div>
    ${capsuleAttachments.length > 0 ? `<div class="scheduled-attachments"><span>${capsuleAttachments.length} photos</span></div>` : ''}
  `;
  list.insertBefore(div, list.firstChild);
  
  // Reset form
  document.getElementById('capsuleRecipient').value = '';
  document.getElementById('capsuleDate').value = '';
  document.getElementById('capsuleMessage').value = '';
  document.getElementById('attachmentPreview').innerHTML = '';
  capsuleAttachments = [];
  
  alert('Your time capsule has been scheduled!');
  
  // Switch to scheduled tab
  switchSidebar('scheduled', document.querySelector('.sidebar-tab:last-child'));
}

function logout() {
  window.location.href = 'gone-login.html';
}

// Drag and drop for upload area
document.addEventListener('DOMContentLoaded', () => {
  const uploadArea = document.getElementById('uploadArea');
  if (uploadArea) {
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      handleAnswerFiles({ target: { files } });
    });
  }
  
  init();
});
</script>

</body>
</html>
