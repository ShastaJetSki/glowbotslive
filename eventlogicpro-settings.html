<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>EventLogicPro - Settings</title>
  <script>(function(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);})();</script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ===== THEME DEFINITIONS ===== */
    :root { --bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa; }
    [data-theme="dark-blue"]{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="grey"]{--bg-primary:#111;--bg-secondary:#1a1a1a;--bg-card:#242424;--bg-hover:#2e2e2e;--border-default:#333;--text-primary:#e5e5e5;--text-secondary:#a3a3a3;--accent-primary:#525252;--accent-light:#737373;}
    [data-theme="slate"],[data-theme="slate-dark"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#273549;--bg-hover:#334155;--border-default:#334155;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--accent-primary:#6366f1;--accent-light:#818cf8;}
    [data-theme="charcoal"]{--bg-primary:#121214;--bg-secondary:#18181b;--bg-card:#27272a;--bg-hover:#3f3f46;--border-default:#3f3f46;--text-primary:#fafafa;--text-secondary:#a1a1aa;--accent-primary:#a1a1aa;--accent-light:#d4d4d8;}
    [data-theme="midnight"],[data-theme="midnight-dark"]{--bg-primary:#09090b;--bg-secondary:#0f0f12;--bg-card:#18181d;--bg-hover:#222228;--border-default:#27272f;--text-primary:#eeeef0;--text-secondary:#9898a4;--accent-primary:#8b5cf6;--accent-light:#a78bfa;}
    [data-theme="navy"]{--bg-primary:#0a0e1a;--bg-secondary:#0f1526;--bg-card:#182035;--bg-hover:#1f2a45;--border-default:#253352;--text-primary:#e8ecf4;--text-secondary:#9aa5bd;--accent-primary:#4a7cc9;--accent-light:#6b9ae0;}
    [data-theme="graphite"]{--bg-primary:#0d0d0d;--bg-secondary:#141414;--bg-card:#1f1f1f;--bg-hover:#292929;--border-default:#2e2e2e;--text-primary:#e8e8e8;--text-secondary:#999;--accent-primary:#4a9eff;--accent-light:#6bb3ff;}
    [data-theme="ocean"],[data-theme="ocean-dark"]{--bg-primary:#0a1214;--bg-secondary:#0e181c;--bg-card:#152228;--bg-hover:#1c2d35;--border-default:#243842;--text-primary:#e5f0f3;--text-secondary:#8faab5;--accent-primary:#14b8a6;--accent-light:#2dd4bf;}
    [data-theme="forest"],[data-theme="forest-dark"]{--bg-primary:#0a100c;--bg-secondary:#0f1812;--bg-card:#16221a;--bg-hover:#1e2e24;--border-default:#263830;--text-primary:#e5f0e8;--text-secondary:#8faa96;--accent-primary:#22c55e;--accent-light:#4ade80;}
    [data-theme="obsidian"]{--bg-primary:#050505;--bg-secondary:#0a0a0a;--bg-card:#141414;--bg-hover:#1c1c1c;--border-default:#252525;--text-primary:#e0e0e0;--text-secondary:#888;--accent-primary:#0ea5e9;--accent-light:#38bdf8;}
    [data-theme="steel"]{--bg-primary:#0c0f13;--bg-secondary:#12161c;--bg-card:#1a2028;--bg-hover:#242c38;--border-default:#2c3644;--text-primary:#e4e8ed;--text-secondary:#8b95a5;--accent-primary:#64748b;--accent-light:#94a3b8;}
    [data-theme="espresso"]{--bg-primary:#0f0c0a;--bg-secondary:#161210;--bg-card:#211c18;--bg-hover:#2c2520;--border-default:#382f28;--text-primary:#f0ebe5;--text-secondary:#a89e94;--accent-primary:#a78b6e;--accent-light:#c4a88a;}
    [data-theme="onyx"]{--bg-primary:#000;--bg-secondary:#080808;--bg-card:#121212;--bg-hover:#1a1a1a;--border-default:#222;--text-primary:#f5f5f5;--text-secondary:#8c8c8c;--accent-primary:#06b6d4;--accent-light:#22d3ee;}
    [data-theme="light-blue"],[data-theme="blue-light"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#2563eb;--accent-light:#3b82f6;}
    [data-theme="light-grey"],[data-theme="slate-light"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#e5e5e5;--border-default:#d4d4d4;--text-primary:#171717;--text-secondary:#525252;--accent-primary:#404040;--accent-light:#525252;}
    [data-theme="light-slate"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#4f46e5;--accent-light:#6366f1;}
    [data-theme="light-ocean"],[data-theme="ocean-light"]{--bg-primary:#f0fdfa;--bg-secondary:#ccfbf1;--bg-card:#fff;--bg-hover:#99f6e4;--border-default:#5eead4;--text-primary:#134e4a;--text-secondary:#0f766e;--accent-primary:#0d9488;--accent-light:#14b8a6;}
    [data-theme="light-forest"],[data-theme="mint-light"],[data-theme="mint"]{--bg-primary:#f0fdf4;--bg-secondary:#dcfce7;--bg-card:#fff;--bg-hover:#bbf7d0;--border-default:#86efac;--text-primary:#14532d;--text-secondary:#166534;--accent-primary:#16a34a;--accent-light:#22c55e;}
    [data-theme="light-midnight"],[data-theme="lavender-light"],[data-theme="lavender"]{--bg-primary:#faf5ff;--bg-secondary:#f3e8ff;--bg-card:#fff;--bg-hover:#e9d5ff;--border-default:#d8b4fe;--text-primary:#1e1b4b;--text-secondary:#5b21b6;--accent-primary:#7c3aed;--accent-light:#8b5cf6;}
    [data-theme="light-obsidian"],[data-theme="sky-light"],[data-theme="sky"]{--bg-primary:#f0f9ff;--bg-secondary:#e0f2fe;--bg-card:#fff;--bg-hover:#bae6fd;--border-default:#7dd3fc;--text-primary:#0c4a6e;--text-secondary:#0369a1;--accent-primary:#0284c7;--accent-light:#0ea5e9;}
    [data-theme="light-espresso"]{--bg-primary:#fefcfb;--bg-secondary:#fdf4ef;--bg-card:#fff;--bg-hover:#f5e6db;--border-default:#ddc9b8;--text-primary:#3d2c1e;--text-secondary:#6b5344;--accent-primary:#8b6f4e;--accent-light:#a78b6e;}
    [data-theme="light-graphite"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#ebebeb;--border-default:#d1d1d1;--text-primary:#1a1a1a;--text-secondary:#4a4a4a;--accent-primary:#2196f3;--accent-light:#42a5f5;}
    [data-theme="light-onyx"]{--bg-primary:#ecfeff;--bg-secondary:#cffafe;--bg-card:#fff;--bg-hover:#a5f3fc;--border-default:#67e8f9;--text-primary:#164e63;--text-secondary:#0e7490;--accent-primary:#0891b2;--accent-light:#06b6d4;}
    [data-theme="light-steel"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#1e293b;--text-secondary:#475569;--accent-primary:#475569;--accent-light:#64748b;}
    [data-theme="light-navy"]{--bg-primary:#f0f4ff;--bg-secondary:#e0e7ff;--bg-card:#fff;--bg-hover:#c7d2fe;--border-default:#a5b4fc;--text-primary:#1e1b4b;--text-secondary:#3730a3;--accent-primary:#3949ab;--accent-light:#5c6bc0;}
    [data-theme="light-charcoal"]{--bg-primary:#fafafa;--bg-secondary:#f4f4f5;--bg-card:#fff;--bg-hover:#e4e4e7;--border-default:#d4d4d8;--text-primary:#18181b;--text-secondary:#52525b;--accent-primary:#71717a;--accent-light:#a1a1aa;}
    [data-theme="cyber-dark"],[data-theme="cyber"]{--bg-primary:#0a0a0f;--bg-secondary:#0f0f18;--bg-card:#151522;--bg-hover:#1c1c2e;--border-default:#2a2a44;--text-primary:#e0e0ff;--text-secondary:#9090c0;--accent-primary:#00ff88;--accent-light:#44ffaa;}
    [data-theme="amber-dark"],[data-theme="amber"]{--bg-primary:#0f0c05;--bg-secondary:#1a1508;--bg-card:#26200c;--bg-hover:#332a10;--border-default:#443815;--text-primary:#fef3c7;--text-secondary:#c9b896;--accent-primary:#f59e0b;--accent-light:#fbbf24;}
    [data-theme="honey-light"],[data-theme="honey"]{--bg-primary:#fffbeb;--bg-secondary:#fef3c7;--bg-card:#fff;--bg-hover:#fde68a;--border-default:#fcd34d;--text-primary:#78350f;--text-secondary:#a06020;--accent-primary:#d97706;--accent-light:#f59e0b;}
    [data-theme="crimson-dark"],[data-theme="crimson"]{--bg-primary:#0f0708;--bg-secondary:#1a0c0e;--bg-card:#261214;--bg-hover:#331a1c;--border-default:#442225;--text-primary:#fee2e2;--text-secondary:#c9a3a5;--accent-primary:#dc2626;--accent-light:#ef4444;}
    [data-theme="coral-light"],[data-theme="coral"]{--bg-primary:#fff5f5;--bg-secondary:#fee2e2;--bg-card:#fff;--bg-hover:#fecaca;--border-default:#fca5a5;--text-primary:#7f1d1d;--text-secondary:#a04444;--accent-primary:#ef4444;--accent-light:#f87171;}
    [data-theme="rose-dark"],[data-theme="rose"]{--bg-primary:#0f070a;--bg-secondary:#1a0c12;--bg-card:#26121a;--bg-hover:#331a24;--border-default:#44222e;--text-primary:#ffe4ec;--text-secondary:#c9a3b0;--accent-primary:#ec4899;--accent-light:#f472b6;}
    [data-theme="sand-light"],[data-theme="sand"]{--bg-primary:#fefcf8;--bg-secondary:#faf6ee;--bg-card:#fff;--bg-hover:#f5efe0;--border-default:#e8dcc8;--text-primary:#44402a;--text-secondary:#6a6550;--accent-primary:#a89060;--accent-light:#c4aa78;}

    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary);overflow-x:hidden;}
    body{padding-bottom:120px;}
    .desktop-header{position:sticky;top:0;z-index:100;background:var(--bg-primary);border-bottom:1px solid var(--border-default);}
    .mobile-top-header{display:block;position:sticky;top:0;z-index:100;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-header-bar{display:flex;justify-content:space-between;align-items:center;padding:12px;gap:12px;}
    .mobile-menu-toggle{background:transparent;border:1px solid transparent;border-radius:6px;color:var(--text-secondary);font-size:20px;padding:0;width:36px;height:36px;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-appearance:none;}
    .mobile-header-center{flex:1;}
    .mobile-header-title{font-size:18px;font-weight:600;}
    .business-name{font-size:12px;color:var(--accent-light);}
    .mobile-header-right{display:flex;align-items:center;gap:12px;}
    .accordion-icon-header{font-size:20px;color:var(--text-secondary);transition:transform .2s ease;}
    .mobile-menu-toggle.active .accordion-icon-header{transform:rotate(180deg);}
    .mobile-header-content{max-height:0;overflow:hidden;transition:max-height .3s ease;}
    .mobile-header-content.expanded{max-height:200px;}
    .mobile-header-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:8px 12px 12px;background:var(--bg-primary);border-top:1px solid var(--border-default);}
    .mobile-header-actions button{padding:10px;font-size:13px;background:color-mix(in srgb,var(--accent-primary) 10%,transparent);border:1px solid color-mix(in srgb,var(--accent-primary) 30%,transparent);color:var(--accent-light);border-radius:8px;cursor:pointer;-webkit-appearance:none;}
    .theme-toggle-btn{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .theme-toggle-btn:hover{background:var(--bg-hover);color:var(--text-primary);}
    .theme-toggle-btn svg{width:20px;height:20px;stroke:currentColor;stroke-width:2;fill:none;}
    .mobile-bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg-secondary);padding:8px;z-index:100;border-top:1px solid var(--border-default);}
    .mobile-nav-top{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;}
    .mobile-nav-btn{padding:10px 8px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;display:flex;align-items:center;justify-content:center;min-height:44px;-webkit-appearance:none;transition:all .2s;}
    .mobile-nav-btn:active{transform:scale(.95);}
    .mobile-nav-btn.active{background:color-mix(in srgb,var(--accent-primary) 60%,transparent);border-color:var(--accent-primary);color:var(--text-primary);}
    .content{padding:12px;max-width:900px;margin:0 auto;}
    .settings-section{background:var(--bg-card);border-radius:12px;padding:20px;margin-bottom:12px;border:1px solid var(--border-default);}
    .settings-section-title{font-size:16px;font-weight:600;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid var(--border-default);display:flex;justify-content:space-between;align-items:center;}
    .setting-row{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border-default);}
    .setting-row:last-child{border-bottom:none;}
    .setting-info{flex:1;}
    .setting-label{font-size:14px;font-weight:500;}
    .setting-desc{font-size:12px;color:var(--text-secondary);margin-top:2px;}
    .theme-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;margin-top:12px;}
    .theme-card{padding:12px 8px;border-radius:8px;border:2px solid var(--border-default);cursor:pointer;text-align:center;font-size:11px;font-weight:600;transition:all .2s;}
    .theme-card:hover{border-color:var(--accent-primary);}
    .theme-card.active-theme{border-color:var(--accent-primary);background:color-mix(in srgb,var(--accent-primary) 15%,transparent);}
    .theme-swatch{height:20px;border-radius:4px;margin-bottom:6px;display:flex;gap:2px;overflow:hidden;}
    .theme-swatch span{flex:1;}
    .form-input,.form-select{width:100%;padding:10px 14px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);font-size:14px;-webkit-appearance:none;}
    .form-input:focus,.form-select:focus{outline:none;border-color:var(--accent-primary);}
    .form-group{margin-bottom:16px;}
    .form-label{display:block;font-size:13px;font-weight:500;color:var(--text-secondary);margin-bottom:6px;}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .btn-primary{padding:12px 20px;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;font-size:14px;font-weight:600;cursor:pointer;-webkit-appearance:none;}
    .btn-primary:active{opacity:.9;}
    .btn-secondary{padding:12px 20px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);font-size:14px;cursor:pointer;-webkit-appearance:none;}
    .btn-danger{padding:12px 20px;border-radius:8px;border:1px solid #ef4444;background:rgba(239,68,68,.15);color:#ef4444;font-size:14px;cursor:pointer;-webkit-appearance:none;}
    .member-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-default);}
    .member-row:last-child{border-bottom:none;}
    .member-info{flex:1;}
    .member-name{font-size:14px;font-weight:500;}
    .member-meta{font-size:12px;color:var(--text-secondary);display:flex;gap:8px;margin-top:2px;}
    .role-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;text-transform:uppercase;}
    .role-badge.admin{background:rgba(239,68,68,.15);color:#ef4444;}
    .role-badge.manager{background:rgba(234,179,8,.15);color:#eab308;}
    .role-badge.team{background:rgba(59,130,246,.15);color:#60a5fa;}
    .member-btn{padding:6px 12px;border-radius:6px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);font-size:11px;cursor:pointer;-webkit-appearance:none;}
    .member-btn:hover{background:var(--bg-hover);color:var(--text-primary);}
    .dept-assign-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border-default);gap:12px;}
    .dept-assign-row:last-child{border-bottom:none;}
    .dept-assign-name{font-size:14px;font-weight:500;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .dept-assign-select{padding:8px 12px;border-radius:6px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);font-size:13px;-webkit-appearance:none;min-width:140px;cursor:pointer;}
    .dept-assign-select:focus{outline:none;border-color:var(--accent-primary);}
    .dept-assign-budget{padding:8px 10px;border-radius:6px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);font-size:13px;width:100px;text-align:right;}
    .dept-assign-budget:focus{outline:none;border-color:var(--accent-primary);}
    .dept-assign-budget::placeholder{color:var(--text-secondary);}
    .dept-assign-saved{font-size:11px;color:#22c55e;opacity:0;transition:opacity .3s;}
    .dept-assign-saved.show{opacity:1;}
    .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.75);z-index:2000;align-items:center;justify-content:center;padding:20px;}
    .modal-overlay.active{display:flex;}
    .modal-content{background:var(--bg-secondary);border-radius:12px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;border:1px solid var(--border-default);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-default);}
    .modal-title{font-size:18px;font-weight:600;}
    .modal-close{background:transparent;border:none;color:var(--text-secondary);font-size:24px;cursor:pointer;padding:0;line-height:1;}
    .modal-body{padding:20px;}
    .modal-footer{display:flex;gap:12px;justify-content:flex-end;padding:16px 20px;border-top:1px solid var(--border-default);}
    .toast{position:fixed;bottom:140px;left:50%;transform:translateX(-50%);background:var(--bg-card);border:1px solid var(--accent-primary);color:var(--text-primary);padding:12px 20px;border-radius:10px;font-size:14px;font-weight:500;z-index:3000;display:none;}
    .toast.show{display:block;animation:toastIn .3s ease;}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px);}to{opacity:1;transform:translateX(-50%) translateY(0);}}
    .perm-table{width:100%;border-collapse:collapse;margin-top:12px;font-size:13px;}
    .perm-table th,.perm-table td{padding:10px 12px;text-align:left;border-bottom:1px solid var(--border-default);}
    .perm-table th{color:var(--text-secondary);font-size:11px;text-transform:uppercase;}
    .perm-check{color:#22c55e;}
    .perm-x{color:#ef4444;}
    @media(max-width:768px){.desktop-header{display:none !important;}.mobile-top-header{display:block;}.mobile-bottom-nav{display:block !important;}.modal-overlay{align-items:flex-end;padding:0;}.modal-content{border-radius:20px 20px 0 0;max-height:85vh;}.form-row{grid-template-columns:1fr;}.theme-grid{grid-template-columns:repeat(auto-fill,minmax(100px,1fr));}}
    @media(min-width:769px){.mobile-top-header{display:none !important;}.mobile-bottom-nav{display:none !important;}body{padding-bottom:20px;}}
  </style>
</head>
<body>

<div class="mobile-top-header">
  <div class="mobile-header-bar">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu(this)"><span class="accordion-icon-header">&#9776;</span></button>
    <div class="mobile-header-center"><div class="mobile-header-title">Settings</div><div class="business-name" id="mobileBusinessName">Loading...</div></div>
    <div class="mobile-header-right"><button class="theme-toggle-btn" onclick="cycleTheme()" title="Change theme"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button></div>
  </div>
  <div class="mobile-header-content" id="mobileHeaderContent"><div class="mobile-header-actions"><button onclick="location.href='eventlogicpro.html'">Events</button><button onclick="logout()">Logout</button></div></div>
</div>

<div class="desktop-header">
  <div style="padding:16px 24px 8px;display:flex;justify-content:space-between;align-items:center;">
    <div><h1 style="margin:0;font-size:32px;font-weight:600;">EventLogicPro</h1><div class="business-name" id="desktopBusinessName">Loading...</div></div>
    <div style="display:flex;align-items:center;gap:16px;"><button class="theme-toggle-btn" onclick="cycleTheme()" title="Change theme"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button><a onclick="logout()" style="color:var(--text-secondary);cursor:pointer;font-size:14px;">Logout</a></div>
  </div>
  <div style="padding:0 24px 12px;"><nav style="display:flex;gap:24px;"><a href="eventlogicpro.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Events</a><a href="eventlogicpro-settings.html" style="padding:12px 0;color:var(--accent-primary);text-decoration:none;font-size:14px;border-bottom:2px solid var(--accent-primary);">Settings</a></nav></div>
</div>

<div class="content">

  <div class="settings-section">
    <div class="settings-section-title">Account</div>
    <div class="setting-row"><div class="setting-info"><div class="setting-label">Email</div><div class="setting-desc" id="settingEmail">Loading...</div></div></div>
    <div class="setting-row"><div class="setting-info"><div class="setting-label">Change Password</div><div class="setting-desc">Update your account password</div></div><button class="btn-secondary" style="padding:8px 16px;font-size:12px;" onclick="openPwModal()">Change</button></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title">Theme</div>
    <div id="themeGrid" class="theme-grid"></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title"><span>Members</span><button class="btn-primary" style="padding:6px 14px;font-size:12px;" onclick="openAddMember()">+ Add Member</button></div>
    <div id="memberList"></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title">Department Assignments & Budgets</div>
    <div class="form-group"><label class="form-label">Event</label><select class="form-select" id="deptEventSelect" onchange="switchDeptEvent()"><option value="">-- Select Event --</option></select></div>
    <div id="deptAssignList" style="margin-top:12px;"><div style="padding:20px;text-align:center;color:var(--text-secondary);">Select an event to manage department leads</div></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title">Permissions Reference</div>
    <table class="perm-table">
      <thead><tr><th>Action</th><th>Admin</th><th>Manager</th><th>Team</th></tr></thead>
      <tbody>
        <tr><td>Create / Delete Events</td><td class="perm-check">&#10003;</td><td class="perm-x">&#10007;</td><td class="perm-x">&#10007;</td></tr>
        <tr><td>Add / Remove Departments</td><td class="perm-check">&#10003;</td><td class="perm-x">&#10007;</td><td class="perm-x">&#10007;</td></tr>
        <tr><td>Create / Edit / Delete Tasks</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td><td class="perm-x">&#10007;</td></tr>
        <tr><td>Assign Leads &amp; Members</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td><td class="perm-x">&#10007;</td></tr>
        <tr><td>Check Off Assigned Tasks</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td></tr>
        <tr><td>View Tasks &amp; Details</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td><td class="perm-check">&#10003;</td></tr>
        <tr><td>Manage Members</td><td class="perm-check">&#10003;</td><td class="perm-x">&#10007;</td><td class="perm-x">&#10007;</td></tr>
      </tbody>
    </table>
  </div>

  <div class="settings-section">
    <div class="settings-section-title">Danger Zone</div>
    <div class="setting-row"><div class="setting-info"><div class="setting-label" style="color:#ef4444;">Logout</div><div class="setting-desc">Sign out of your account</div></div><button class="btn-danger" style="padding:8px 16px;font-size:12px;" onclick="logout()">Logout</button></div>
  </div>

</div>

<div id="toast" class="toast"></div>

<div class="mobile-bottom-nav"><div class="mobile-nav-top"><a href="eventlogicpro.html" class="mobile-nav-btn">Events</a><a href="eventlogicpro-settings.html" class="mobile-nav-btn active">Settings</a></div></div>

<!-- Member Modal -->
<div class="modal-overlay" id="memberModal">
  <div class="modal-content">
    <div class="modal-header"><div class="modal-title" id="memberModalTitle">Add Member</div><button class="modal-close" onclick="closeMemberModal()">&times;</button></div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label class="form-label">First Name *</label><input type="text" class="form-input" id="mmFirst"></div>
        <div class="form-group"><label class="form-label">Last Name</label><input type="text" class="form-input" id="mmLast"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Role / Title</label><input type="text" class="form-input" id="mmRole" placeholder="e.g. Bar Lead, Security"></div>
        <div class="form-group"><label class="form-label">Permission Level *</label><select class="form-select" id="mmLevel"><option value="team">Team</option><option value="manager">Manager</option><option value="admin">Admin</option></select></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" id="mmPhone"></div>
        <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="mmEmail"></div>
      </div>
    </div>
    <div class="modal-footer"><button class="btn-danger" id="mmDeleteBtn" style="display:none;" onclick="deleteMember()">Delete</button><button class="btn-secondary" onclick="closeMemberModal()">Cancel</button><button class="btn-primary" onclick="saveMember()">Save</button></div>
  </div>
</div>

<!-- Password Modal -->
<div class="modal-overlay" id="pwModal">
  <div class="modal-content" style="max-width:400px;">
    <div class="modal-header"><div class="modal-title">Change Password</div><button class="modal-close" onclick="closePwModal()">&times;</button></div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">New Password</label><input type="password" class="form-input" id="pwNew" placeholder="Min 6 characters"></div>
      <div class="form-group"><label class="form-label">Confirm Password</label><input type="password" class="form-input" id="pwConfirm"></div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="closePwModal()">Cancel</button><button class="btn-primary" onclick="changePassword()">Update</button></div>
  </div>
</div>

<script>
var SUPABASE_URL='https://kxqkwpkmtgvmthpafoqx.supabase.co';
var SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';
var sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
var tenantId=null,userId=null,allMembers=[],editingMemberId=null;
var allProjects=[],deptEventDepts=[];

var themes=['dark-blue','grey','slate','charcoal','midnight','navy','graphite','ocean','forest','obsidian','steel','espresso','onyx','light-blue','light-grey','light-slate','light-ocean','light-forest','light-midnight','light-obsidian','light-espresso','light-graphite','light-onyx','light-steel','light-navy','light-charcoal','cyber','amber','honey','crimson','coral','rose','sand'];
var themeColors={
  'dark-blue':['#0b0f14','#1a2535','#3b82f6'],'grey':['#111','#242424','#525252'],'slate':['#0f172a','#273549','#6366f1'],'charcoal':['#121214','#27272a','#a1a1aa'],'midnight':['#09090b','#18181d','#8b5cf6'],'navy':['#0a0e1a','#182035','#4a7cc9'],'graphite':['#0d0d0d','#1f1f1f','#4a9eff'],'ocean':['#0a1214','#152228','#14b8a6'],'forest':['#0a100c','#16221a','#22c55e'],'obsidian':['#050505','#141414','#0ea5e9'],'steel':['#0c0f13','#1a2028','#64748b'],'espresso':['#0f0c0a','#211c18','#a78b6e'],'onyx':['#000','#121212','#06b6d4'],
  'light-blue':['#f8fafc','#fff','#2563eb'],'light-grey':['#fafafa','#fff','#404040'],'light-slate':['#f8fafc','#fff','#4f46e5'],'light-ocean':['#f0fdfa','#fff','#0d9488'],'light-forest':['#f0fdf4','#fff','#16a34a'],'light-midnight':['#faf5ff','#fff','#7c3aed'],'light-obsidian':['#f0f9ff','#fff','#0284c7'],'light-espresso':['#fefcfb','#fff','#8b6f4e'],'light-graphite':['#fafafa','#fff','#2196f3'],'light-onyx':['#ecfeff','#fff','#0891b2'],'light-steel':['#f8fafc','#fff','#475569'],'light-navy':['#f0f4ff','#fff','#3949ab'],'light-charcoal':['#fafafa','#fff','#71717a'],
  'cyber':['#0a0a0f','#151522','#00ff88'],'amber':['#0f0c05','#26200c','#f59e0b'],'honey':['#fffbeb','#fff','#d97706'],'crimson':['#0f0708','#261214','#dc2626'],'coral':['#fff5f5','#fff','#ef4444'],'rose':['#0f070a','#26121a','#ec4899'],'sand':['#fefcf8','#fff','#a89060']
};

function loadTheme(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);}
function setTheme(t){document.documentElement.setAttribute('data-theme',t);localStorage.setItem('app-theme',t);renderThemeGrid();showToast('Theme: '+t.replace(/-/g,' '));}
function cycleTheme(){var cur=localStorage.getItem('app-theme')||'dark-blue';var i=themes.indexOf(cur);i=(i+1)%themes.length;setTheme(themes[i]);}
loadTheme();

function renderThemeGrid(){
  var cur=localStorage.getItem('app-theme')||'dark-blue';
  var g=document.getElementById('themeGrid');g.innerHTML='';
  themes.forEach(function(t){
    var c=themeColors[t]||['#333','#444','#555'];
    var active=t===cur?' active-theme':'';
    g.innerHTML+='<div class="theme-card'+active+'" onclick="setTheme(\''+t+'\')"><div class="theme-swatch"><span style="background:'+c[0]+'"></span><span style="background:'+c[1]+'"></span><span style="background:'+c[2]+'"></span></div>'+t.replace(/-/g,' ')+'</div>';
  });
}

function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2500);}
function toggleMobileMenu(btn){document.getElementById('mobileHeaderContent').classList.toggle('expanded');btn.classList.toggle('active');}
async function logout(){await sb.auth.signOut();localStorage.removeItem('sb_access_token');localStorage.removeItem('sb_refresh_token');window.location.href='login.html';}
async function checkAuth(){var r=await sb.auth.getSession();var s=r.data.session;if(!s){var t=localStorage.getItem('sb_access_token'),rf=localStorage.getItem('sb_refresh_token');if(t&&rf){var sr=await sb.auth.setSession({access_token:t,refresh_token:rf});s=sr.data?.session;}if(!s){window.location.href='login.html';return null;}}return s;}

// ===== MEMBERS =====
async function loadMembers(){
  var r=await sb.from('event_members').select('*').eq('tenant_id',tenantId).order('first_name');
  allMembers=r.data||[];
  renderMemberList();
}

function renderMemberList(){
  var el=document.getElementById('memberList');
  if(!allMembers.length){el.innerHTML='<div style="padding:20px;text-align:center;color:var(--text-secondary);">No members yet</div>';return;}
  var h='';
  allMembers.forEach(function(m){
    var name=((m.first_name||'')+' '+(m.last_name||'')).trim()||'Unknown';
    var lvl=m.role_level||'team';
    h+='<div class="member-row"><div class="member-info"><div class="member-name">'+name+' <span class="role-badge '+lvl+'">'+lvl+'</span></div><div class="member-meta">';
    if(m.role) h+='<span>'+m.role+'</span>';
    if(m.phone) h+='<span>'+m.phone+'</span>';
    if(m.email) h+='<span>'+m.email+'</span>';
    h+='</div></div><button class="member-btn" onclick="openEditMember(\''+m.member_id+'\')">Edit</button></div>';
  });
  el.innerHTML=h;
}

function openAddMember(){
  editingMemberId=null;
  document.getElementById('memberModalTitle').textContent='Add Member';
  document.getElementById('mmFirst').value='';
  document.getElementById('mmLast').value='';
  document.getElementById('mmRole').value='';
  document.getElementById('mmLevel').value='team';
  document.getElementById('mmPhone').value='';
  document.getElementById('mmEmail').value='';
  document.getElementById('mmDeleteBtn').style.display='none';
  document.getElementById('memberModal').classList.add('active');
}

function openEditMember(id){
  var m=allMembers.find(function(x){return x.member_id===id;});
  if(!m) return;
  editingMemberId=id;
  document.getElementById('memberModalTitle').textContent='Edit Member';
  document.getElementById('mmFirst').value=m.first_name||'';
  document.getElementById('mmLast').value=m.last_name||'';
  document.getElementById('mmRole').value=m.role||'';
  document.getElementById('mmLevel').value=m.role_level||'team';
  document.getElementById('mmPhone').value=m.phone||'';
  document.getElementById('mmEmail').value=m.email||'';
  document.getElementById('mmDeleteBtn').style.display='block';
  document.getElementById('memberModal').classList.add('active');
}

function closeMemberModal(){document.getElementById('memberModal').classList.remove('active');}

async function saveMember(){
  var first=document.getElementById('mmFirst').value.trim();
  if(!first){showToast('Enter a first name');return;}
  var data={
    first_name:first,
    last_name:document.getElementById('mmLast').value.trim()||null,
    role:document.getElementById('mmRole').value.trim()||null,
    role_level:document.getElementById('mmLevel').value||'team',
    phone:document.getElementById('mmPhone').value.trim()||null,
    email:document.getElementById('mmEmail').value.trim()||null
  };
  if(editingMemberId){
    await sb.from('event_members').update(data).eq('member_id',editingMemberId);
    showToast('Member updated');
  } else {
    data.tenant_id=tenantId;
    data.is_active=true;
    await sb.from('event_members').insert(data);
    showToast('Member added');
  }
  closeMemberModal();
  await loadMembers();
}

async function deleteMember(){
  if(!editingMemberId||!confirm('Remove this member?')) return;
  await sb.from('event_members').delete().eq('member_id',editingMemberId);
  closeMemberModal();
  showToast('Member removed');
  await loadMembers();
}

// ===== PASSWORD =====
function openPwModal(){document.getElementById('pwNew').value='';document.getElementById('pwConfirm').value='';document.getElementById('pwModal').classList.add('active');}
function closePwModal(){document.getElementById('pwModal').classList.remove('active');}
async function changePassword(){
  var pw=document.getElementById('pwNew').value;
  var cf=document.getElementById('pwConfirm').value;
  if(pw.length<6){showToast('Min 6 characters');return;}
  if(pw!==cf){showToast('Passwords do not match');return;}
  var r=await sb.auth.updateUser({password:pw});
  if(r.error){showToast('Error: '+r.error.message);return;}
  closePwModal();showToast('Password updated');
}

// ===== DEPARTMENT ASSIGNMENTS =====
async function loadProjects(){
  var r=await sb.from('event_projects').select('*').eq('tenant_id',tenantId).order('created_at',{ascending:false});
  allProjects=r.data||[];
  var sel=document.getElementById('deptEventSelect');
  sel.innerHTML='<option value="">-- Select Event --</option>';
  allProjects.forEach(function(p){
    sel.innerHTML+='<option value="'+p.event_project_id+'">'+p.event_name+(p.event_date?' ('+p.event_date+')':'')+'</option>';
  });
}

async function switchDeptEvent(){
  var pid=document.getElementById('deptEventSelect').value;
  if(!pid){document.getElementById('deptAssignList').innerHTML='<div style="padding:20px;text-align:center;color:var(--text-secondary);">Select an event to manage department leads</div>';return;}
  var r=await sb.from('event_departments').select('*').eq('event_project_id',pid).order('department_name');
  deptEventDepts=r.data||[];
  renderDeptAssignments();
}

function renderDeptAssignments(){
  var el=document.getElementById('deptAssignList');
  if(!deptEventDepts.length){el.innerHTML='<div style="padding:20px;text-align:center;color:var(--text-secondary);">No departments in this event</div>';return;}
  var h='';
  deptEventDepts.forEach(function(dept){
    var budgetVal=parseFloat(dept.budget)||'';
    h+='<div class="dept-assign-row">';
    h+='<div class="dept-assign-name">'+dept.department_name+'</div>';
    h+='<input type="text" class="dept-assign-budget" id="deptBudget-'+dept.event_department_id+'" value="'+(budgetVal?'$'+Number(budgetVal).toLocaleString():'')+'" placeholder="$0" onchange="saveDeptAssign(\''+dept.event_department_id+'\')" onfocus="this.value=this.value.replace(/[^0-9.]/g,\'\')" onblur="formatBudgetField(this)">';
    h+='<select class="dept-assign-select" id="deptLead-'+dept.event_department_id+'" onchange="saveDeptAssign(\''+dept.event_department_id+'\')">';
    h+='<option value="">-- No Lead --</option>';
    allMembers.forEach(function(m){
      var name=((m.first_name||'')+' '+(m.last_name||'')).trim()||'Unknown';
      var badge=m.role_level==='admin'?' [A]':(m.role_level==='manager'?' [M]':'');
      var selected=dept.lead_employee_id===m.member_id?' selected':'';
      h+='<option value="'+m.member_id+'"'+selected+'>'+name+badge+'</option>';
    });
    h+='</select>';
    h+='<span class="dept-assign-saved" id="deptSaved-'+dept.event_department_id+'">Saved</span>';
    h+='</div>';
  });
  el.innerHTML=h;
}

function formatBudgetField(el){
  var num=parseFloat(el.value.replace(/[^0-9.]/g,''))||0;
  el.value=num>0?'$'+num.toLocaleString():'';
}

async function saveDeptAssign(deptId){
  var leadId=document.getElementById('deptLead-'+deptId).value||null;
  var rawBudget=document.getElementById('deptBudget-'+deptId).value.replace(/[^0-9.]/g,'');
  var budget=parseFloat(rawBudget)||0;
  await sb.from('event_departments').update({lead_employee_id:leadId,budget:budget}).eq('event_department_id',deptId);
  var saved=document.getElementById('deptSaved-'+deptId);
  saved.classList.add('show');
  setTimeout(function(){saved.classList.remove('show');},2000);
}

async function saveDeptLead(deptId){
  saveDeptAssign(deptId);
}

// ===== INIT =====
async function init(){
  var s=await checkAuth();if(!s)return;userId=s.user.id;
  document.getElementById('settingEmail').textContent=s.user.email||'';
  document.getElementById('mobileBusinessName').textContent=s.user.email||'';
  document.getElementById('desktopBusinessName').textContent=s.user.email||'';
  if(s.user.email){var ur=await sb.from('users').select('tenant_id,user_id').eq('email',s.user.email).single();if(ur.data){tenantId=ur.data.tenant_id;userId=ur.data.user_id;}}
  if(!tenantId){var bs=await sb.from('business_settings').select('tenant_id').limit(1).single();if(bs.data)tenantId=bs.data.tenant_id;}
  if(!tenantId){showToast('Could not determine tenant');return;}
  renderThemeGrid();
  await loadMembers();
  await loadProjects();
}
init();
</script>
</body>
</html>
