<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>EventLogicPro - Members</title>
  <script>(function(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);})();</script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="dark-blue"]{--bg-primary:#0b0f14;--bg-secondary:#0f1621;--bg-card:#1a2535;--bg-hover:#223044;--border-default:#223044;--text-primary:#e8eef6;--text-secondary:#9fb0c3;--accent-primary:#3b82f6;--accent-light:#60a5fa;}
    [data-theme="grey"]{--bg-primary:#111;--bg-secondary:#1a1a1a;--bg-card:#242424;--bg-hover:#2e2e2e;--border-default:#333;--text-primary:#e5e5e5;--text-secondary:#a3a3a3;--accent-primary:#525252;--accent-light:#737373;}
    [data-theme="slate"],[data-theme="slate-dark"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#273549;--bg-hover:#334155;--border-default:#334155;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--accent-primary:#6366f1;--accent-light:#818cf8;}
    [data-theme="charcoal"]{--bg-primary:#121214;--bg-secondary:#18181b;--bg-card:#27272a;--bg-hover:#3f3f46;--border-default:#3f3f46;--text-primary:#fafafa;--text-secondary:#a1a1aa;--accent-primary:#a1a1aa;--accent-light:#d4d4d8;}
    [data-theme="midnight"],[data-theme="midnight-dark"]{--bg-primary:#09090b;--bg-secondary:#0f0f12;--bg-card:#18181d;--bg-hover:#222228;--border-default:#27272f;--text-primary:#eeeef0;--text-secondary:#9898a4;--accent-primary:#8b5cf6;--accent-light:#a78bfa;}
    [data-theme="navy"]{--bg-primary:#0a0e1a;--bg-secondary:#0f1526;--bg-card:#182035;--bg-hover:#1f2a45;--border-default:#253352;--text-primary:#e8ecf4;--text-secondary:#9aa5bd;--accent-primary:#4a7cc9;--accent-light:#6b9ae0;}
    [data-theme="graphite"]{--bg-primary:#0d0d0d;--bg-secondary:#141414;--bg-card:#1f1f1f;--bg-hover:#292929;--border-default:#2e2e2e;--text-primary:#e8e8e8;--text-secondary:#999;--accent-primary:#4a9eff;--accent-light:#6bb3ff;}
    [data-theme="ocean"],[data-theme="ocean-dark"]{--bg-primary:#0a1214;--bg-secondary:#0e181c;--bg-card:#152228;--bg-hover:#1c2d35;--border-default:#243842;--text-primary:#e5f0f3;--text-secondary:#8faab5;--accent-primary:#14b8a6;--accent-light:#2dd4bf;}
    [data-theme="forest"],[data-theme="forest-dark"]{--bg-primary:#0a100c;--bg-secondary:#0f1812;--bg-card:#16221a;--bg-hover:#1e2e24;--border-default:#263830;--text-primary:#e5f0e8;--text-secondary:#8faa96;--accent-primary:#22c55e;--accent-light:#4ade80;}
    [data-theme="obsidian"]{--bg-primary:#050505;--bg-secondary:#0a0a0a;--bg-card:#141414;--bg-hover:#1c1c1c;--border-default:#252525;--text-primary:#e0e0e0;--text-secondary:#888;--accent-primary:#0ea5e9;--accent-light:#38bdf8;}
    [data-theme="steel"]{--bg-primary:#0c0f13;--bg-secondary:#12161c;--bg-card:#1a2028;--bg-hover:#242c38;--border-default:#2c3644;--text-primary:#e4e8ed;--text-secondary:#8b95a5;--accent-primary:#64748b;--accent-light:#94a3b8;}
    [data-theme="espresso"]{--bg-primary:#0f0c0a;--bg-secondary:#161210;--bg-card:#211c18;--bg-hover:#2c2520;--border-default:#382f28;--text-primary:#f0ebe5;--text-secondary:#a89e94;--accent-primary:#a78b6e;--accent-light:#c4a88a;}
    [data-theme="onyx"]{--bg-primary:#000;--bg-secondary:#080808;--bg-card:#121212;--bg-hover:#1a1a1a;--border-default:#222;--text-primary:#f5f5f5;--text-secondary:#8c8c8c;--accent-primary:#06b6d4;--accent-light:#22d3ee;}
    [data-theme="light-blue"],[data-theme="blue-light"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#2563eb;--accent-light:#3b82f6;}
    [data-theme="light-grey"],[data-theme="slate-light"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#e5e5e5;--border-default:#d4d4d4;--text-primary:#171717;--text-secondary:#525252;--accent-primary:#404040;--accent-light:#525252;}
    [data-theme="light-slate"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#0f172a;--text-secondary:#475569;--accent-primary:#4f46e5;--accent-light:#6366f1;}
    [data-theme="light-ocean"],[data-theme="ocean-light"]{--bg-primary:#f0fdfa;--bg-secondary:#ccfbf1;--bg-card:#fff;--bg-hover:#99f6e4;--border-default:#5eead4;--text-primary:#134e4a;--text-secondary:#0f766e;--accent-primary:#0d9488;--accent-light:#14b8a6;}
    [data-theme="light-forest"],[data-theme="mint-light"],[data-theme="mint"]{--bg-primary:#f0fdf4;--bg-secondary:#dcfce7;--bg-card:#fff;--bg-hover:#bbf7d0;--border-default:#86efac;--text-primary:#14532d;--text-secondary:#166534;--accent-primary:#16a34a;--accent-light:#22c55e;}
    [data-theme="light-midnight"],[data-theme="lavender-light"],[data-theme="lavender"]{--bg-primary:#faf5ff;--bg-secondary:#f3e8ff;--bg-card:#fff;--bg-hover:#e9d5ff;--border-default:#d8b4fe;--text-primary:#1e1b4b;--text-secondary:#5b21b6;--accent-primary:#7c3aed;--accent-light:#8b5cf6;}
    [data-theme="light-obsidian"],[data-theme="sky-light"],[data-theme="sky"]{--bg-primary:#f0f9ff;--bg-secondary:#e0f2fe;--bg-card:#fff;--bg-hover:#bae6fd;--border-default:#7dd3fc;--text-primary:#0c4a6e;--text-secondary:#0369a1;--accent-primary:#0284c7;--accent-light:#0ea5e9;}
    [data-theme="light-espresso"]{--bg-primary:#fefcfb;--bg-secondary:#fdf4ef;--bg-card:#fff;--bg-hover:#f5e6db;--border-default:#ddc9b8;--text-primary:#3d2c1e;--text-secondary:#6b5344;--accent-primary:#8b6f4e;--accent-light:#a78b6e;}
    [data-theme="light-graphite"]{--bg-primary:#fafafa;--bg-secondary:#f5f5f5;--bg-card:#fff;--bg-hover:#ebebeb;--border-default:#d1d1d1;--text-primary:#1a1a1a;--text-secondary:#4a4a4a;--accent-primary:#2196f3;--accent-light:#42a5f5;}
    [data-theme="light-onyx"]{--bg-primary:#ecfeff;--bg-secondary:#cffafe;--bg-card:#fff;--bg-hover:#a5f3fc;--border-default:#67e8f9;--text-primary:#164e63;--text-secondary:#0e7490;--accent-primary:#0891b2;--accent-light:#06b6d4;}
    [data-theme="light-steel"]{--bg-primary:#f8fafc;--bg-secondary:#f1f5f9;--bg-card:#fff;--bg-hover:#e2e8f0;--border-default:#cbd5e1;--text-primary:#1e293b;--text-secondary:#475569;--accent-primary:#475569;--accent-light:#64748b;}
    [data-theme="light-navy"]{--bg-primary:#f0f4ff;--bg-secondary:#e0e7ff;--bg-card:#fff;--bg-hover:#c7d2fe;--border-default:#a5b4fc;--text-primary:#1e1b4b;--text-secondary:#3730a3;--accent-primary:#3949ab;--accent-light:#5c6bc0;}
    [data-theme="light-charcoal"]{--bg-primary:#fafafa;--bg-secondary:#f4f4f5;--bg-card:#fff;--bg-hover:#e4e4e7;--border-default:#d4d4d8;--text-primary:#18181b;--text-secondary:#52525b;--accent-primary:#71717a;--accent-light:#a1a1aa;}
    [data-theme="cyber-dark"],[data-theme="cyber"]{--bg-primary:#0a0a0f;--bg-secondary:#0f0f18;--bg-card:#151522;--bg-hover:#1c1c2e;--border-default:#2a2a44;--text-primary:#e0e0ff;--text-secondary:#9090c0;--accent-primary:#00ff88;--accent-light:#44ffaa;}
    [data-theme="amber-dark"],[data-theme="amber"]{--bg-primary:#0f0c05;--bg-secondary:#1a1508;--bg-card:#26200c;--bg-hover:#332a10;--border-default:#443815;--text-primary:#fef3c7;--text-secondary:#c9b896;--accent-primary:#f59e0b;--accent-light:#fbbf24;}
    [data-theme="honey-light"],[data-theme="honey"]{--bg-primary:#fffbeb;--bg-secondary:#fef3c7;--bg-card:#fff;--bg-hover:#fde68a;--border-default:#fcd34d;--text-primary:#78350f;--text-secondary:#a06020;--accent-primary:#d97706;--accent-light:#f59e0b;}
    [data-theme="crimson-dark"],[data-theme="crimson"]{--bg-primary:#0f0708;--bg-secondary:#1a0c0e;--bg-card:#261214;--bg-hover:#331a1c;--border-default:#442225;--text-primary:#fee2e2;--text-secondary:#c9a3a5;--accent-primary:#dc2626;--accent-light:#ef4444;}
    [data-theme="coral-light"],[data-theme="coral"]{--bg-primary:#fff5f5;--bg-secondary:#fee2e2;--bg-card:#fff;--bg-hover:#fecaca;--border-default:#fca5a5;--text-primary:#7f1d1d;--text-secondary:#a04444;--accent-primary:#ef4444;--accent-light:#f87171;}
    [data-theme="rose-dark"],[data-theme="rose"]{--bg-primary:#0f070a;--bg-secondary:#1a0c12;--bg-card:#26121a;--bg-hover:#331a24;--border-default:#44222e;--text-primary:#ffe4ec;--text-secondary:#c9a3b0;--accent-primary:#ec4899;--accent-light:#f472b6;}
    [data-theme="sand-light"],[data-theme="sand"]{--bg-primary:#fefcf8;--bg-secondary:#faf6ee;--bg-card:#fff;--bg-hover:#f5efe0;--border-default:#e8dcc8;--text-primary:#44402a;--text-secondary:#6a6550;--accent-primary:#a89060;--accent-light:#c4aa78;}

    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary);overflow-x:hidden;}
    body{padding-bottom:120px;}
    .theme-toggle-btn{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-secondary);cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .theme-toggle-btn:hover{background:var(--bg-hover);}
    .theme-toggle-btn svg{width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;}
    .business-name{font-size:13px;color:var(--text-secondary);}
    .toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--bg-card);color:var(--text-primary);padding:12px 24px;border-radius:10px;font-size:13px;font-weight:600;border:1px solid var(--accent-primary);z-index:9999;display:none;}
    .toast.show{display:block;}
    .mobile-top-header{display:none;}
    .mobile-header-bar{display:flex;align-items:center;padding:12px 16px;gap:12px;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-menu-toggle{width:36px;height:36px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-primary);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .mobile-header-center{flex:1;}.mobile-header-title{font-size:18px;font-weight:700;}
    .mobile-header-content{display:none;padding:12px 16px;background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-header-content.expanded{display:block;}
    .mobile-header-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .mobile-header-actions button{padding:10px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:13px;cursor:pointer;}
    .desktop-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-default);}
    .mobile-bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg-secondary);padding:8px;z-index:100;border-top:1px solid var(--border-default);}
    .mobile-nav-top{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
    .mobile-nav-btn{padding:10px 8px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-card);color:var(--text-secondary);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;display:flex;align-items:center;justify-content:center;min-height:44px;transition:all .2s;}
    .mobile-nav-btn.active{background:color-mix(in srgb,var(--accent-primary) 60%,transparent);border-color:var(--accent-primary);color:var(--text-primary);}

    .content{max-width:900px;margin:0 auto;padding:16px;}
    .page-title-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
    .page-title{font-size:22px;font-weight:700;}
    .add-btn{padding:10px 20px;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;font-size:13px;font-weight:600;cursor:pointer;}
    .member-card{background:var(--bg-card);border:1px solid var(--border-default);border-radius:12px;margin-bottom:10px;overflow:hidden;transition:border-color .2s;}
    .member-card:hover{border-color:var(--accent-primary);}
    .member-card-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;}
    .member-left{display:flex;align-items:center;gap:12px;flex:1;min-width:0;}
    .member-avatar{width:40px;height:40px;border-radius:50%;background:var(--accent-primary);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:16px;flex-shrink:0;}
    .member-info{min-width:0;}
    .member-name{font-size:15px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .member-role{font-size:11px;color:var(--text-secondary);margin-top:1px;}
    .member-quick{display:flex;gap:12px;flex-shrink:0;}
    .member-quick-item{font-size:11px;color:var(--text-secondary);display:flex;align-items:center;gap:4px;}
    .member-expand{font-size:12px;color:var(--text-secondary);transition:transform .2s;margin-left:8px;}
    .member-card.expanded .member-expand{transform:rotate(180deg);}
    .member-body{display:none;padding:0 16px 16px;border-top:1px solid var(--border-default);}
    .member-card.expanded .member-body{display:block;}
    .member-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding-top:14px;}
    .member-field{display:flex;flex-direction:column;gap:2px;}
    .member-field-label{font-size:10px;text-transform:uppercase;color:var(--text-secondary);font-weight:600;letter-spacing:.5px;}
    .member-field-value{font-size:14px;}
    .member-field-value a{color:var(--accent-light);text-decoration:none;}
    .member-section-title{font-size:12px;font-weight:700;color:var(--accent-light);margin-top:14px;margin-bottom:8px;grid-column:1/-1;}
    .member-actions{display:flex;gap:8px;padding-top:14px;grid-column:1/-1;}
    .member-actions button{padding:8px 16px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;}
    .edit-btn{border:1px solid var(--accent-primary);background:transparent;color:var(--accent-light);}
    .del-btn{border:1px solid #ef4444;background:transparent;color:#ef4444;}

    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;}
    .modal-overlay.active{opacity:1;pointer-events:auto;}
    .modal-content{background:var(--bg-card);border-radius:16px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;border:1px solid var(--border-default);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-default);}
    .modal-title{font-size:16px;font-weight:700;}
    .modal-close{width:32px;height:32px;border-radius:8px;border:none;background:transparent;color:var(--text-secondary);font-size:20px;cursor:pointer;}
    .modal-body{padding:20px;}
    .modal-footer{display:flex;justify-content:flex-end;gap:10px;padding:16px 20px;border-top:1px solid var(--border-default);}
    .form-group{margin-bottom:14px;}
    .form-label{font-size:12px;font-weight:600;color:var(--text-secondary);margin-bottom:4px;display:block;}
    .form-input,.form-select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);font-size:14px;font-family:inherit;}
    .form-input:focus,.form-select:focus{outline:none;border-color:var(--accent-primary);}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .form-section{font-size:12px;font-weight:700;color:var(--accent-light);margin:16px 0 8px;padding-top:12px;border-top:1px solid var(--border-default);}
    .btn-primary{padding:10px 20px;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;font-size:13px;font-weight:600;cursor:pointer;}
    .btn-secondary{padding:10px 20px;border-radius:8px;border:1px solid var(--border-default);background:transparent;color:var(--text-primary);font-size:13px;font-weight:600;cursor:pointer;}

    @media(max-width:768px){
      .desktop-header{display:none !important;}.mobile-top-header{display:block;}.mobile-bottom-nav{display:block !important;}
      .modal-overlay{align-items:flex-end;padding:0;}.modal-content{border-radius:20px 20px 0 0;max-height:85vh;}
      .form-row{grid-template-columns:1fr;}
      .member-grid{grid-template-columns:1fr 1fr;}
      .member-quick{display:none;}
      .content{padding:12px;}
      body{padding-bottom:80px;}
    }
    @media(min-width:769px){.mobile-top-header{display:none !important;}.mobile-bottom-nav{display:none !important;}body{padding-bottom:20px;}}
  </style>
</head>
<body>

<div class="mobile-top-header">
  <div class="mobile-header-bar">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu(this)"><span>&#9776;</span></button>
    <div class="mobile-header-center"><div class="mobile-header-title">Team Members</div><div class="business-name" id="mobileBusinessName">Loading...</div></div>
    <button class="add-btn" onclick="openMemberModal()" style="font-size:12px;padding:8px 12px;">+ Add</button>
  </div>
  <div class="mobile-header-content" id="mobileHeaderContent"><div class="mobile-header-actions"><button onclick="location.href='eventlogicpro-settings.html'">Settings</button><button onclick="logout()">Logout</button></div></div>
</div>

<div class="desktop-header">
  <div style="padding:16px 24px 8px;display:flex;justify-content:space-between;align-items:center;">
    <div><h1 style="margin:0;font-size:32px;font-weight:600;">EventLogicPro</h1><div class="business-name" id="desktopBusinessName">Loading...</div></div>
    <div style="display:flex;align-items:center;gap:16px;"><button class="theme-toggle-btn" onclick="cycleTheme()"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></button><a onclick="logout()" style="color:var(--text-secondary);cursor:pointer;font-size:14px;">Logout</a></div>
  </div>
  <div style="padding:0 24px 12px;"><nav style="display:flex;gap:24px;">
    <a href="eventlogicpro.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Events</a>
    <a href="eventlogicpro-scheduler.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Scheduler</a>
    <a href="eventlogicpro-members.html" style="padding:12px 0;color:var(--accent-primary);text-decoration:none;font-size:14px;border-bottom:2px solid var(--accent-primary);">Members</a>
    <a href="eventlogicpro-settings.html" style="padding:12px 0;color:var(--text-secondary);text-decoration:none;font-size:14px;">Settings</a>
  </nav></div>
</div>

<div class="content">
  <div class="page-title-bar"><div class="page-title">Team Members</div><button class="add-btn" onclick="openMemberModal()">+ Add Member</button></div>
  <div id="membersList"><div style="text-align:center;padding:40px;color:var(--text-secondary);">Loading...</div></div>
</div>

<!-- Member Modal -->
<div class="modal-overlay" id="memberModal">
  <div class="modal-content">
    <div class="modal-header"><div class="modal-title" id="memberModalTitle">Add Member</div><button class="modal-close" onclick="closeMemberModal()">&times;</button></div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label class="form-label">First Name *</label><input type="text" class="form-input" id="mmFirst"></div>
        <div class="form-group"><label class="form-label">Last Name</label><input type="text" class="form-input" id="mmLast"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="mmEmail"></div>
        <div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" id="mmPhone"></div>
      </div>
      <div class="form-group"><label class="form-label">Role Level</label><select class="form-select" id="mmRole"><option value="team">Team</option><option value="manager">Manager</option><option value="admin">Admin</option></select></div>

      <div class="form-section">Personal Info</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Birthday</label><input type="date" class="form-input" id="mmBday"></div>
        <div class="form-group"><label class="form-label">Anniversary</label><input type="date" class="form-input" id="mmAnniversary"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Shirt Size</label><select class="form-select" id="mmShirt"><option value="">--</option><option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option><option>2XL</option><option>3XL</option></select></div>
        <div class="form-group"><label class="form-label">Blood Type</label><select class="form-select" id="mmBlood"><option value="">--</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option></select></div>
      </div>

      <div class="form-section">Emergency Contact</div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">E-Contact Name</label><input type="text" class="form-input" id="mmEcName"></div>
        <div class="form-group"><label class="form-label">E-Contact Phone</label><input type="tel" class="form-input" id="mmEcPhone"></div>
      </div>
      <div class="form-group"><label class="form-label">E-Contact Relationship</label><input type="text" class="form-input" id="mmEcRelation" placeholder="e.g. Spouse, Parent, Sibling"></div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="closeMemberModal()">Cancel</button><button class="btn-primary" onclick="saveMember()">Save</button></div>
  </div>
</div>

<div class="mobile-bottom-nav"><div class="mobile-nav-top"><a href="eventlogicpro.html" class="mobile-nav-btn">Events</a><a href="eventlogicpro-scheduler.html" class="mobile-nav-btn">Schedule</a><a href="eventlogicpro-members.html" class="mobile-nav-btn active">Members</a><a href="eventlogicpro-settings.html" class="mobile-nav-btn">Settings</a></div></div>
<div class="toast" id="toast"></div>

<script>
var SUPABASE_URL='https://kxqkwpkmtgvmthpafoqx.supabase.co';
var SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4';
var sb=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
var tenantId=null,userId=null,allMembers=[],editingMemberId=null;

var themes=['dark-blue','grey','slate','charcoal','midnight','navy','graphite','ocean','forest','obsidian','steel','espresso','onyx','light-blue','light-grey','light-slate','light-ocean','light-forest','light-midnight','light-obsidian','light-espresso','light-graphite','light-onyx','light-steel','light-navy','light-charcoal','cyber','amber','honey','crimson','coral','rose','sand'];
var themeIndex=0;
function loadTheme(){var t=localStorage.getItem('app-theme')||'dark-blue';document.documentElement.setAttribute('data-theme',t);themeIndex=themes.indexOf(t);if(themeIndex<0)themeIndex=0;}
function cycleTheme(){themeIndex=(themeIndex+1)%themes.length;var t=themes[themeIndex];document.documentElement.setAttribute('data-theme',t);localStorage.setItem('app-theme',t);}
loadTheme();
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2500);}
function toggleMobileMenu(btn){document.getElementById('mobileHeaderContent').classList.toggle('expanded');}
async function logout(){await sb.auth.signOut();window.location.href='login.html';}
async function checkAuth(){var r=await sb.auth.getSession();var s=r.data.session;if(!s){var t=localStorage.getItem('sb_access_token'),rf=localStorage.getItem('sb_refresh_token');if(t&&rf){var sr=await sb.auth.setSession({access_token:t,refresh_token:rf});s=sr.data?.session;}if(!s){window.location.href='login.html';return null;}}return s;}

async function loadMembers(){var r=await sb.from('event_members').select('*').eq('tenant_id',tenantId).order('first_name');allMembers=r.data||[];renderMembers();}

function getInitials(m){return ((m.first_name||'')[0]||'')+((m.last_name||'')[0]||'');}
var avatarColors=['#3b82f6','#22c55e','#f59e0b','#ef4444','#8b5cf6','#ec4899','#14b8a6','#f97316','#06b6d4','#6366f1'];

function renderMembers(){
  var el=document.getElementById('membersList');
  if(!allMembers.length){el.innerHTML='<div style="text-align:center;padding:40px;color:var(--text-secondary);">No members yet. Add your first team member!</div>';return;}
  var h='';
  allMembers.forEach(function(m,idx){
    var name=((m.first_name||'')+' '+(m.last_name||'')).trim()||'Unknown';
    var color=avatarColors[idx%avatarColors.length];
    h+='<div class="member-card" id="mc-'+m.member_id+'">';
    h+='<div class="member-card-header" onclick="toggleMember(\''+m.member_id+'\')">';
    h+='<div class="member-left"><div class="member-avatar" style="background:'+color+'">'+getInitials(m)+'</div>';
    h+='<div class="member-info"><div class="member-name">'+name+'</div><div class="member-role">'+(m.role_level||'team').toUpperCase()+'</div></div></div>';
    h+='<div class="member-quick">';
    if(m.phone) h+='<div class="member-quick-item">üì± '+m.phone+'</div>';
    if(m.email) h+='<div class="member-quick-item">‚úâÔ∏è '+m.email+'</div>';
    h+='</div>';
    h+='<span class="member-expand">‚ñº</span>';
    h+='</div>';
    h+='<div class="member-body"><div class="member-grid">';
    h+='<div class="member-field"><div class="member-field-label">Email</div><div class="member-field-value">'+(m.email?'<a href="mailto:'+m.email+'">'+m.email+'</a>':'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Phone</div><div class="member-field-value">'+(m.phone?'<a href="tel:'+m.phone+'">'+m.phone+'</a>':'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Birthday</div><div class="member-field-value">'+(m.birthday||'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Anniversary</div><div class="member-field-value">'+(m.anniversary||'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Shirt Size</div><div class="member-field-value">'+(m.shirt_size||'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Blood Type</div><div class="member-field-value">'+(m.blood_type||'‚Äî')+'</div></div>';
    h+='<div class="member-section-title">Emergency Contact</div>';
    h+='<div class="member-field"><div class="member-field-label">Name</div><div class="member-field-value">'+(m.ec_name||'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Phone</div><div class="member-field-value">'+(m.ec_phone?'<a href="tel:'+m.ec_phone+'">'+m.ec_phone+'</a>':'‚Äî')+'</div></div>';
    h+='<div class="member-field"><div class="member-field-label">Relationship</div><div class="member-field-value">'+(m.ec_relationship||'‚Äî')+'</div></div>';
    h+='<div class="member-actions"><button class="edit-btn" onclick="event.stopPropagation();openEditMember(\''+m.member_id+'\')">Edit</button><button class="del-btn" onclick="event.stopPropagation();deleteMember(\''+m.member_id+'\')">Delete</button></div>';
    h+='</div></div></div>';
  });
  el.innerHTML=h;
}

function toggleMember(id){document.getElementById('mc-'+id).classList.toggle('expanded');}

function openMemberModal(){
  editingMemberId=null;
  document.getElementById('memberModalTitle').textContent='Add Member';
  ['mmFirst','mmLast','mmEmail','mmPhone','mmBday','mmAnniversary','mmEcName','mmEcPhone','mmEcRelation'].forEach(function(id){document.getElementById(id).value='';});
  document.getElementById('mmRole').value='team';
  document.getElementById('mmShirt').value='';
  document.getElementById('mmBlood').value='';
  document.getElementById('memberModal').classList.add('active');
}

function openEditMember(id){
  var m=allMembers.find(function(x){return x.member_id===id;});
  if(!m)return;
  editingMemberId=id;
  document.getElementById('memberModalTitle').textContent='Edit Member';
  document.getElementById('mmFirst').value=m.first_name||'';
  document.getElementById('mmLast').value=m.last_name||'';
  document.getElementById('mmEmail').value=m.email||'';
  document.getElementById('mmPhone').value=m.phone||'';
  document.getElementById('mmRole').value=m.role_level||'team';
  document.getElementById('mmBday').value=m.birthday||'';
  document.getElementById('mmAnniversary').value=m.anniversary||'';
  document.getElementById('mmShirt').value=m.shirt_size||'';
  document.getElementById('mmBlood').value=m.blood_type||'';
  document.getElementById('mmEcName').value=m.ec_name||'';
  document.getElementById('mmEcPhone').value=m.ec_phone||'';
  document.getElementById('mmEcRelation').value=m.ec_relationship||'';
  document.getElementById('memberModal').classList.add('active');
}

function closeMemberModal(){document.getElementById('memberModal').classList.remove('active');}

async function saveMember(){
  var first=document.getElementById('mmFirst').value.trim();
  if(!first){showToast('First name required');return;}
  var data={
    first_name:first,
    last_name:document.getElementById('mmLast').value.trim()||null,
    email:document.getElementById('mmEmail').value.trim()||null,
    phone:document.getElementById('mmPhone').value.trim()||null,
    role_level:document.getElementById('mmRole').value,
    birthday:document.getElementById('mmBday').value||null,
    anniversary:document.getElementById('mmAnniversary').value||null,
    shirt_size:document.getElementById('mmShirt').value||null,
    blood_type:document.getElementById('mmBlood').value||null,
    ec_name:document.getElementById('mmEcName').value.trim()||null,
    ec_phone:document.getElementById('mmEcPhone').value.trim()||null,
    ec_relationship:document.getElementById('mmEcRelation').value.trim()||null
  };
  if(editingMemberId){
    await sb.from('event_members').update(data).eq('member_id',editingMemberId);
    showToast('Member updated');
  } else {
    data.tenant_id=tenantId;
    await sb.from('event_members').insert(data);
    showToast('Member added');
  }
  closeMemberModal();await loadMembers();
}

async function deleteMember(id){
  if(!confirm('Delete this member? They will be unassigned from all tasks.'))return;
  await sb.from('event_members').delete().eq('member_id',id);
  showToast('Member deleted');await loadMembers();
}

async function init(){var s=await checkAuth();if(!s)return;userId=s.user.id;var ue=s.user.email||'';if(ue){var ur=await sb.from('users').select('tenant_id,user_id').eq('email',ue).single();if(ur.data){tenantId=ur.data.tenant_id;userId=ur.data.user_id;}document.getElementById('mobileBusinessName').textContent=ue;document.getElementById('desktopBusinessName').textContent=ue;}if(!tenantId){var bs=await sb.from('business_settings').select('tenant_id').limit(1).single();if(bs.data)tenantId=bs.data.tenant_id;}if(!tenantId){showToast('Could not determine tenant');return;}await loadMembers();}
init();
</script>
</body>
</html>
