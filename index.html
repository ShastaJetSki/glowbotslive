<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GlowbotsLive - Voice Agent</title>

    <style>
      *{margin:0;padding:0;box-sizing:border-box}
      body{height:100vh;background:#000;overflow:hidden}

      #voice-button{
        position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
        width:220px;height:220px;border-radius:50%;border:none;cursor:pointer;
        background:linear-gradient(135deg, #dc143c, #b22222); /* RUBY RED */
        box-shadow:0 15px 130px rgba(220,20,60,0.8), inset 0 -10px 30px rgba(0,0,0,0.3);
        transition:all .35s;z-index:9999;
      }
      #voice-button:hover{transform:translate(-50%,-50%) scale(1.38);box-shadow:0 25px 160px rgba(220,20,60,1);}
      #voice-button.listening{
        background:linear-gradient(135deg, #ff0000, #dc143c);
        box-shadow:0 0 180px #ff0000, 0 0 240px #ff0000;
        animation:red 1.4s infinite;
      }
      @keyframes red{
        0%,100%{box-shadow:0 0 180px #ff0000, 0 0 240px #ff0000}
        70% {box-shadow:0 0 220px #ff0000, 0 0 300px #ff0000}
      }

      .status{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);
        color:#dc143c;font:18px system-ui;text-shadow:0 0 15px #dc143c;opacity:0.9}
    </style>
  </head>
  <body>
    <button id="voice-button"></button>
    <div class="status" id="status">Loading ruby red button...</div>

    <!-- Official Vapi Web SDK via jsDelivr (latest, no duplicates) -->
    <script type="module">
      import { Vapi } from 'https://cdn.skypack.dev/@vapi-ai/web';
      window.Vapi = Vapi;  // Expose for non-module use below
    </script>

    <script>
      const button = document.getElementById('voice-button');
      const status = document.getElementById('status');

      let vapi = null;

      // Wait for SDK to load, then initialize
      function initVapi() {
        if (window.Vapi) {
          vapi = new window.Vapi("b66ad6e7-ec9d-421c-88b7-157068b27f6d"); // Your public key
          status.textContent = "RUBY RED BUTTON READY — Click to talk!";
          console.log("Ruby red test version loaded & ready (no more warnings!)");

          // Official event handlers
          vapi.on("call-start", () => {
            button.classList.add("listening");
            status.textContent = "Listening… speak now!";
          });

          vapi.on("call-end", () => {
            button.classList.remove("listening");
            status.textContent = "Call ended — click again";
          });

          vapi.on("error", (e) => {
            console.error("Vapi error:", e);
            status.textContent = "Error — check console";
            button.classList.remove("listening");
          });
        } else {
          status.textContent = "SDK failed to load — reload page";
          console.error("Vapi SDK not found — check network or script path");
        }
      }

      // Load SDK if not already, then init
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initVapi);
      } else {
        initVapi();
      }

      // Click toggles start/stop (official methods with direct string param)
      button.addEventListener("click", () => {
        if (!vapi) {
          status.textContent = "SDK not ready — wait or reload";
          return;
        }
        if (button.classList.contains("listening")) {
          vapi.stop();
        } else {
          status.textContent = "Connecting…";
          vapi.start("1dadddca-84c7-44a8-b5cd-7505b6b52cff"); // Your assistant ID as string
        }
      });
    </script>
  </body>
</html>
