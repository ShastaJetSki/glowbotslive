<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WorkLogic Pro – Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- ✅ YOUR ANON PUBLIC KEY -->
  <meta name="supabase-anon-key"
    content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4" />

  <style>
    body {
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#0b0f14;
      font-family:system-ui;
      color:#e8eef6;
    }
    .card {
      width:360px;
      padding:20px;
      border-radius:16px;
      background:#0f1621;
      border:1px solid #223044;
    }
    input, button {
      width:100%;
      padding:10px;
      margin-top:10px;
      border-radius:10px;
      border:1px solid #223044;
      background:#0b0f14;
      color:#fff;
    }
    button {
      background:#1a2535;
      cursor:pointer;
    }
    .error {
      margin-top:12px;
      color:#ffb3b3;
      font-size:13px;
      display:none;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>WorkLogic Pro</h2>

  <input id="email" type="email" placeholder="email" />
  <input id="password" type="password" placeholder="password" />

  <button id="login">Sign In</button>

  <div id="error" class="error"></div>
</div>

<script>
const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
const API_BASE = `https://${PROJECT_REF}.supabase.co`;

const ANON_KEY = document
  .querySelector('meta[name="supabase-anon-key"]')
  .content;

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const errorBox = document.getElementById("error");
const loginBtn = document.getElementById("login");

async function login() {
  errorBox.style.display = "none";

  try {
    const res = await fetch(
      `${API_BASE}/auth/v1/token?grant_type=password`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          apikey: ANON_KEY
        },
        body: JSON.stringify({
          email: emailInput.value.trim(),
          password: passwordInput.value
        })
      }
    );

    const data = await res.json();
    console.log("AUTH RESPONSE", res.status, data);

    if (!res.ok) {
      throw new Error(
        data.error_description ||
        data.error ||
        "Login failed"
      );
    }

    if (!data.access_token) {
      throw new Error("No access token returned");
    }

    // ✅ STORE JWT
    localStorage.setItem("sb_access_token", data.access_token);

    // ✅ GO TO DASHBOARD
    window.location.href = "dashboard.html";

  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.style.display = "block";
  }
}

loginBtn.onclick = login;
passwordInput.onkeydown = e => e.key === "Enter" && login();

// Auto redirect if already logged in
if (localStorage.getItem("sb_access_token")) {
  window.location.href = "dashboard.html";
}
</script>

</body>
</html>
