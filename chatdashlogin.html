<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WorkLogic Pro – Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- PUBLIC anon key (safe to expose) -->
  <meta name="supabase-anon-key" content="YOUR_PUBLIC_ANON_KEY" />

  <style>
    body {
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#0b0f14;
      font-family: system-ui, -apple-system, Segoe UI, Roboto;
      color:#e8eef6;
    }
    .card {
      width:100%;
      max-width:360px;
      background:#0f1621;
      border:1px solid #223044;
      border-radius:16px;
      padding:20px;
    }
    h1 {
      margin:0 0 4px 0;
      font-size:20px;
    }
    .muted {
      color:#9fb0c3;
      font-size:13px;
      margin-bottom:16px;
    }
    label {
      font-size:12px;
      color:#9fb0c3;
    }
    input {
      width:100%;
      margin-top:4px;
      margin-bottom:12px;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #223044;
      background:#0b0f14;
      color:#fff;
      font-size:14px;
    }
    button {
      width:100%;
      padding:10px;
      border-radius:12px;
      border:1px solid #2a3b55;
      background:#1a2535;
      color:#fff;
      font-size:15px;
      cursor:pointer;
    }
    button:disabled {
      opacity:.6;
      cursor:not-allowed;
    }
    .error {
      margin-top:12px;
      padding:10px;
      border-radius:10px;
      border:1px solid #553333;
      background:#2a1414;
      color:#ffb3b3;
      font-size:13px;
      display:none;
    }
  </style>
</head>

<body>

<div class="card">
  <h1>WorkLogic Pro</h1>
  <div class="muted">Sign in to continue</div>

  <label>Email</label>
  <input id="email" type="email" placeholder="you@company.com" />

  <label>Password</label>
  <input id="password" type="password" placeholder="••••••••" />

  <button id="login">Sign In</button>

  <div id="error" class="error"></div>
</div>

<script>
const PROJECT_REF = "kxqkwpkmtgvmthpafoqx";
const API_BASE = `https://${PROJECT_REF}.supabase.co`;
const ANON_KEY = document
  .querySelector('meta[name="supabase-anon-key"]')
  .content;

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("login");
const errorBox = document.getElementById("error");

function showError(msg) {
  errorBox.textContent = msg;
  errorBox.style.display = "block";
}

async function login() {
  errorBox.style.display = "none";
  loginBtn.disabled = true;

  try {
    const res = await fetch(
      `${API_BASE}/auth/v1/token?grant_type=password`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          apikey: ANON_KEY
        },
        body: JSON.stringify({
          email: emailInput.value,
          password: passwordInput.value
        })
      }
    );

    const data = await res.json();

    if (!res.ok) {
      throw new Error(
        data.error_description ||
        data.error ||
        "Login failed"
      );
    }

    if (!data.access_token) {
      throw new Error("No access token returned");
    }

    // ✅ Store JWT
    localStorage.setItem("sb_access_token", data.access_token);

    // Redirect to dashboard
    window.location.href = "dashboard.html";

  } catch (err) {
    showError(err.message);
  } finally {
    loginBtn.disabled = false;
  }
}

loginBtn.addEventListener("click", login);
passwordInput.addEventListener("keydown", e => {
  if (e.key === "Enter") login();
});

// Auto-redirect if already logged in
if (localStorage.getItem("sb_access_token")) {
  window.location.href = "dashboard.html";
}
</script>

</body>
</html>
