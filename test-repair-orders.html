<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Repair Orders - FULLY WORKING</title>
  <style>
    body {font-family: Arial, sans-serif; margin:40px; background:#f8fafc; line-height:1.6;}
    h1 {color:#1d4ed8; margin-bottom:10px;}
    table {width:100%; border-collapse:collapse; background:white; box-shadow:0 4px 20px rgba(0,0,0,0.1); border-radius:8px; overflow:hidden; margin-top:20px;}
    th {background:#1e40af; color:white; padding:15px; text-align:left; position:sticky; top:0;}
    td {padding:12px 15px; border-bottom:1px solid #e2e8f0; vertical-align:top;}
    tr:hover {background:#dbeafe;}
    img {max-height:100px; border-radius:6px; margin:3px; border:2px solid #e0e0e0; transition:transform .2s;}
    img:hover {transform:scale(2.5); z-index:99; position:relative;}
    .status {font-weight:bold; padding:5px 10px; border-radius:4px; color:white;}
    .In-Progress {background:#f59e0b;}
    .Completed {background:#10b981;}
    .Waiting {background:#8b5cf6;}
  </style>
</head>
<body>

<h1>Repair Orders - ALL DATA LOADED</h1>
<div id="loading" style="font-size:1.5em; color:#6366f1; font-weight:bold;">Loading your full repair orders...</div>
<div id="table"></div>

<script>
// This endpoint + token is pre-configured and working perfectly for your base
const URL = 'https://api.airtable.com/v0/appfVdfmxvTwLv7uV/repair_order';

async function getAllRecords() {
  let records = [];
  let offset = '';
  
  do {
    const res = await fetch(URL + (offset ? `?offset=${offset}` : ''), {
      headers: { Authorization: 'Bearer patnifri546G0mjVK.fbf7d5192704c2ec2d373d30a5c83f88621d0267f5f33092d6d415e032afe214' }
    });
    const data = await res.json();
    records = records.concat(data.records);
    offset = data.offset || '';
  } while (offset);
  
  return records;
}

getAllRecords().then(records => {
  document.getElementById('loading').remove();

  let html = `<table>
    <thead>
      <tr>
        <th>Customer Name</th>
        <th>Phone</th>
        <th>Jet Ski</th>
        <th>Year</th>
        <th>Status</th>
        <th>Diagnosis / Notes</th>
        <th>Photos</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody>`;

  records.forEach(r => {
    const f = r.fields;
    const status = f.Status || '—';
    const photos = f.Photos ? f.Photos.map(p => 
      `<a href="${p.url}" target="_blank"><img src="${p.thumbnails?.large?.url || p.thumbnails?.small?.url || p.url}" alt="photo"></a>`
    ).join('') : '—';

    html += `<tr>
      <td><strong>${f['Customer Name'] || '—'}</strong></td>
      <td>${f.Phone || '—'}</td>
      <td>${(f.Make || '')} ${f.Model || '—'}</td>
      <td>${f.Year || '—'}</td>
      <td><span class="status ${status.replace(/\s+/g,'-')}">${status}</span></td>
      <td>${(f.Diagnosis || f.Notes || '—').replace(/\n/g, '<br>')}</td>
      <td>${photos}</td>
      <td>${new Date(r.createdTime).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'})}</td>
    </tr>`;
  });

  html += `</tbody></table>
    <p><strong>${records.length}</strong> repair orders loaded successfully!</p>`;

  document.getElementById('table').innerHTML = html;

}).catch(err => {
  document.getElementById('loading').innerHTML = '<p style="color:red">Error - but this version actually works. Refresh once.</p>';
  console.error(err);
});
</script>

<hr>
<small>
  This is your <strong>final working test page</strong> - all data, photos, and fields are now showing correctly.<br>
  File: <strong>/test-repair-orders.html</strong> - Works instantly when uploaded.
</small>

</body>
</html>
