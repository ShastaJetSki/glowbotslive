<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4cWt3cGttdGd2bXRocGFmb3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NDI1OTQsImV4cCI6MjA4MTAxODU5NH0.GT9pOMqrUr1EvVLh1magyoB4I_LprziRaybKsGHhrX4" />
  <link rel="stylesheet" href="theme-system.css">
  <style>
    /* ===== INLINE THEME DEFINITIONS (backup) ===== */
    :root {
      --bg-primary: #0b0f14; --bg-secondary: #0f1621; --bg-card: #1a2535; --bg-hover: #223044;
      --border-default: #223044; --text-primary: #e8eef6; --text-secondary: #9fb0c3;
      --accent-primary: #3b82f6; --accent-light: #60a5fa;
    }
    [data-theme="dark-blue"] {
      --bg-primary: #0b0f14; --bg-secondary: #0f1621; --bg-card: #1a2535; --bg-hover: #223044;
      --border-default: #223044; --text-primary: #e8eef6; --text-secondary: #9fb0c3;
      --accent-primary: #3b82f6; --accent-light: #60a5fa;
    }
    [data-theme="grey"] {
      --bg-primary: #111111; --bg-secondary: #1a1a1a; --bg-card: #242424; --bg-hover: #2e2e2e;
      --border-default: #333333; --text-primary: #e5e5e5; --text-secondary: #a3a3a3;
      --accent-primary: #525252; --accent-light: #737373;
    }
    [data-theme="slate"] {
      --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-card: #273549; --bg-hover: #334155;
      --border-default: #334155; --text-primary: #f1f5f9; --text-secondary: #94a3b8;
      --accent-primary: #6366f1; --accent-light: #818cf8;
    }
    [data-theme="charcoal"] {
      --bg-primary: #121214; --bg-secondary: #18181b; --bg-card: #27272a; --bg-hover: #3f3f46;
      --border-default: #3f3f46; --text-primary: #fafafa; --text-secondary: #a1a1aa;
      --accent-primary: #a1a1aa; --accent-light: #d4d4d8;
    }
    [data-theme="midnight"] {
      --bg-primary: #09090b; --bg-secondary: #0f0f12; --bg-card: #18181d; --bg-hover: #222228;
      --border-default: #27272f; --text-primary: #eeeef0; --text-secondary: #9898a4;
      --accent-primary: #8b5cf6; --accent-light: #a78bfa;
    }
    [data-theme="navy"] {
      --bg-primary: #0a0e1a; --bg-secondary: #0f1526; --bg-card: #182035; --bg-hover: #1f2a45;
      --border-default: #253352; --text-primary: #e8ecf4; --text-secondary: #9aa5bd;
      --accent-primary: #4a7cc9; --accent-light: #6b9ae0;
    }
    [data-theme="graphite"] {
      --bg-primary: #0d0d0d; --bg-secondary: #141414; --bg-card: #1f1f1f; --bg-hover: #292929;
      --border-default: #2e2e2e; --text-primary: #e8e8e8; --text-secondary: #999999;
      --accent-primary: #4a9eff; --accent-light: #6bb3ff;
    }
    [data-theme="ocean"] {
      --bg-primary: #0a1214; --bg-secondary: #0e181c; --bg-card: #152228; --bg-hover: #1c2d35;
      --border-default: #243842; --text-primary: #e5f0f3; --text-secondary: #8faab5;
      --accent-primary: #14b8a6; --accent-light: #2dd4bf;
    }
    [data-theme="forest"] {
      --bg-primary: #0a100c; --bg-secondary: #0f1812; --bg-card: #16221a; --bg-hover: #1e2e24;
      --border-default: #263830; --text-primary: #e5f0e8; --text-secondary: #8faa96;
      --accent-primary: #22c55e; --accent-light: #4ade80;
    }
    [data-theme="obsidian"] {
      --bg-primary: #050505; --bg-secondary: #0a0a0a; --bg-card: #141414; --bg-hover: #1c1c1c;
      --border-default: #252525; --text-primary: #e0e0e0; --text-secondary: #888888;
      --accent-primary: #0ea5e9; --accent-light: #38bdf8;
    }
    [data-theme="steel"] {
      --bg-primary: #0c0f13; --bg-secondary: #12161c; --bg-card: #1a2028; --bg-hover: #242c38;
      --border-default: #2c3644; --text-primary: #e4e8ed; --text-secondary: #8b95a5;
      --accent-primary: #64748b; --accent-light: #94a3b8;
    }
    [data-theme="espresso"] {
      --bg-primary: #0f0c0a; --bg-secondary: #161210; --bg-card: #211c18; --bg-hover: #2c2520;
      --border-default: #382f28; --text-primary: #f0ebe5; --text-secondary: #a89e94;
      --accent-primary: #a78b6e; --accent-light: #c4a88a;
    }
    [data-theme="onyx"] {
      --bg-primary: #000000; --bg-secondary: #080808; --bg-card: #121212; --bg-hover: #1a1a1a;
      --border-default: #222222; --text-primary: #f5f5f5; --text-secondary: #8c8c8c;
      --accent-primary: #06b6d4; --accent-light: #22d3ee;
    }
    /* ===== END THEME DEFINITIONS ===== */
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { background: #0b0f14; background-color: #0b0f14; }
    body { font-family: system-ui; background: var(--bg-primary, #0b0f14); color: var(--text-primary, #e8eef6); color: #e8eef6; padding-bottom: 120px; }
    
    h1 { margin: 0; font-size: 32px; font-weight: 600; }
    h2 { margin: 0; font-size: 18px; font-weight: 700; }

    button {
      padding: 8px 14px; border-radius: 8px;
      border: 1px solid var(--border-default, #223044);
      background: var(--bg-card, #1a2535);
      color: var(--text-primary, #e8eef6);
      cursor: pointer; white-space: nowrap; font-size: 13px;
    }
    button:hover { background: var(--bg-hover, #223044); }

    .card {
      background: var(--bg-secondary, #0f1621);
      border: 1px solid var(--border-default, #223044);
      border-radius: 12px; padding: 20px; margin-bottom: 16px;
    }

    .setting-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid var(--border-default, #223044);
    }
    .setting-row:last-child { border-bottom: none; }

    .setting-label { font-size: 14px; font-weight: 500; }
    .setting-description { font-size: 12px; color: var(--text-secondary, #9fb0c3); margin-top: 4px; }

    input[type="text"], input[type="number"], input[type="email"], input[type="tel"], input[type="file"], input[type="date"], select {
      padding: 8px 12px; border-radius: 8px;
      border: 1px solid var(--border-default, #223044);
      background: var(--bg-card, #1a2535);
      color: var(--text-primary, #e8eef6); width: 200px; font-size: 14px;
    }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
    input[type="file"] { padding: 6px 12px; font-size: 12px; }
    input:focus, select:focus { outline: none; border-color: var(--accent-primary, #3b82f6); }

    .save-btn {
      background: var(--accent-primary, #3b82f6);
      border-color: var(--accent-primary, #3b82f6);
      margin-top: 16px; color: white; padding: 10px 20px;
    }
    .save-btn:hover { background: var(--accent-light, #60a5fa); }

    .success { color: #4ade80; font-size: 12px; margin-top: 8px; }
    .error { color: #ef4444; font-size: 12px; margin-top: 8px; }

    .employee-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px; margin-top: 16px;
    }

    .employee-card {
      background: var(--bg-primary, #0b0f14);
      border: 1px solid var(--border-default, #223044);
      border-radius: 12px; padding: 16px; text-align: center;
    }

    .employee-avatar-preview {
      width: 100px; height: 100px; border-radius: 12px;
      border: 2px solid var(--border-default, #223044);
      background: var(--bg-secondary, #0f1621);
      margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 32px; color: var(--text-primary, #e8eef6);
      overflow: hidden; background-size: cover; background-position: center;
      cursor: pointer; transition: all 0.2s ease; position: relative;
    }
    .employee-avatar-preview:hover {
      border-color: var(--accent-primary, #3b82f6);
      transform: scale(1.05); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .employee-name { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
    .employee-role { font-size: 11px; color: var(--text-secondary, #9fb0c3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }

    .employee-stats { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-default, #223044); text-align: left; }
    .stat-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 11px; }
    .stat-label { color: var(--text-secondary, #9fb0c3); }
    .stat-value { color: var(--text-primary, #e8eef6); font-weight: 600; }

    .accordion-header {
      display: flex; justify-content: space-between; align-items: center;
      cursor: pointer; padding: 0; background: transparent;
      border: none; width: 100%; text-align: left;
    }
    .accordion-icon { font-size: 20px; color: var(--text-secondary, #9fb0c3); transition: transform 0.2s ease; }
    .accordion-header.active .accordion-icon { transform: rotate(180deg); }
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
    .accordion-content.active { max-height: 5000px; }
    .accordion-inner { padding-top: 16px; }

    .icon-nav-bar {
      display: flex; gap: 6px; margin-top: 12px; padding: 6px;
      background: rgba(15, 22, 33, 0.5); border-radius: 10px;
      border: 1px solid var(--border-default, #223044);
    }
    .icon-nav-btn {
      flex: 1; height: 36px; display: flex; align-items: center; justify-content: center;
      border-radius: 6px; border: 1px solid transparent;
      cursor: pointer; transition: all 0.15s ease; background: transparent; padding: 0;
    }
    .icon-nav-primary { color: #6b7280; }
    .icon-nav-primary:hover { background: rgba(59, 130, 246, 0.1); border-color: var(--accent-primary, #3b82f6); color: var(--accent-primary, #3b82f6); }
    .icon-nav-danger { color: #6b7280; }
    .icon-nav-danger:hover { background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #ef4444; }
    .icon-nav-btn:active { transform: scale(0.95); }
    input[type="file"].hidden { display: none; }

    /* Desktop Header */
    .desktop-header {
      position: sticky; top: 0; z-index: 100;
      background: var(--bg-primary, #0b0f14);
      border-bottom: 1px solid var(--border-default, #223044);
    }

    /* Mobile Top Header */
    .mobile-top-header {
      display: none; position: sticky; top: 0; z-index: 100;
      background: var(--bg-secondary, #0f1621);
      border-bottom: 1px solid var(--border-default, #223044);
    }
    .mobile-header-bar {
      display: flex; justify-content: space-between; align-items: center; padding: 12px;
    }
    .mobile-menu-toggle {
      background: transparent; border: 1px solid transparent;
      border-radius: 6px; color: var(--text-secondary, #6b7280); font-size: 20px;
      padding: 0; width: 36px; height: 36px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    .mobile-header-center { flex: 1; margin-left: 12px; }
    .mobile-header-title { font-size: 18px; font-weight: 600; }
    .mobile-header-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
    .mobile-header-content.expanded { max-height: 200px; }
    .mobile-header-actions {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 8px; padding: 8px 12px 12px;
      background: var(--bg-primary, #0b0f14);
      border-top: 1px solid var(--border-default, #223044);
    }
    .mobile-header-actions button {
      padding: 10px; font-size: 13px;
      background: var(--bg-card, #1a2535);
      border: 1px solid var(--accent-primary, #3b82f6);
      color: var(--text-primary, #e8eef6); border-radius: 8px;
    }

    /* ========== MOBILE BOTTOM NAV - EXACT MATCH FROM BUSINESS DASHBOARD ========== */
    .mobile-bottom-nav {
      display: none; position: fixed;
      bottom: 0; left: 0; right: 0;
      background: var(--bg-secondary, #0f1621); padding: 8px; z-index: 100;
    }
    .mobile-nav-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 6px; margin-bottom: 6px;
    }
    .mobile-nav-secondary {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;
    }
    .mobile-nav-btn {
      padding: 10px 8px; border-radius: 8px;
      border: 1px solid var(--border-default, #223044); 
      background: var(--bg-card, #1a2535);
      color: var(--text-secondary, #9fb0c3); font-size: 12px; font-weight: 600;
      cursor: pointer; text-decoration: none;
      display: flex; align-items: center; justify-content: center;
      min-height: 44px;
    }
    .mobile-nav-grid .mobile-nav-btn { 
      background: var(--bg-card, #1a2535);
      border-color: var(--border-default, #223044);
    }
    .mobile-nav-btn.active { 
      background: var(--bg-hover, #223044); 
      border-color: var(--accent-primary, #3b82f6); 
      color: var(--accent-light, #60a5fa);
    }
    /* ========== END MOBILE BOTTOM NAV ========== */

    /* Theme Cards */
    .theme-card {
      background: var(--bg-secondary, #0f1621);
      border: 2px solid var(--border-default, #223044);
      border-radius: 10px; padding: 12px; cursor: pointer;
      text-align: center; transition: all 0.2s;
    }
    .theme-card:hover { border-color: var(--text-secondary, #9fb0c3); }
    .theme-card.active { border-color: var(--accent-primary, #3b82f6); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }

    @media (max-width: 768px) {
      .desktop-header { display: none !important; }
      .mobile-top-header { display: block; }
      .mobile-bottom-nav { display: block !important; }
      h1 { font-size: 24px !important; }
      .setting-row { flex-direction: column; align-items: flex-start; gap: 8px; }
      input[type="text"], input[type="number"], input[type="email"], input[type="tel"], input[type="file"], select { width: 100%; }
      .employee-grid { grid-template-columns: 1fr; }
    }
    
    @media (min-width: 769px) {
      .mobile-top-header { display: none !important; }
      .mobile-bottom-nav { display: none !important; }
    }
  </style>
</head>

<body>
  <!-- Mobile Top Header -->
  <div class="mobile-top-header">
    <div class="mobile-header-bar">
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu(this)">
        <span>☰</span>
      </button>
      <div class="mobile-header-center">
        <div class="mobile-header-title">Settings</div>
      </div>
      <a onclick="logout()" style="color:var(--text-secondary); cursor:pointer; font-size:14px; text-decoration:none;">Logout</a>
    </div>
    <div class="mobile-header-content" id="mobileHeaderContent">
      <div class="mobile-header-actions">
        <button onclick="location.href='dashboard-service.html'">Service</button>
        <button onclick="location.href='dashboard-parts.html'">Parts</button>
        <button onclick="location.href='dashboard-sales.html'">Sales</button>
      </div>
    </div>
  </div>

  <!-- Desktop Header -->
  <div class="desktop-header">
    <div style="padding:16px 24px 8px; display:flex; justify-content:space-between; align-items:center;">
      <h1>Settings</h1>
      <a onclick="logout()" style="color:var(--text-secondary); cursor:pointer; font-size:14px; text-decoration:none;">Logout</a>
    </div>
    <div style="padding:0 24px 12px;">
      <nav style="display:flex; gap:24px; overflow-x:auto;">
        <a href="dashboard-business.html" style="padding:12px 0; color:var(--text-secondary); text-decoration:none; font-size:14px; white-space:nowrap; border-bottom:2px solid transparent;">Dashboard</a>
        <a href="dashboard-customer-search.html" style="padding:12px 0; color:var(--text-secondary); text-decoration:none; font-size:14px; white-space:nowrap; border-bottom:2px solid transparent;">Customers</a>
        <a href="dashboard-vehicle-search.html" style="padding:12px 0; color:var(--text-secondary); text-decoration:none; font-size:14px; white-space:nowrap; border-bottom:2px solid transparent;">Vehicles</a>
        <a href="dashboard-settings.html" style="padding:12px 0; color:var(--accent-primary); text-decoration:none; font-size:14px; white-space:nowrap; border-bottom:2px solid var(--accent-primary);">Settings</a>
      </nav>
    </div>
    <div style="padding:0 24px 12px; border-top:1px solid var(--border-default); padding-top:12px;">
      <div style="display:flex; gap:12px; justify-content:flex-end;">
        <button onclick="location.href='dashboard-service.html'">Service</button>
        <button onclick="location.href='dashboard-parts.html'">Parts</button>
        <button onclick="location.href='dashboard-sales.html'">Sales</button>
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Nav - EXACT COPY FROM BUSINESS DASHBOARD -->
  <div class="mobile-bottom-nav">
    <div class="mobile-nav-grid">
      <a href="dashboard-business.html" class="mobile-nav-btn">Dashboard</a>
      <a href="dashboard-customer-search.html" class="mobile-nav-btn">Customers</a>
      <a href="dashboard-vehicle-search.html" class="mobile-nav-btn">Vehicles</a>
      <a href="dashboard-settings.html" class="mobile-nav-btn active">Settings</a>
    </div>
    <div class="mobile-nav-secondary">
      <a href="dashboard-service.html" class="mobile-nav-btn">Service</a>
      <a href="dashboard-parts.html" class="mobile-nav-btn">Parts</a>
      <a href="dashboard-sales.html" class="mobile-nav-btn">Sales</a>
    </div>
  </div>

  <!-- Main Content -->
  <div style="padding:24px;">

  <!-- BUSINESS DEPARTMENT -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Business</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        
        <!-- Company Information -->
        <h3 style="font-size:15px; margin-bottom:12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Company Information</h3>
        
        <div class="setting-row">
          <div><div class="setting-label">Business Name</div><div class="setting-description">Your company or shop name</div></div>
          <input type="text" id="businessName" placeholder="Business Name" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Contact Name</div><div class="setting-description">Primary contact person name</div></div>
          <input type="text" id="contactName" placeholder="Contact Name" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Contact Email</div><div class="setting-description">Primary contact email</div></div>
          <input type="email" id="contactEmail" placeholder="email@example.com" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Contact Phone</div><div class="setting-description">Auto-formats to XXX-XXX-XXXX</div></div>
          <input type="tel" id="contactPhone" placeholder="555-555-5555" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Business Address</div><div class="setting-description">Street address</div></div>
          <input type="text" id="businessAddress" placeholder="123 Main St" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">City, State ZIP</div></div>
          <input type="text" id="businessCityStateZip" placeholder="Redding, CA 96001" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Business Hours</div><div class="setting-description">Displayed to customers</div></div>
          <input type="text" id="businessHours" placeholder="Mon–Fri 8am–5pm" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Shop Phone</div><div class="setting-description">Public phone (auto-formats)</div></div>
          <input type="tel" id="shopPhone" placeholder="530-555-1234" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Website</div></div>
          <input type="text" id="websiteUrl" placeholder="https://yourshop.com" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Business License #</div></div>
          <input type="text" id="licenseNumber" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Tax ID / EIN</div></div>
          <input type="text" id="taxId" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Local Sales Tax</div><div class="setting-description">Sales tax percentage (%)</div></div>
          <input type="number" id="localTax" min="0" max="100" step="0.01" placeholder="8.5" />
        </div>

        <!-- Employee Management -->
        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Employee Management</h3>
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <div class="setting-description">Manage employee photos, compensation, and profile information.</div>
          <button onclick="location.href='employee-edit.html?new=true'">+ Add Employee</button>
        </div>
        <div id="employeeAvatars" class="employee-grid">
          <div style="text-align:center; color:var(--text-secondary); padding:20px;">Loading employees...</div>
        </div>
        <div id="avatarMessage"></div>

        <!-- Payroll Settings -->
        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Payroll Settings</h3>

        <div class="setting-row">
          <div><div class="setting-label">Pay Period Type</div><div class="setting-description">How often employees are paid</div></div>
          <select id="payPeriodType" onchange="updatePayPeriodStartOptions()">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="biweekly">Bi-Weekly (Every 2 weeks)</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div class="setting-row" id="payPeriodStartRow">
          <div><div class="setting-label">Pay Period Start</div><div class="setting-description" id="payPeriodStartDesc">Week starts on...</div></div>
          <div style="display:flex; gap:8px; align-items:center;">
            <select id="payPeriodStart">
              <option value="0">Sunday</option>
              <option value="1">Monday</option>
              <option value="2">Tuesday</option>
              <option value="3">Wednesday</option>
              <option value="4">Thursday</option>
              <option value="5">Friday</option>
              <option value="6">Saturday</option>
            </select>
            <input type="date" id="payPeriodStartDate" style="width:160px; display:none;" />
          </div>
        </div>

        <!-- Invoicing -->
        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Invoicing & Payments</h3>

        <div class="setting-row">
          <div><div class="setting-label">Invoice Prefix</div></div>
          <input type="text" id="invoicePrefix" placeholder="INV-" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Next Invoice Number</div></div>
          <input type="number" id="nextInvoiceNumber" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Payment Terms</div></div>
          <input type="text" id="paymentTerms" placeholder="Due on receipt / Net 30" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Invoice Footer Text</div></div>
          <input type="text" id="invoiceFooter" placeholder="Thank you for your business" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Payment Instructions</div></div>
          <input type="text" id="paymentInstructions" placeholder="Pay online or in person" />
        </div>

        <!-- Customer Notifications -->
        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Customer Notifications</h3>

        <div class="setting-row">
          <div><div class="setting-label">Customer Portal</div></div>
          <select id="customerPortalEnabled"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Auto-Send Estimates</div></div>
          <select id="autoSendEstimates"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Auto-Send Invoices</div></div>
          <select id="autoSendInvoices"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">SMS Notifications</div></div>
          <select id="smsNotificationsEnabled"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Email Notifications</div></div>
          <select id="emailNotificationsEnabled"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Reminder Timing</div></div>
          <select id="reminderTiming">
            <option value="24">24 hours before</option>
            <option value="12">12 hours before</option>
            <option value="2">2 hours before</option>
          </select>
        </div>

        <!-- Account Info -->
        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Account Information</h3>

        <div class="setting-row">
          <div><div class="setting-label">Logged in as</div><div class="setting-description" id="userEmail">Loading...</div></div>
        </div>

        <button class="save-btn" onclick="saveAllSettings()">Save Business Settings</button>
        <div id="saveMessage"></div>
      </div>
    </div>
  </div>

  <!-- SERVICE DEPARTMENT -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Service</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        <h3 style="font-size:15px; margin-bottom:12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Pricing & Rates</h3>

        <div class="setting-row">
          <div><div class="setting-label">Labor Rate</div><div class="setting-description">Hourly rate ($/hr)</div></div>
          <input type="number" id="laborRate" min="0" step="1" placeholder="125" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Shop Supply Fee ($)</div></div>
          <input type="number" id="shopSupplyFee" step="0.01" placeholder="12.00" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Environmental Fee ($)</div></div>
          <input type="number" id="environmentalFee" step="0.01" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Hazmat Fee ($)</div></div>
          <input type="number" id="hazmatFee" step="0.01" />
        </div>

        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Work Order Defaults</h3>

        <div class="setting-row">
          <div><div class="setting-label">Default Work Order Status</div></div>
          <select id="defaultWorkOrderStatus">
            <option value="draft">Draft</option>
            <option value="scheduled">Scheduled</option>
            <option value="diagnosis_required">Diagnosis Required</option>
            <option value="awaiting_parts">Awaiting Parts</option>
            <option value="customer_approval">Customer Approval</option>
          </select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Default Priority</div></div>
          <select id="defaultWorkOrderPriority">
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Require Customer Approval</div></div>
          <select id="requireCustomerApproval"><option value="true">Yes</option><option value="false">No</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Auto-Assign Technician</div></div>
          <select id="autoAssignTechnician"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Warranty Period (Days)</div></div>
          <input type="number" id="defaultWarrantyDays" min="0" placeholder="90" />
        </div>

        <h3 style="font-size:15px; margin:24px 0 12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Labor Codes Library</h3>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <div class="setting-description">Create labor codes for common jobs with preset descriptions, hours, and rates.</div>
          <button onclick="showAddLaborCodeForm()">+ Add Labor Code</button>
        </div>

        <div id="laborCodeForm" style="display:none; background:var(--bg-primary); border:1px solid var(--border-default); border-radius:8px; padding:16px; margin-bottom:16px;">
          <h3 style="margin:0 0 12px; font-size:16px;" id="laborCodeFormTitle">Add Labor Code</h3>
          <input type="hidden" id="editingLaborCodeId" />
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px;">
            <div>
              <label style="font-size:12px; color:var(--text-secondary); display:block; margin-bottom:4px;">Code*</label>
              <input type="text" id="newLaborCode" placeholder="BRKPAD-F" style="width:100%;" />
            </div>
            <div>
              <label style="font-size:12px; color:var(--text-secondary); display:block; margin-bottom:4px;">Category</label>
              <input type="text" id="newLaborCategory" placeholder="Brakes" style="width:100%;" />
            </div>
            <div>
              <label style="font-size:12px; color:var(--text-secondary); display:block; margin-bottom:4px;">Standard Hours</label>
              <input type="number" id="newLaborHours" step="0.1" min="0" placeholder="1.5" style="width:100%;" />
            </div>
            <div>
              <label style="font-size:12px; color:var(--text-secondary); display:block; margin-bottom:4px;">Rate ($/hr)</label>
              <input type="number" id="newLaborRate" step="1" min="0" placeholder="125" style="width:100%;" />
            </div>
          </div>
          <div style="margin-top:12px;">
            <label style="font-size:12px; color:var(--text-secondary); display:block; margin-bottom:4px;">Description*</label>
            <input type="text" id="newLaborDescription" placeholder="Replace Front Brake Pads" style="width:100%;" />
          </div>
          <div style="display:flex; gap:8px; margin-top:12px;">
            <button class="save-btn" onclick="saveLaborCode()">Save Labor Code</button>
            <button onclick="cancelLaborCodeForm()">Cancel</button>
          </div>
          <div id="laborCodeFormMessage"></div>
        </div>

        <div style="overflow-x:auto;">
          <table style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="border-bottom:1px solid #223044;">
                <th style="text-align:left; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">CODE</th>
                <th style="text-align:left; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">DESCRIPTION</th>
                <th style="text-align:left; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">CATEGORY</th>
                <th style="text-align:right; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">HOURS</th>
                <th style="text-align:right; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">RATE</th>
                <th style="text-align:right; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500;">TOTAL</th>
                <th style="text-align:center; padding:8px; font-size:12px; color:var(--text-secondary); font-weight:500; width:100px;">ACTIONS</th>
              </tr>
            </thead>
            <tbody id="laborCodesTable">
              <tr><td colspan="7" style="text-align:center; padding:20px; color:var(--text-secondary);">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- PARTS DEPARTMENT -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Parts</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        <h3 style="font-size:15px; margin-bottom:12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Parts Pricing & Inventory</h3>

        <div class="setting-row">
          <div><div class="setting-label">Parts Markup (%)</div><div class="setting-description">Default markup percentage</div></div>
          <input type="number" id="partsMarkup" step="0.01" placeholder="30" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Low Stock Threshold</div><div class="setting-description">Alert when quantity below this</div></div>
          <input type="number" id="lowStockThreshold" min="0" placeholder="5" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Auto-Order Parts</div><div class="setting-description">Automatically create PO when low</div></div>
          <select id="autoOrderParts"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Default Vendor</div></div>
          <input type="text" id="defaultVendor" placeholder="Primary Parts Supplier" />
        </div>
      </div>
    </div>
  </div>

  <!-- SALES DEPARTMENT -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Sales</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        <h3 style="font-size:15px; margin-bottom:12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Sales Settings</h3>

        <div class="setting-row">
          <div><div class="setting-label">Commission Rate (%)</div><div class="setting-description">Default sales commission</div></div>
          <input type="number" id="commissionRate" step="0.01" placeholder="5" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Max Discount (%)</div><div class="setting-description">Maximum allowed discount</div></div>
          <input type="number" id="maxDiscount" step="0.01" placeholder="15" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Quote Validity (Days)</div><div class="setting-description">How long quotes remain valid</div></div>
          <input type="number" id="quoteValidDays" min="1" placeholder="30" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Auto-Follow-Up</div><div class="setting-description">Send follow-up reminders</div></div>
          <select id="autoFollowUp"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>
      </div>
    </div>
  </div>

  <!-- RENTALS DEPARTMENT -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Rentals</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        <h3 style="font-size:15px; margin-bottom:12px; color:var(--accent-light); border-bottom:1px solid var(--border-default); padding-bottom:8px;">Rental Settings</h3>

        <div class="setting-row">
          <div><div class="setting-label">Enable Rentals</div><div class="setting-description">Offer vehicle/equipment rentals</div></div>
          <select id="rentalsEnabled"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Daily Rate</div><div class="setting-description">Base daily rental rate</div></div>
          <input type="number" id="rentalDailyRate" step="1" placeholder="50" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Security Deposit</div><div class="setting-description">Default deposit amount</div></div>
          <input type="number" id="rentalDeposit" step="1" placeholder="200" />
        </div>

        <div class="setting-row">
          <div><div class="setting-label">Late Fee (Per Day)</div></div>
          <input type="number" id="rentalLateFee" step="1" placeholder="25" />
        </div>
      </div>
    </div>
  </div>

  <!-- APPEARANCE & THEMES -->
  <div class="card">
    <button class="accordion-header" onclick="toggleAccordion(this)">
      <h2>Appearance & Themes</h2>
      <span class="accordion-icon">▼</span>
    </button>
    <div class="accordion-content">
      <div class="accordion-inner">
        <div class="setting-description" style="margin-bottom:16px;">
          Choose your preferred color scheme. Changes apply instantly across all pages.
        </div>
        
        <h3 style="font-size:14px; margin:20px 0 12px; color:var(--accent-light);">Recommended</h3>
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(130px, 1fr)); gap:10px;">
          
          <div class="theme-card" data-theme="dark-blue" onclick="setTheme('dark-blue')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0b0f14;">
              <div style="flex:1; border-radius:3px; background:#1a2535;"></div>
              <div style="flex:1; border-radius:3px; background:#3b82f6;"></div>
              <div style="flex:1; border-radius:3px; background:#60a5fa;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Dark Blue</div>
            <div style="font-size:10px; color:var(--text-secondary);">Default</div>
          </div>
          
          <div class="theme-card" data-theme="slate" onclick="setTheme('slate')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0f172a;">
              <div style="flex:1; border-radius:3px; background:#273549;"></div>
              <div style="flex:1; border-radius:3px; background:#6366f1;"></div>
              <div style="flex:1; border-radius:3px; background:#818cf8;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Slate</div>
            <div style="font-size:10px; color:var(--text-secondary);">Blue-grey</div>
          </div>
          
          <div class="theme-card" data-theme="graphite" onclick="setTheme('graphite')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0d0d0d;">
              <div style="flex:1; border-radius:3px; background:#1f1f1f;"></div>
              <div style="flex:1; border-radius:3px; background:#4a9eff;"></div>
              <div style="flex:1; border-radius:3px; background:#6bb3ff;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Graphite</div>
            <div style="font-size:10px; color:var(--text-secondary);">Pure neutral</div>
          </div>
          
          <div class="theme-card" data-theme="obsidian" onclick="setTheme('obsidian')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#050505;">
              <div style="flex:1; border-radius:3px; background:#141414;"></div>
              <div style="flex:1; border-radius:3px; background:#0ea5e9;"></div>
              <div style="flex:1; border-radius:3px; background:#38bdf8;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Obsidian</div>
            <div style="font-size:10px; color:var(--text-secondary);">Near black</div>
          </div>
          
          <div class="theme-card" data-theme="midnight" onclick="setTheme('midnight')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#09090b;">
              <div style="flex:1; border-radius:3px; background:#18181d;"></div>
              <div style="flex:1; border-radius:3px; background:#8b5cf6;"></div>
              <div style="flex:1; border-radius:3px; background:#a78bfa;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Midnight</div>
            <div style="font-size:10px; color:var(--text-secondary);">Purple</div>
          </div>
          
          <div class="theme-card" data-theme="grey" onclick="setTheme('grey')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#111111;">
              <div style="flex:1; border-radius:3px; background:#242424;"></div>
              <div style="flex:1; border-radius:3px; background:#525252;"></div>
              <div style="flex:1; border-radius:3px; background:#737373;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Grey</div>
            <div style="font-size:10px; color:var(--text-secondary);">Monochrome</div>
          </div>
          
        </div>
        
        <h3 style="font-size:14px; margin:24px 0 12px; color:var(--text-secondary);">More Options</h3>
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(130px, 1fr)); gap:10px;">
          
          <div class="theme-card" data-theme="charcoal" onclick="setTheme('charcoal')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#121214;">
              <div style="flex:1; border-radius:3px; background:#27272a;"></div>
              <div style="flex:1; border-radius:3px; background:#a1a1aa;"></div>
              <div style="flex:1; border-radius:3px; background:#d4d4d8;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Charcoal</div>
            <div style="font-size:10px; color:var(--text-secondary);">Warm neutral</div>
          </div>
          
          <div class="theme-card" data-theme="navy" onclick="setTheme('navy')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0a0e1a;">
              <div style="flex:1; border-radius:3px; background:#182035;"></div>
              <div style="flex:1; border-radius:3px; background:#4a7cc9;"></div>
              <div style="flex:1; border-radius:3px; background:#6b9ae0;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Navy</div>
            <div style="font-size:10px; color:var(--text-secondary);">Corporate</div>
          </div>
          
          <div class="theme-card" data-theme="ocean" onclick="setTheme('ocean')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0a1214;">
              <div style="flex:1; border-radius:3px; background:#152228;"></div>
              <div style="flex:1; border-radius:3px; background:#14b8a6;"></div>
              <div style="flex:1; border-radius:3px; background:#2dd4bf;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Ocean</div>
            <div style="font-size:10px; color:var(--text-secondary);">Teal</div>
          </div>
          
          <div class="theme-card" data-theme="forest" onclick="setTheme('forest')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0a100c;">
              <div style="flex:1; border-radius:3px; background:#16221a;"></div>
              <div style="flex:1; border-radius:3px; background:#22c55e;"></div>
              <div style="flex:1; border-radius:3px; background:#4ade80;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Forest</div>
            <div style="font-size:10px; color:var(--text-secondary);">Green</div>
          </div>
          
          <div class="theme-card" data-theme="steel" onclick="setTheme('steel')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0c0f13;">
              <div style="flex:1; border-radius:3px; background:#1a2028;"></div>
              <div style="flex:1; border-radius:3px; background:#64748b;"></div>
              <div style="flex:1; border-radius:3px; background:#94a3b8;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Steel</div>
            <div style="font-size:10px; color:var(--text-secondary);">Industrial</div>
          </div>
          
          <div class="theme-card" data-theme="espresso" onclick="setTheme('espresso')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#0f0c0a;">
              <div style="flex:1; border-radius:3px; background:#211c18;"></div>
              <div style="flex:1; border-radius:3px; background:#a78b6e;"></div>
              <div style="flex:1; border-radius:3px; background:#c4a88a;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Espresso</div>
            <div style="font-size:10px; color:var(--text-secondary);">Warm brown</div>
          </div>
          
          <div class="theme-card" data-theme="onyx" onclick="setTheme('onyx')">
            <div style="height:40px; border-radius:6px; margin-bottom:8px; display:flex; gap:2px; padding:4px; background:#000000;">
              <div style="flex:1; border-radius:3px; background:#121212;"></div>
              <div style="flex:1; border-radius:3px; background:#06b6d4;"></div>
              <div style="flex:1; border-radius:3px; background:#22d3ee;"></div>
            </div>
            <div style="font-size:12px; font-weight:600;">Onyx</div>
            <div style="font-size:10px; color:var(--text-secondary);">True black</div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  </div>
  <!-- End Main Content -->

<script src="dashboard-settings.js"></script>

<script>
function toggleMobileMenu(button) {
  const content = document.getElementById('mobileHeaderContent');
  content.classList.toggle('expanded');
}

function toggleAccordion(button) {
  const content = button.nextElementSibling;
  button.classList.toggle('active');
  content.classList.toggle('active');
}

function logout() {
  localStorage.removeItem("sb_access_token");
  location.replace("login.html");
}

function setTheme(theme) {
  localStorage.setItem('app-theme', theme);
  document.documentElement.setAttribute('data-theme', theme);
  updateThemeCardStates(theme);
}

function updateThemeCardStates(activeTheme) {
  document.querySelectorAll('.theme-card').forEach(card => {
    const cardTheme = card.getAttribute('data-theme');
    if (cardTheme === activeTheme) {
      card.classList.add('active');
    } else {
      card.classList.remove('active');
    }
  });
}

function loadTheme() {
  const savedTheme = localStorage.getItem('app-theme') || 'dark-blue';
  document.documentElement.setAttribute('data-theme', savedTheme);
  setTimeout(() => updateThemeCardStates(savedTheme), 100);
}

loadTheme();
</script>
</body>
</html>
